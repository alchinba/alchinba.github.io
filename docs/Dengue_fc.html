<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dimash Alchinbayev - Dengue Fever</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dimash Alchinbayev</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#significance" id="toc-significance" class="nav-link active" data-scroll-target="#significance">Significance</a></li>
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers">Outliers</a></li>
  <li><a href="#stl-decomposition-and-non-seasonal-method" id="toc-stl-decomposition-and-non-seasonal-method" class="nav-link" data-scroll-target="#stl-decomposition-and-non-seasonal-method">STL decomposition and non-seasonal method</a></li>
  <li><a href="#arima-w-fourier" id="toc-arima-w-fourier" class="nav-link" data-scroll-target="#arima-w-fourier">ARIMA w/ Fourier</a></li>
  <li><a href="#nnetar" id="toc-nnetar" class="nav-link" data-scroll-target="#nnetar">NNETAR</a></li>
  <li><a href="#arima-w-regressors" id="toc-arima-w-regressors" class="nav-link" data-scroll-target="#arima-w-regressors">ARIMA w/ Regressors</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#further-work" id="toc-further-work" class="nav-link" data-scroll-target="#further-work">Further work</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Dengue Fever</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="significance" class="level2">
<h2 class="anchored" data-anchor-id="significance">Significance</h2>
<p>Dengue fever is a virus that is spread to people through the bite of an infected mosquito. A severe dengue fever case can lead to circulatory system failure, shock, and even death. Almost half of the world’s population, about 4 billion people, live in areas with a risk of dengue. Studying and forecasting the total number of infection incidents can help to tame this disease.</p>
<p>I am using the fpp3 package to forecast the next total weekly cases of Dengue fever two cities in Peru and Puerto Rico.</p>
<p>The dataset is from <a href="https://www.drivendata.org/competitions/44/dengai-predicting-disease-spread/">drivendata.org</a> competition.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────────────── fpp3 0.5 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ tibble      3.1.8     ✔ tsibble     1.1.3
✔ dplyr       1.1.0     ✔ tsibbledata 0.4.1
✔ tidyr       1.2.0     ✔ feasts      0.3.1
✔ lubridate   1.8.0     ✔ fable       0.3.3
✔ ggplot2     3.3.5     ✔ fabletools  0.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────────────── fpp3_conflicts ──
✖ lubridate::date()    masks base::date()
✖ dplyr::filter()      masks stats::filter()
✖ tsibble::intersect() masks base::intersect()
✖ tsibble::interval()  masks lubridate::interval()
✖ dplyr::lag()         masks stats::lag()
✖ tsibble::setdiff()   masks base::setdiff()
✖ tsibble::union()     masks base::union()</code></pre>
</div>
</div>
<p>I am importing and combining the data on the number of cases and 20 possible predictor variables.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dengue_fts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Training_Data_Features.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1456 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (1): city
dbl  (22): year, weekofyear, ndvi_ne, ndvi_nw, ndvi_se, ndvi_sw, precipitati...
date  (1): week_start_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dengue_label <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Training_Data_Labels.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1456 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): city
dbl (3): year, weekofyear, total_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dengue_label <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dengue_fts,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"year"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"weekofyear"</span>)) <span class="ot">-&gt;</span> dengue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I am performing a quick random test to see if everything matches up.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dengue_fts<span class="sc">$</span>reanalysis_dew_point_temp_k[<span class="dv">256</span>]<span class="sc">==</span>dengue<span class="sc">$</span>reanalysis_dew_point_temp_k[<span class="dv">256</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>I am transforming the combined dataset into a tsibble, the format for fpp3 package. The newly created year_week is an index variable and the two cities are keys to treat their observations as separate time series.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_week =</span> <span class="fu">yearweek</span>(week_start_date)) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> city,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">index =</span> year_week) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(city)) <span class="ot">-&gt;</span> dengue_ts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is the plot fro both cities.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(city=="sj") |&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(total_cases) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Cases of Dengue fever in San Juan and Iquitos"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"April 1990 - June 2010, Weekly"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Centers for Disease Control and prevention"</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the data for San Juan and Iquitos span different time periods but still overlap. We can also observe that most of the time the total number of cases is less than 50, however there are numerous spikes.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(dengue_ts<span class="sc">$</span>total_cases))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">50</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1 x 26 [1W]
# Key:       city [1]
  city   year weekofyear total_cases week_start_date ndvi_ne ndvi_nw ndvi_se
  &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;date&gt;            &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 sj     2008         17           5 2008-04-22       -0.037 -0.0104  0.0773
# … with 18 more variables: ndvi_sw &lt;dbl&gt;, precipitation_amt_mm &lt;dbl&gt;,
#   reanalysis_air_temp_k &lt;dbl&gt;, reanalysis_avg_temp_k &lt;dbl&gt;,
#   reanalysis_dew_point_temp_k &lt;dbl&gt;, reanalysis_max_air_temp_k &lt;dbl&gt;,
#   reanalysis_min_air_temp_k &lt;dbl&gt;, reanalysis_precip_amt_kg_per_m2 &lt;dbl&gt;,
#   reanalysis_relative_humidity_percent &lt;dbl&gt;,
#   reanalysis_sat_precip_amt_mm &lt;dbl&gt;,
#   reanalysis_specific_humidity_g_per_kg &lt;dbl&gt;, reanalysis_tdtr_k &lt;dbl&gt;, …</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1 x 26 [1W]
# Key:       city [1]
  city   year weekofyear total_cases week_start_date ndvi_ne ndvi_nw ndvi_se
  &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;date&gt;            &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 iq     2010         25           4 2010-06-25        0.298   0.233   0.274
# … with 18 more variables: ndvi_sw &lt;dbl&gt;, precipitation_amt_mm &lt;dbl&gt;,
#   reanalysis_air_temp_k &lt;dbl&gt;, reanalysis_avg_temp_k &lt;dbl&gt;,
#   reanalysis_dew_point_temp_k &lt;dbl&gt;, reanalysis_max_air_temp_k &lt;dbl&gt;,
#   reanalysis_min_air_temp_k &lt;dbl&gt;, reanalysis_precip_amt_kg_per_m2 &lt;dbl&gt;,
#   reanalysis_relative_humidity_percent &lt;dbl&gt;,
#   reanalysis_sat_precip_amt_mm &lt;dbl&gt;,
#   reanalysis_specific_humidity_g_per_kg &lt;dbl&gt;, reanalysis_tdtr_k &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Most of the models cannot work with gaps in time, so I am checking for explicit gaps.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">has_gaps</span>(dengue_ts, <span class="at">.full =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  city  .gaps
  &lt;chr&gt; &lt;lgl&gt;
1 iq    TRUE 
2 sj    TRUE </code></pre>
</div>
</div>
<p>Both cities have gaps, so I am filling gaps and using the previous value to fill them.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tsibble':

    index</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>( <span class="sc">~</span> <span class="fu">na.locf</span>(.x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="ot">-&gt;</span> dengue_ts_c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I am checking if there are any missing values left.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dengue_ts_c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                 city                                  year 
                                    0                                     0 
                           weekofyear                           total_cases 
                                    0                                     0 
                      week_start_date                               ndvi_ne 
                                    0                                     0 
                              ndvi_nw                               ndvi_se 
                                    0                                     0 
                              ndvi_sw                  precipitation_amt_mm 
                                    0                                     0 
                reanalysis_air_temp_k                 reanalysis_avg_temp_k 
                                    0                                     0 
          reanalysis_dew_point_temp_k             reanalysis_max_air_temp_k 
                                    0                                     0 
            reanalysis_min_air_temp_k       reanalysis_precip_amt_kg_per_m2 
                                    0                                     0 
 reanalysis_relative_humidity_percent          reanalysis_sat_precip_amt_mm 
                                    0                                     0 
reanalysis_specific_humidity_g_per_kg                     reanalysis_tdtr_k 
                                    0                                     0 
                   station_avg_temp_c               station_diur_temp_rng_c 
                                    0                                     0 
                   station_max_temp_c                    station_min_temp_c 
                                    0                                     0 
                    station_precip_mm                             year_week 
                                    0                                     0 </code></pre>
</div>
</div>
<p>There are no missing values in the dengue_ts_c.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(city=="sj") |&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(total_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It seems that there is some seasonality present. The seasonal plot shows that most of the spikes happen in the same months.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(total_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I am performing an STL decomposition to identify seasonality and trend, if any.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">STL</span>(total_cases)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition for San Juan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Ignoring unknown parameters: linewidth</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">STL</span>(total_cases)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition for Iquitos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Ignoring unknown parameters: linewidth</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It seems that there is some seasonality when all the spikes are in the remainder. There also might be a slight increase in the trend for Iquitos.</p>
<p>I am creating an ordered list of all the climate-related variables, descending from the highest correlation with the total cases to lowest.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dengue_ts_c[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">25</span>)],</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    dengue_ts_c[,<span class="dv">4</span>]) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Var2) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Freq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Var1        Freq
1              reanalysis_min_air_temp_k  0.32528700
2                     station_min_temp_c  0.26445735
3                  reanalysis_air_temp_k  0.26295412
4                  reanalysis_avg_temp_k  0.14823702
5            reanalysis_dew_point_temp_k  0.13943398
6  reanalysis_specific_humidity_g_per_kg  0.12666319
7                     station_avg_temp_c  0.11350812
8        reanalysis_precip_amt_kg_per_m2 -0.01146877
9                     station_max_temp_c -0.04013282
10                  precipitation_amt_mm -0.04243715
11          reanalysis_sat_precip_amt_mm -0.04243715
12                     station_precip_mm -0.07344970
13  reanalysis_relative_humidity_percent -0.13335667
14                               ndvi_sw -0.14512247
15                               ndvi_nw -0.16844856
16             reanalysis_max_air_temp_k -0.19310534
17                               ndvi_ne -0.20513633
18                               ndvi_se -0.21315790
19               station_diur_temp_rng_c -0.23704112
20                     reanalysis_tdtr_k -0.27946425</code></pre>
</div>
</div>
<p>There seems to be no really strong correlation between the total cases and any individual predictor. Nevertheless, I am going to use this ranking when choosing the variables for time-consuming models.</p>
<p>Here are plots of the variables with the highest correlations (in absolute values).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(total_cases&lt;=100) %&gt;% </span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>             reanalysis_min_air_temp_k,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(total_cases&lt;=100) %&gt;% </span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>             reanalysis_tdtr_k,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here is the plot of all three variables stacked. There seems to be no obvious relationship between the predictors and the spikes.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(total_cases,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                 reanalysis_min_air_temp_k,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                 reanalysis_tdtr_k)) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also observe relatively high correlation between the cases in one week and the week before.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         total_cases<span class="sc">&lt;=</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(<span class="at">y =</span> total_cases,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">geom =</span> <span class="st">"point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="outliers" class="level2">
<h2 class="anchored" data-anchor-id="outliers">Outliers</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I am creating a dummy identifying if there was a spike in weekly cases.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> <span class="fu">ifelse</span>(total_cases<span class="sc">&gt;=</span><span class="dv">100</span><span class="sc">&amp;</span>city<span class="sc">==</span><span class="st">"sj"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">1</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(total_cases<span class="sc">&gt;=</span><span class="dv">15</span><span class="sc">&amp;</span>city<span class="sc">==</span><span class="st">"iq"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">0</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                          )) <span class="ot">-&gt;</span> dengue_100up</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a visual representation.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dengue_100up <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="fu">lag</span>(year_week),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xmax =</span> year_week,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> <span class="dv">0</span>, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> outlier <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"transparent"</span>, </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"red"</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (geom_rect).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I am then creating a new list based on the variables’ correlation with the spike incidents.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dengue_100up[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">25</span>)],</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    dengue_100up[,<span class="dv">27</span>]) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Var2) <span class="sc">|&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Freq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Var1         Freq
1                     station_max_temp_c  0.198169569
2  reanalysis_specific_humidity_g_per_kg  0.184571781
3                     station_avg_temp_c  0.180714057
4            reanalysis_dew_point_temp_k  0.174252235
5              reanalysis_max_air_temp_k  0.157736465
6                station_diur_temp_rng_c  0.145657342
7   reanalysis_relative_humidity_percent  0.137849906
8                  reanalysis_avg_temp_k  0.130503427
9                   precipitation_amt_mm  0.117053029
10          reanalysis_sat_precip_amt_mm  0.117053029
11                     reanalysis_tdtr_k  0.107245826
12                               ndvi_nw  0.101885734
13       reanalysis_precip_amt_kg_per_m2  0.099191371
14                               ndvi_ne  0.092681542
15                               ndvi_sw  0.091356494
16                    station_min_temp_c  0.080883428
17                     station_precip_mm  0.071557679
18                 reanalysis_air_temp_k  0.066923290
19                               ndvi_se  0.006051806
20             reanalysis_min_air_temp_k -0.018410823</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(total_cases,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                 station_max_temp_c,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                 reanalysis_specific_humidity_g_per_kg)) <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>No obvious relationship between the spikes and the two variables.</p>
<p>After looking at the data, I am proceeding to create the forecast models.</p>
</section>
<section id="stl-decomposition-and-non-seasonal-method" class="level2">
<h2 class="anchored" data-anchor-id="stl-decomposition-and-non-seasonal-method">STL decomposition and non-seasonal method</h2>
<p>According to Hyndman, et al., the simplest method is STL decomposition with a non-seasonal model applied to the seasonally adjusted data. I am creating a decomposition model with STL and non-seasonal ETS.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">decomposition_model</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">STL</span>(total_cases),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ETS</span>(season_adjust <span class="sc">~</span> <span class="fu">season</span>(<span class="st">"N"</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>) <span class="ot">-&gt;</span> den_dcmp_envm</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl_ets =</span> den_dcmp_envm) <span class="sc">|&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="ot">-&gt;</span> den_dcmp_fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>den_dcmp_fc <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Decomposition and STL forecast"</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I am forecasting 5 years for both of the cities to then cut the last two years of Iquitos.</p>
<p>Due to its simplicity, it is similar to Seasonal Naive.</p>
</section>
<section id="arima-w-fourier" class="level2">
<h2 class="anchored" data-anchor-id="arima-w-fourier">ARIMA w/ Fourier</h2>
<p>Here, I am creating an ARIMA model where seasonality is captured by Fourier series.</p>
<p>I am creating several models with increasing number of K to then choose one based on the AICc.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">K1 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">1</span>)),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">K2 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">2</span>)),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">K3 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">3</span>)),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">K4 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">4</span>)),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">K5 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">5</span>)),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">K6 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">6</span>)),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">K12 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">12</span>)),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">K15 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">15</span>)),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">K26 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">26</span>)),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        ) <span class="ot">-&gt;</span> dengue_arima3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(dengue_arima3) <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city, .model, AICc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 3
   city  .model  AICc
   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1 iq    K1     3539.
 2 iq    K2     3543.
 3 iq    K3     3545.
 4 iq    K4     3546.
 5 iq    K5     3548.
 6 iq    K6     3549.
 7 iq    K12    3545.
 8 iq    K15    3549.
 9 iq    K26    3571.
10 sj    K1     7521.
11 sj    K2     7520.
12 sj    K3     7523.
13 sj    K4     7525.
14 sj    K5     7529.
15 sj    K6     7532.
16 sj    K12    7543.
17 sj    K15    7548.
18 sj    K26    7565.</code></pre>
</div>
</div>
<p>The larger numbers of K worsen the AICc. Only the model for San Juan is slightly better at K = 2. Nevertheless, since the improvement is small, to stay consistent, I keep K = 1.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>dengue_arima3 <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(K1) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="ot">-&gt;</span> den_arima_fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>den_arima_fc <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ARIMA with Fourier forecast"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="nnetar" class="level2">
<h2 class="anchored" data-anchor-id="nnetar">NNETAR</h2>
<p>The third model is Neural Networks. This is the most time consuming model, but the results can be very promising.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>den_nn_model <span class="ot">=</span> dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">nnetar =</span> <span class="fu">NNETAR</span>(total_cases))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>den_nn_model <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"3 years"</span>) <span class="ot">-&gt;</span> den_nn_fc</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 19.48274 mins</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>den_nn_fc <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NNETAR with no external regs forecast"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we can see that the model for Iquitos picked up the trend but then flattened out, which doesn’t look good. The model for San Juan, however looks promising but also looses all seasonality later on.</p>
<p>I am no trying NNETAR with external regressors: station_max_temp_c<br>
reanalysis_specific_humidity_g_per_kg<br>
reanalysis_min_air_temp_k reanalysis_air_temp_k.</p>
<p>However, in order to use them, I need features from the test data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>den_test_fts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Test_Data_Features.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (1): city
dbl  (22): year, weekofyear, ndvi_ne, ndvi_nw, ndvi_se, ndvi_sw, precipitati...
date  (1): week_start_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>The test dataset also has some gaps, so I am filling them.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>den_test_fts <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_week =</span> <span class="fu">yearweek</span>(week_start_date)) <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> city,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">index =</span> year_week) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>( <span class="sc">~</span> <span class="fu">na.locf</span>(.x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(city)) <span class="ot">-&gt;</span> den_test_ts2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>den_nn_model2 <span class="ot">=</span> dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">nnetar =</span> <span class="fu">NNETAR</span>(total_cases <span class="sc">~</span> station_max_temp_c <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                          reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                          reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                          reanalysis_air_temp_k))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>den_nn_model2 <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_nn_fc2</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 26.52379 mins</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>den_nn_fc2 <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NNETAR w/ Regressors forecast"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The resulting forecast looks very promising, indeed. The prediction intervals also seem to cover most of the probable observations, without getting into negative territory.</p>
</section>
<section id="arima-w-regressors" class="level2">
<h2 class="anchored" data-anchor-id="arima-w-regressors">ARIMA w/ Regressors</h2>
<p>To incorporate more predictor variables from the dataset, I am using another ARIMA model with external regressors.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c)) <span class="ot">-&gt;</span> den_arreg_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fit <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fc2 <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using only the variables with highest correlation doesn’t seem to improve the forecast, all that much. Therefore, I am going to use all of them. I am also adding Fourier for seasonality.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dengue_ts_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "city"                                 
 [2] "year"                                 
 [3] "weekofyear"                           
 [4] "total_cases"                          
 [5] "week_start_date"                      
 [6] "ndvi_ne"                              
 [7] "ndvi_nw"                              
 [8] "ndvi_se"                              
 [9] "ndvi_sw"                              
[10] "precipitation_amt_mm"                 
[11] "reanalysis_air_temp_k"                
[12] "reanalysis_avg_temp_k"                
[13] "reanalysis_dew_point_temp_k"          
[14] "reanalysis_max_air_temp_k"            
[15] "reanalysis_min_air_temp_k"            
[16] "reanalysis_precip_amt_kg_per_m2"      
[17] "reanalysis_relative_humidity_percent" 
[18] "reanalysis_sat_precip_amt_mm"         
[19] "reanalysis_specific_humidity_g_per_kg"
[20] "reanalysis_tdtr_k"                    
[21] "station_avg_temp_c"                   
[22] "station_diur_temp_rng_c"              
[23] "station_max_temp_c"                   
[24] "station_min_temp_c"                   
[25] "station_precip_mm"                    
[26] "year_week"                            </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                            ndvi_ne <span class="sc">+</span> ndvi_nw <span class="sc">+</span> ndvi_se <span class="sc">+</span> ndvi_sw <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                            precipitation_amt_mm <span class="sc">+</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                            reanalysis_avg_temp_k <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                            reanalysis_dew_point_temp_k <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                            reanalysis_max_air_temp_k <span class="sc">+</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                            reanalysis_relative_humidity_percent <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                            reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                            reanalysis_precip_amt_kg_per_m2 <span class="sc">+</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                            reanalysis_tdtr_k <span class="sc">+</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>                            station_avg_temp_c <span class="sc">+</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>                            station_diur_temp_rng_c <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>                            station_max_temp_c <span class="sc">+</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c <span class="sc">+</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>                            station_precip_mm <span class="sc">+</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">1</span>)))<span class="ot">-&gt;</span>den_arreg_fit2</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Removed reanalysis_sat_precip_amt_mm to avoid rank deficiency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fit2 <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fc3 <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The forecast looks better now, but it looks too clean compared to the previous values.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                            ndvi_ne <span class="sc">+</span> ndvi_nw <span class="sc">+</span> ndvi_se <span class="sc">+</span> ndvi_sw <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                            precipitation_amt_mm <span class="sc">+</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                            reanalysis_avg_temp_k <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                            reanalysis_dew_point_temp_k <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                            reanalysis_max_air_temp_k <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                            reanalysis_relative_humidity_percent <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                            reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                            reanalysis_precip_amt_kg_per_m2 <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>                            reanalysis_tdtr_k <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>                            station_avg_temp_c <span class="sc">+</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>                            station_diur_temp_rng_c <span class="sc">+</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>                            station_max_temp_c <span class="sc">+</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c <span class="sc">+</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>                            station_precip_mm <span class="sc">+</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">season</span>()))<span class="ot">-&gt;</span>den_arreg_fit3</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Removed reanalysis_sat_precip_amt_mm to avoid rank deficiency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fit3 <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>den_arreg_fc4 <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ARIMA w/ Regressors and Seasonality forecast"</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Dengue_fc_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The same ARIMA model with seasonality included looks better than that with Fourier but worse than NNETAR.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>I had to upload the forecasts to the drivendata.org to obtain the evaluation of the models. The forecast used the observations at time T to forecast the number of cases at time T, because it was a forecast for the internally missing data.</p>
<p>I also had to manually remove some 3 observations from the predictions, since the evaluation dataset didn’t have some dates.</p>
<p>Given the Score and the Rank, NNETAR model is by far the best one. Decomposition model’s performance was quite low, ARIMA with seasonality and external regressors got a score of 25.93 and rank of 2042. NNETAR did better by a wide margin: the MAE score of 22.48 and rank of 512. This is out of approximately 12 thousand participants.</p>
<p>The respective submission IDs are id-240847, id-240852, and id-240853.</p>
</section>
<section id="further-work" class="level2">
<h2 class="anchored" data-anchor-id="further-work">Further work</h2>
<p>Adding more external variables will most probably increase the performance of NNETAR model. There also might be some calendar variables that should be included. For example, in the beginning we saw that the spikes occur in the same months. Adding dummies for high number months might improve the forecasts.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb78" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Dengue Fever"</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">    freeze: auto</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Significance</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>Dengue fever is a virus that is spread to people through the bite of an infected mosquito. A severe dengue fever case can lead to circulatory system failure, shock, and even death. Almost half of the world’s population, about 4 billion people, live in areas with a risk of dengue. Studying and forecasting the total number of infection incidents can help to tame this disease.</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>I am using the fpp3 package to forecast the next total weekly cases of Dengue fever two cities in Peru and Puerto Rico.</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>The dataset is from <span class="co">[</span><span class="ot">drivendata.org</span><span class="co">](https://www.drivendata.org/competitions/44/dengai-predicting-disease-spread/)</span> competition.</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>I am importing and combining the data on the number of cases and 20 possible predictor variables.</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>dengue_fts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Training_Data_Features.csv"</span>)</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>dengue_label <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Training_Data_Labels.csv"</span>)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>dengue_label <span class="sc">|&gt;</span></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dengue_fts,</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>,</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"year"</span>,</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"weekofyear"</span>)) <span class="ot">-&gt;</span> dengue</span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>I am performing a quick random test to see if everything matches up.</span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>dengue_fts<span class="sc">$</span>reanalysis_dew_point_temp_k[<span class="dv">256</span>]<span class="sc">==</span>dengue<span class="sc">$</span>reanalysis_dew_point_temp_k[<span class="dv">256</span>]</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>I am transforming the combined dataset into a tsibble, the format for fpp3 package. The newly created year_week is an index variable and the two cities are keys to treat their observations as separate time series.</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">|&gt;</span></span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_week =</span> <span class="fu">yearweek</span>(week_start_date)) <span class="sc">|&gt;</span></span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> city,</span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>             <span class="at">index =</span> year_week) <span class="sc">|&gt;</span></span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(city)) <span class="ot">-&gt;</span> dengue_ts</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>Here is the plot fro both cities.</span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(city=="sj") |&gt;</span></span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(total_cases) <span class="sc">+</span></span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Cases of Dengue fever in San Juan and Iquitos"</span>,</span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"April 1990 - June 2010, Weekly"</span>,</span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-85"><a href="#cb78-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Centers for Disease Control and prevention"</span>) <span class="sc">+</span></span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>We can see that the data for San Juan and Iquitos span different time periods but still overlap. We can also observe that most of the time the total number of cases is less than 50, however there are numerous spikes.</span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(dengue_ts<span class="sc">$</span>total_cases))</span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">50</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-98"><a href="#cb78-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">1</span>)</span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-106"><a href="#cb78-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-107"><a href="#cb78-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">1</span>)</span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a>Most of the models cannot work with gaps in time, so I am checking for explicit gaps.</span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-114"><a href="#cb78-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-115"><a href="#cb78-115" aria-hidden="true" tabindex="-1"></a><span class="fu">has_gaps</span>(dengue_ts, <span class="at">.full =</span> T)</span>
<span id="cb78-116"><a href="#cb78-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-117"><a href="#cb78-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-118"><a href="#cb78-118" aria-hidden="true" tabindex="-1"></a>Both cities have gaps, so I am filling gaps and using the previous value to fill them.</span>
<span id="cb78-119"><a href="#cb78-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-122"><a href="#cb78-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-123"><a href="#cb78-123" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb78-124"><a href="#cb78-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-125"><a href="#cb78-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-126"><a href="#cb78-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r removing explicit gaps}</span></span>
<span id="cb78-127"><a href="#cb78-127" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-128"><a href="#cb78-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-129"><a href="#cb78-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>( <span class="sc">~</span> <span class="fu">na.locf</span>(.x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="ot">-&gt;</span> dengue_ts_c</span>
<span id="cb78-130"><a href="#cb78-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-131"><a href="#cb78-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-132"><a href="#cb78-132" aria-hidden="true" tabindex="-1"></a>I am checking if there are any missing values left.</span>
<span id="cb78-133"><a href="#cb78-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-136"><a href="#cb78-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-137"><a href="#cb78-137" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dengue_ts_c))</span>
<span id="cb78-138"><a href="#cb78-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-139"><a href="#cb78-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-140"><a href="#cb78-140" aria-hidden="true" tabindex="-1"></a>There are no missing values in the dengue_ts_c.</span>
<span id="cb78-141"><a href="#cb78-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-144"><a href="#cb78-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-145"><a href="#cb78-145" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-146"><a href="#cb78-146" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(city=="sj") |&gt;</span></span>
<span id="cb78-147"><a href="#cb78-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(total_cases)</span>
<span id="cb78-148"><a href="#cb78-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-149"><a href="#cb78-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-150"><a href="#cb78-150" aria-hidden="true" tabindex="-1"></a>It seems that there is some seasonality present. The seasonal plot shows that most of the spikes happen in the same months.</span>
<span id="cb78-151"><a href="#cb78-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-154"><a href="#cb78-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-155"><a href="#cb78-155" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-156"><a href="#cb78-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(total_cases)</span>
<span id="cb78-157"><a href="#cb78-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-158"><a href="#cb78-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-159"><a href="#cb78-159" aria-hidden="true" tabindex="-1"></a>I am performing an STL decomposition to identify seasonality and trend, if any.</span>
<span id="cb78-160"><a href="#cb78-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-163"><a href="#cb78-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-164"><a href="#cb78-164" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-165"><a href="#cb78-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-166"><a href="#cb78-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb78-167"><a href="#cb78-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">STL</span>(total_cases)</span>
<span id="cb78-168"><a href="#cb78-168" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb78-169"><a href="#cb78-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-170"><a href="#cb78-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb78-171"><a href="#cb78-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition for San Juan"</span>)</span>
<span id="cb78-172"><a href="#cb78-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-173"><a href="#cb78-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-176"><a href="#cb78-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-177"><a href="#cb78-177" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-178"><a href="#cb78-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-179"><a href="#cb78-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb78-180"><a href="#cb78-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">STL</span>(total_cases)</span>
<span id="cb78-181"><a href="#cb78-181" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb78-182"><a href="#cb78-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-183"><a href="#cb78-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb78-184"><a href="#cb78-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition for Iquitos"</span>)</span>
<span id="cb78-185"><a href="#cb78-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-186"><a href="#cb78-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-187"><a href="#cb78-187" aria-hidden="true" tabindex="-1"></a>It seems that there is some seasonality when all the spikes are in the remainder. There also might be a slight increase in the trend for Iquitos.</span>
<span id="cb78-188"><a href="#cb78-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-189"><a href="#cb78-189" aria-hidden="true" tabindex="-1"></a>I am creating an ordered list of all the climate-related variables, descending from the highest correlation with the total cases to lowest.</span>
<span id="cb78-190"><a href="#cb78-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-193"><a href="#cb78-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-194"><a href="#cb78-194" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dengue_ts_c[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">25</span>)],</span>
<span id="cb78-195"><a href="#cb78-195" aria-hidden="true" tabindex="-1"></a>    dengue_ts_c[,<span class="dv">4</span>]) <span class="sc">|&gt;</span></span>
<span id="cb78-196"><a href="#cb78-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-197"><a href="#cb78-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-198"><a href="#cb78-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Var2) <span class="sc">|&gt;</span></span>
<span id="cb78-199"><a href="#cb78-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Freq))</span>
<span id="cb78-200"><a href="#cb78-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-201"><a href="#cb78-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-202"><a href="#cb78-202" aria-hidden="true" tabindex="-1"></a>There seems to be no really strong correlation between the total cases and any individual predictor. Nevertheless, I am going to use this ranking when choosing the variables for time-consuming models.</span>
<span id="cb78-203"><a href="#cb78-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-204"><a href="#cb78-204" aria-hidden="true" tabindex="-1"></a>Here are plots of the variables with the highest correlations (in absolute values).</span>
<span id="cb78-205"><a href="#cb78-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-208"><a href="#cb78-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-209"><a href="#cb78-209" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">%&gt;%</span> </span>
<span id="cb78-210"><a href="#cb78-210" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(total_cases&lt;=100) %&gt;% </span></span>
<span id="cb78-211"><a href="#cb78-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases,</span>
<span id="cb78-212"><a href="#cb78-212" aria-hidden="true" tabindex="-1"></a>             reanalysis_min_air_temp_k,</span>
<span id="cb78-213"><a href="#cb78-213" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb78-214"><a href="#cb78-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-215"><a href="#cb78-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb78-216"><a href="#cb78-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-217"><a href="#cb78-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-220"><a href="#cb78-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-221"><a href="#cb78-221" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">%&gt;%</span> </span>
<span id="cb78-222"><a href="#cb78-222" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(total_cases&lt;=100) %&gt;% </span></span>
<span id="cb78-223"><a href="#cb78-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases,</span>
<span id="cb78-224"><a href="#cb78-224" aria-hidden="true" tabindex="-1"></a>             reanalysis_tdtr_k,</span>
<span id="cb78-225"><a href="#cb78-225" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> year)) <span class="sc">+</span></span>
<span id="cb78-226"><a href="#cb78-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-227"><a href="#cb78-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb78-228"><a href="#cb78-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-229"><a href="#cb78-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-230"><a href="#cb78-230" aria-hidden="true" tabindex="-1"></a>Here is the plot of all three variables stacked. There seems to be no obvious relationship between the predictors and the spikes.</span>
<span id="cb78-231"><a href="#cb78-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-234"><a href="#cb78-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-235"><a href="#cb78-235" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-236"><a href="#cb78-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-237"><a href="#cb78-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(total_cases,</span>
<span id="cb78-238"><a href="#cb78-238" aria-hidden="true" tabindex="-1"></a>                 reanalysis_min_air_temp_k,</span>
<span id="cb78-239"><a href="#cb78-239" aria-hidden="true" tabindex="-1"></a>                 reanalysis_tdtr_k)) <span class="sc">|&gt;</span></span>
<span id="cb78-240"><a href="#cb78-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb78-241"><a href="#cb78-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb78-242"><a href="#cb78-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb78-243"><a href="#cb78-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-244"><a href="#cb78-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-245"><a href="#cb78-245" aria-hidden="true" tabindex="-1"></a>We can also observe relatively high correlation between the cases in one week and the week before.</span>
<span id="cb78-246"><a href="#cb78-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-249"><a href="#cb78-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-250"><a href="#cb78-250" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-251"><a href="#cb78-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>,</span>
<span id="cb78-252"><a href="#cb78-252" aria-hidden="true" tabindex="-1"></a>         total_cases<span class="sc">&lt;=</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-253"><a href="#cb78-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(<span class="at">y =</span> total_cases,</span>
<span id="cb78-254"><a href="#cb78-254" aria-hidden="true" tabindex="-1"></a>         <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb78-255"><a href="#cb78-255" aria-hidden="true" tabindex="-1"></a>         <span class="at">geom =</span> <span class="st">"point"</span>)</span>
<span id="cb78-256"><a href="#cb78-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-257"><a href="#cb78-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-258"><a href="#cb78-258" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outliers</span></span>
<span id="cb78-259"><a href="#cb78-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-262"><a href="#cb78-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-263"><a href="#cb78-263" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-264"><a href="#cb78-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"iq"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-265"><a href="#cb78-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_cases)) <span class="sc">+</span></span>
<span id="cb78-266"><a href="#cb78-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb78-267"><a href="#cb78-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-268"><a href="#cb78-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-269"><a href="#cb78-269" aria-hidden="true" tabindex="-1"></a>I am creating a dummy identifying if there was a spike in weekly cases.</span>
<span id="cb78-270"><a href="#cb78-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-273"><a href="#cb78-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-274"><a href="#cb78-274" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-275"><a href="#cb78-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> <span class="fu">ifelse</span>(total_cases<span class="sc">&gt;=</span><span class="dv">100</span><span class="sc">&amp;</span>city<span class="sc">==</span><span class="st">"sj"</span>,</span>
<span id="cb78-276"><a href="#cb78-276" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">1</span>,</span>
<span id="cb78-277"><a href="#cb78-277" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(total_cases<span class="sc">&gt;=</span><span class="dv">15</span><span class="sc">&amp;</span>city<span class="sc">==</span><span class="st">"iq"</span>,</span>
<span id="cb78-278"><a href="#cb78-278" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>,</span>
<span id="cb78-279"><a href="#cb78-279" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">0</span>)</span>
<span id="cb78-280"><a href="#cb78-280" aria-hidden="true" tabindex="-1"></a>                          )) <span class="ot">-&gt;</span> dengue_100up</span>
<span id="cb78-281"><a href="#cb78-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-282"><a href="#cb78-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-283"><a href="#cb78-283" aria-hidden="true" tabindex="-1"></a>Here is a visual representation.</span>
<span id="cb78-284"><a href="#cb78-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-287"><a href="#cb78-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-288"><a href="#cb78-288" aria-hidden="true" tabindex="-1"></a>dengue_100up <span class="sc">%&gt;%</span> </span>
<span id="cb78-289"><a href="#cb78-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-290"><a href="#cb78-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb78-291"><a href="#cb78-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="fu">lag</span>(year_week),</span>
<span id="cb78-292"><a href="#cb78-292" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xmax =</span> year_week,</span>
<span id="cb78-293"><a href="#cb78-293" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> <span class="dv">0</span>, </span>
<span id="cb78-294"><a href="#cb78-294" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb78-295"><a href="#cb78-295" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> outlier <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb78-296"><a href="#cb78-296" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb78-297"><a href="#cb78-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb78-298"><a href="#cb78-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"transparent"</span>, </span>
<span id="cb78-299"><a href="#cb78-299" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"red"</span>),</span>
<span id="cb78-300"><a href="#cb78-300" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb78-301"><a href="#cb78-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-302"><a href="#cb78-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-303"><a href="#cb78-303" aria-hidden="true" tabindex="-1"></a>I am then creating a new list based on the variables' correlation with the spike incidents.</span>
<span id="cb78-304"><a href="#cb78-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-307"><a href="#cb78-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-308"><a href="#cb78-308" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dengue_100up[,<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">25</span>)],</span>
<span id="cb78-309"><a href="#cb78-309" aria-hidden="true" tabindex="-1"></a>    dengue_100up[,<span class="dv">27</span>]) <span class="sc">|&gt;</span></span>
<span id="cb78-310"><a href="#cb78-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-311"><a href="#cb78-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-312"><a href="#cb78-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Var2) <span class="sc">|&gt;</span></span>
<span id="cb78-313"><a href="#cb78-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Freq))</span>
<span id="cb78-314"><a href="#cb78-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-315"><a href="#cb78-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-318"><a href="#cb78-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-319"><a href="#cb78-319" aria-hidden="true" tabindex="-1"></a>dengue_ts <span class="sc">|&gt;</span></span>
<span id="cb78-320"><a href="#cb78-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"sj"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-321"><a href="#cb78-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(total_cases,</span>
<span id="cb78-322"><a href="#cb78-322" aria-hidden="true" tabindex="-1"></a>                 station_max_temp_c,</span>
<span id="cb78-323"><a href="#cb78-323" aria-hidden="true" tabindex="-1"></a>                 reanalysis_specific_humidity_g_per_kg)) <span class="sc">|&gt;</span></span>
<span id="cb78-324"><a href="#cb78-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb78-325"><a href="#cb78-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb78-326"><a href="#cb78-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb78-327"><a href="#cb78-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-328"><a href="#cb78-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-329"><a href="#cb78-329" aria-hidden="true" tabindex="-1"></a>No obvious relationship between the spikes and the two variables.</span>
<span id="cb78-330"><a href="#cb78-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-331"><a href="#cb78-331" aria-hidden="true" tabindex="-1"></a>After looking at the data, I am proceeding to create the forecast models.</span>
<span id="cb78-332"><a href="#cb78-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-333"><a href="#cb78-333" aria-hidden="true" tabindex="-1"></a><span class="fu">## STL decomposition and non-seasonal method</span></span>
<span id="cb78-334"><a href="#cb78-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-335"><a href="#cb78-335" aria-hidden="true" tabindex="-1"></a>According to Hyndman, et al., the simplest method is STL decomposition with a non-seasonal model applied to the seasonally adjusted data. I am creating a decomposition model with STL and non-seasonal ETS.</span>
<span id="cb78-336"><a href="#cb78-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-339"><a href="#cb78-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-340"><a href="#cb78-340" aria-hidden="true" tabindex="-1"></a><span class="fu">decomposition_model</span>(</span>
<span id="cb78-341"><a href="#cb78-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">STL</span>(total_cases),</span>
<span id="cb78-342"><a href="#cb78-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ETS</span>(season_adjust <span class="sc">~</span> <span class="fu">season</span>(<span class="st">"N"</span>))</span>
<span id="cb78-343"><a href="#cb78-343" aria-hidden="true" tabindex="-1"></a>) <span class="ot">-&gt;</span> den_dcmp_envm</span>
<span id="cb78-344"><a href="#cb78-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-345"><a href="#cb78-345" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-346"><a href="#cb78-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl_ets =</span> den_dcmp_envm) <span class="sc">|&gt;</span></span>
<span id="cb78-347"><a href="#cb78-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="ot">-&gt;</span> den_dcmp_fc</span>
<span id="cb78-348"><a href="#cb78-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-349"><a href="#cb78-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-352"><a href="#cb78-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-353"><a href="#cb78-353" aria-hidden="true" tabindex="-1"></a>den_dcmp_fc <span class="sc">|&gt;</span></span>
<span id="cb78-354"><a href="#cb78-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb78-355"><a href="#cb78-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Decomposition and STL forecast"</span>,</span>
<span id="cb78-356"><a href="#cb78-356" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-357"><a href="#cb78-357" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span>
<span id="cb78-358"><a href="#cb78-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-359"><a href="#cb78-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-360"><a href="#cb78-360" aria-hidden="true" tabindex="-1"></a>I am forecasting 5 years for both of the cities to then cut the last two years of Iquitos.</span>
<span id="cb78-361"><a href="#cb78-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-362"><a href="#cb78-362" aria-hidden="true" tabindex="-1"></a>Due to its simplicity, it is similar to Seasonal Naive.</span>
<span id="cb78-363"><a href="#cb78-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-364"><a href="#cb78-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARIMA w/ Fourier</span></span>
<span id="cb78-365"><a href="#cb78-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-366"><a href="#cb78-366" aria-hidden="true" tabindex="-1"></a>Here, I am creating an ARIMA model where seasonality is captured by Fourier series. </span>
<span id="cb78-367"><a href="#cb78-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-368"><a href="#cb78-368" aria-hidden="true" tabindex="-1"></a>I am creating several models with increasing number of K to then choose one based on the AICc.</span>
<span id="cb78-369"><a href="#cb78-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-372"><a href="#cb78-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-373"><a href="#cb78-373" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-374"><a href="#cb78-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb78-375"><a href="#cb78-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">K1 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">1</span>)),</span>
<span id="cb78-376"><a href="#cb78-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">K2 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">2</span>)),</span>
<span id="cb78-377"><a href="#cb78-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">K3 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">3</span>)),</span>
<span id="cb78-378"><a href="#cb78-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">K4 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">4</span>)),</span>
<span id="cb78-379"><a href="#cb78-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">K5 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">5</span>)),</span>
<span id="cb78-380"><a href="#cb78-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">K6 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">6</span>)),</span>
<span id="cb78-381"><a href="#cb78-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">K12 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">12</span>)),</span>
<span id="cb78-382"><a href="#cb78-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">K15 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">15</span>)),</span>
<span id="cb78-383"><a href="#cb78-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">K26 =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">26</span>)),</span>
<span id="cb78-384"><a href="#cb78-384" aria-hidden="true" tabindex="-1"></a>        ) <span class="ot">-&gt;</span> dengue_arima3</span>
<span id="cb78-385"><a href="#cb78-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-386"><a href="#cb78-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-389"><a href="#cb78-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-390"><a href="#cb78-390" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(dengue_arima3) <span class="sc">|&gt;</span></span>
<span id="cb78-391"><a href="#cb78-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city, .model, AICc)</span>
<span id="cb78-392"><a href="#cb78-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-393"><a href="#cb78-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-394"><a href="#cb78-394" aria-hidden="true" tabindex="-1"></a>The larger numbers of K worsen the AICc. Only the model for San Juan is slightly better at K = 2. Nevertheless, since the improvement is small, to stay consistent, I keep K = 1.</span>
<span id="cb78-395"><a href="#cb78-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-398"><a href="#cb78-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-399"><a href="#cb78-399" aria-hidden="true" tabindex="-1"></a>dengue_arima3 <span class="sc">|&gt;</span></span>
<span id="cb78-400"><a href="#cb78-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(K1) <span class="sc">|&gt;</span></span>
<span id="cb78-401"><a href="#cb78-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="ot">-&gt;</span> den_arima_fc</span>
<span id="cb78-402"><a href="#cb78-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-403"><a href="#cb78-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-406"><a href="#cb78-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-407"><a href="#cb78-407" aria-hidden="true" tabindex="-1"></a>den_arima_fc <span class="sc">|&gt;</span></span>
<span id="cb78-408"><a href="#cb78-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb78-409"><a href="#cb78-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ARIMA with Fourier forecast"</span>,</span>
<span id="cb78-410"><a href="#cb78-410" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-411"><a href="#cb78-411" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span>
<span id="cb78-412"><a href="#cb78-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-413"><a href="#cb78-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-414"><a href="#cb78-414" aria-hidden="true" tabindex="-1"></a><span class="fu">## NNETAR</span></span>
<span id="cb78-415"><a href="#cb78-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-416"><a href="#cb78-416" aria-hidden="true" tabindex="-1"></a>The third model is Neural Networks. This is the most time consuming model, but the results can be very promising.</span>
<span id="cb78-417"><a href="#cb78-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-420"><a href="#cb78-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-421"><a href="#cb78-421" aria-hidden="true" tabindex="-1"></a>den_nn_model <span class="ot">=</span> dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-422"><a href="#cb78-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">nnetar =</span> <span class="fu">NNETAR</span>(total_cases))</span>
<span id="cb78-423"><a href="#cb78-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-424"><a href="#cb78-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-427"><a href="#cb78-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-428"><a href="#cb78-428" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb78-429"><a href="#cb78-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-430"><a href="#cb78-430" aria-hidden="true" tabindex="-1"></a>den_nn_model <span class="sc">|&gt;</span></span>
<span id="cb78-431"><a href="#cb78-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"3 years"</span>) <span class="ot">-&gt;</span> den_nn_fc</span>
<span id="cb78-432"><a href="#cb78-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-433"><a href="#cb78-433" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span>
<span id="cb78-434"><a href="#cb78-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-435"><a href="#cb78-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-438"><a href="#cb78-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-439"><a href="#cb78-439" aria-hidden="true" tabindex="-1"></a>den_nn_fc <span class="sc">|&gt;</span></span>
<span id="cb78-440"><a href="#cb78-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb78-441"><a href="#cb78-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NNETAR with no external regs forecast"</span>,</span>
<span id="cb78-442"><a href="#cb78-442" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-443"><a href="#cb78-443" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span>
<span id="cb78-444"><a href="#cb78-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-445"><a href="#cb78-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-446"><a href="#cb78-446" aria-hidden="true" tabindex="-1"></a>Here we can see that the model for Iquitos picked up the trend but then flattened out, which doesn't look good. The model for San Juan, however looks promising but also looses all seasonality later on.</span>
<span id="cb78-447"><a href="#cb78-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-448"><a href="#cb78-448" aria-hidden="true" tabindex="-1"></a>I am no trying NNETAR with external regressors:</span>
<span id="cb78-449"><a href="#cb78-449" aria-hidden="true" tabindex="-1"></a>station_max_temp_c  </span>
<span id="cb78-450"><a href="#cb78-450" aria-hidden="true" tabindex="-1"></a>reanalysis_specific_humidity_g_per_kg   </span>
<span id="cb78-451"><a href="#cb78-451" aria-hidden="true" tabindex="-1"></a>reanalysis_min_air_temp_k</span>
<span id="cb78-452"><a href="#cb78-452" aria-hidden="true" tabindex="-1"></a>reanalysis_air_temp_k.</span>
<span id="cb78-453"><a href="#cb78-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-454"><a href="#cb78-454" aria-hidden="true" tabindex="-1"></a>However, in order to use them, I need features from the test data.</span>
<span id="cb78-455"><a href="#cb78-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-458"><a href="#cb78-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-459"><a href="#cb78-459" aria-hidden="true" tabindex="-1"></a>den_test_fts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"DengAI_Predicting_Disease_Spread_-_Test_Data_Features.csv"</span>)</span>
<span id="cb78-460"><a href="#cb78-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-461"><a href="#cb78-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-462"><a href="#cb78-462" aria-hidden="true" tabindex="-1"></a>The test dataset also has some gaps, so I am filling them.</span>
<span id="cb78-463"><a href="#cb78-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-466"><a href="#cb78-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-467"><a href="#cb78-467" aria-hidden="true" tabindex="-1"></a>den_test_fts <span class="sc">|&gt;</span></span>
<span id="cb78-468"><a href="#cb78-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_week =</span> <span class="fu">yearweek</span>(week_start_date)) <span class="sc">|&gt;</span></span>
<span id="cb78-469"><a href="#cb78-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> city,</span>
<span id="cb78-470"><a href="#cb78-470" aria-hidden="true" tabindex="-1"></a>             <span class="at">index =</span> year_week) <span class="sc">|&gt;</span></span>
<span id="cb78-471"><a href="#cb78-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-472"><a href="#cb78-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>( <span class="sc">~</span> <span class="fu">na.locf</span>(.x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-473"><a href="#cb78-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(city)) <span class="ot">-&gt;</span> den_test_ts2</span>
<span id="cb78-474"><a href="#cb78-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-475"><a href="#cb78-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-478"><a href="#cb78-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-479"><a href="#cb78-479" aria-hidden="true" tabindex="-1"></a>den_nn_model2 <span class="ot">=</span> dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-480"><a href="#cb78-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">nnetar =</span> <span class="fu">NNETAR</span>(total_cases <span class="sc">~</span> station_max_temp_c <span class="sc">+</span></span>
<span id="cb78-481"><a href="#cb78-481" aria-hidden="true" tabindex="-1"></a>                          reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb78-482"><a href="#cb78-482" aria-hidden="true" tabindex="-1"></a>                          reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb78-483"><a href="#cb78-483" aria-hidden="true" tabindex="-1"></a>                          reanalysis_air_temp_k))</span>
<span id="cb78-484"><a href="#cb78-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-485"><a href="#cb78-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-488"><a href="#cb78-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-489"><a href="#cb78-489" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb78-490"><a href="#cb78-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-491"><a href="#cb78-491" aria-hidden="true" tabindex="-1"></a>den_nn_model2 <span class="sc">|&gt;</span></span>
<span id="cb78-492"><a href="#cb78-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_nn_fc2</span>
<span id="cb78-493"><a href="#cb78-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-494"><a href="#cb78-494" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span>
<span id="cb78-495"><a href="#cb78-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-496"><a href="#cb78-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-499"><a href="#cb78-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-500"><a href="#cb78-500" aria-hidden="true" tabindex="-1"></a>den_nn_fc2 <span class="sc">|&gt;</span></span>
<span id="cb78-501"><a href="#cb78-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb78-502"><a href="#cb78-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NNETAR w/ Regressors forecast"</span>,</span>
<span id="cb78-503"><a href="#cb78-503" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-504"><a href="#cb78-504" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span>
<span id="cb78-505"><a href="#cb78-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-506"><a href="#cb78-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-507"><a href="#cb78-507" aria-hidden="true" tabindex="-1"></a>The resulting forecast looks very promising, indeed. The prediction intervals also seem to cover most of the probable observations, without getting into negative territory.</span>
<span id="cb78-508"><a href="#cb78-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-509"><a href="#cb78-509" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARIMA w/ Regressors</span></span>
<span id="cb78-510"><a href="#cb78-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-511"><a href="#cb78-511" aria-hidden="true" tabindex="-1"></a>To incorporate more predictor variables from the dataset, I am using another ARIMA model with external regressors.</span>
<span id="cb78-512"><a href="#cb78-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-515"><a href="#cb78-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-516"><a href="#cb78-516" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-517"><a href="#cb78-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb78-518"><a href="#cb78-518" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb78-519"><a href="#cb78-519" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span></span>
<span id="cb78-520"><a href="#cb78-520" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c)) <span class="ot">-&gt;</span> den_arreg_fit</span>
<span id="cb78-521"><a href="#cb78-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-522"><a href="#cb78-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-525"><a href="#cb78-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-526"><a href="#cb78-526" aria-hidden="true" tabindex="-1"></a>den_arreg_fit <span class="sc">|&gt;</span></span>
<span id="cb78-527"><a href="#cb78-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc2</span>
<span id="cb78-528"><a href="#cb78-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-529"><a href="#cb78-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-532"><a href="#cb78-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-533"><a href="#cb78-533" aria-hidden="true" tabindex="-1"></a>den_arreg_fc2 <span class="sc">|&gt;</span></span>
<span id="cb78-534"><a href="#cb78-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c)</span>
<span id="cb78-535"><a href="#cb78-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-536"><a href="#cb78-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-537"><a href="#cb78-537" aria-hidden="true" tabindex="-1"></a>Using only the variables with highest correlation doesn't seem to improve the forecast, all that much. Therefore, I am going to use all of them. I am also adding Fourier for seasonality.</span>
<span id="cb78-538"><a href="#cb78-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-541"><a href="#cb78-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-542"><a href="#cb78-542" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dengue_ts_c)</span>
<span id="cb78-543"><a href="#cb78-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-544"><a href="#cb78-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-545"><a href="#cb78-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ARIMA w/ Regressors and Fourier}</span></span>
<span id="cb78-546"><a href="#cb78-546" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-547"><a href="#cb78-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb78-548"><a href="#cb78-548" aria-hidden="true" tabindex="-1"></a>                            ndvi_ne <span class="sc">+</span> ndvi_nw <span class="sc">+</span> ndvi_se <span class="sc">+</span> ndvi_sw <span class="sc">+</span></span>
<span id="cb78-549"><a href="#cb78-549" aria-hidden="true" tabindex="-1"></a>                            precipitation_amt_mm <span class="sc">+</span> </span>
<span id="cb78-550"><a href="#cb78-550" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span> </span>
<span id="cb78-551"><a href="#cb78-551" aria-hidden="true" tabindex="-1"></a>                            reanalysis_avg_temp_k <span class="sc">+</span></span>
<span id="cb78-552"><a href="#cb78-552" aria-hidden="true" tabindex="-1"></a>                            reanalysis_dew_point_temp_k <span class="sc">+</span></span>
<span id="cb78-553"><a href="#cb78-553" aria-hidden="true" tabindex="-1"></a>                            reanalysis_max_air_temp_k <span class="sc">+</span></span>
<span id="cb78-554"><a href="#cb78-554" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb78-555"><a href="#cb78-555" aria-hidden="true" tabindex="-1"></a>                            reanalysis_relative_humidity_percent <span class="sc">+</span></span>
<span id="cb78-556"><a href="#cb78-556" aria-hidden="true" tabindex="-1"></a>                            reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb78-557"><a href="#cb78-557" aria-hidden="true" tabindex="-1"></a>                            reanalysis_precip_amt_kg_per_m2 <span class="sc">+</span></span>
<span id="cb78-558"><a href="#cb78-558" aria-hidden="true" tabindex="-1"></a>                            reanalysis_tdtr_k <span class="sc">+</span></span>
<span id="cb78-559"><a href="#cb78-559" aria-hidden="true" tabindex="-1"></a>                            station_avg_temp_c <span class="sc">+</span></span>
<span id="cb78-560"><a href="#cb78-560" aria-hidden="true" tabindex="-1"></a>                            station_diur_temp_rng_c <span class="sc">+</span></span>
<span id="cb78-561"><a href="#cb78-561" aria-hidden="true" tabindex="-1"></a>                            station_max_temp_c <span class="sc">+</span></span>
<span id="cb78-562"><a href="#cb78-562" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c <span class="sc">+</span></span>
<span id="cb78-563"><a href="#cb78-563" aria-hidden="true" tabindex="-1"></a>                            station_precip_mm <span class="sc">+</span></span>
<span id="cb78-564"><a href="#cb78-564" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">fourier</span>(<span class="at">K =</span> <span class="dv">1</span>)))<span class="ot">-&gt;</span>den_arreg_fit2</span>
<span id="cb78-565"><a href="#cb78-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-566"><a href="#cb78-566" aria-hidden="true" tabindex="-1"></a><span class="co">#Removed reanalysis_sat_precip_amt_mm to avoid rank deficiency</span></span>
<span id="cb78-567"><a href="#cb78-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-568"><a href="#cb78-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-571"><a href="#cb78-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-572"><a href="#cb78-572" aria-hidden="true" tabindex="-1"></a>den_arreg_fit2 <span class="sc">|&gt;</span></span>
<span id="cb78-573"><a href="#cb78-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc3</span>
<span id="cb78-574"><a href="#cb78-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-575"><a href="#cb78-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-578"><a href="#cb78-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-579"><a href="#cb78-579" aria-hidden="true" tabindex="-1"></a>den_arreg_fc3 <span class="sc">|&gt;</span></span>
<span id="cb78-580"><a href="#cb78-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c)</span>
<span id="cb78-581"><a href="#cb78-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-582"><a href="#cb78-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-583"><a href="#cb78-583" aria-hidden="true" tabindex="-1"></a>The forecast looks better now, but it looks too clean compared to the previous values.</span>
<span id="cb78-584"><a href="#cb78-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-585"><a href="#cb78-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include seasons instead of Fourier}</span></span>
<span id="cb78-586"><a href="#cb78-586" aria-hidden="true" tabindex="-1"></a>dengue_ts_c <span class="sc">|&gt;</span></span>
<span id="cb78-587"><a href="#cb78-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(total_cases <span class="sc">~</span> <span class="fu">PDQ</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb78-588"><a href="#cb78-588" aria-hidden="true" tabindex="-1"></a>                            ndvi_ne <span class="sc">+</span> ndvi_nw <span class="sc">+</span> ndvi_se <span class="sc">+</span> ndvi_sw <span class="sc">+</span></span>
<span id="cb78-589"><a href="#cb78-589" aria-hidden="true" tabindex="-1"></a>                            precipitation_amt_mm <span class="sc">+</span> </span>
<span id="cb78-590"><a href="#cb78-590" aria-hidden="true" tabindex="-1"></a>                            reanalysis_air_temp_k <span class="sc">+</span> </span>
<span id="cb78-591"><a href="#cb78-591" aria-hidden="true" tabindex="-1"></a>                            reanalysis_avg_temp_k <span class="sc">+</span></span>
<span id="cb78-592"><a href="#cb78-592" aria-hidden="true" tabindex="-1"></a>                            reanalysis_dew_point_temp_k <span class="sc">+</span></span>
<span id="cb78-593"><a href="#cb78-593" aria-hidden="true" tabindex="-1"></a>                            reanalysis_max_air_temp_k <span class="sc">+</span></span>
<span id="cb78-594"><a href="#cb78-594" aria-hidden="true" tabindex="-1"></a>                            reanalysis_min_air_temp_k <span class="sc">+</span></span>
<span id="cb78-595"><a href="#cb78-595" aria-hidden="true" tabindex="-1"></a>                            reanalysis_relative_humidity_percent <span class="sc">+</span></span>
<span id="cb78-596"><a href="#cb78-596" aria-hidden="true" tabindex="-1"></a>                            reanalysis_specific_humidity_g_per_kg <span class="sc">+</span></span>
<span id="cb78-597"><a href="#cb78-597" aria-hidden="true" tabindex="-1"></a>                            reanalysis_precip_amt_kg_per_m2 <span class="sc">+</span></span>
<span id="cb78-598"><a href="#cb78-598" aria-hidden="true" tabindex="-1"></a>                            reanalysis_tdtr_k <span class="sc">+</span></span>
<span id="cb78-599"><a href="#cb78-599" aria-hidden="true" tabindex="-1"></a>                            station_avg_temp_c <span class="sc">+</span></span>
<span id="cb78-600"><a href="#cb78-600" aria-hidden="true" tabindex="-1"></a>                            station_diur_temp_rng_c <span class="sc">+</span></span>
<span id="cb78-601"><a href="#cb78-601" aria-hidden="true" tabindex="-1"></a>                            station_max_temp_c <span class="sc">+</span></span>
<span id="cb78-602"><a href="#cb78-602" aria-hidden="true" tabindex="-1"></a>                            station_min_temp_c <span class="sc">+</span></span>
<span id="cb78-603"><a href="#cb78-603" aria-hidden="true" tabindex="-1"></a>                            station_precip_mm <span class="sc">+</span></span>
<span id="cb78-604"><a href="#cb78-604" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">season</span>()))<span class="ot">-&gt;</span>den_arreg_fit3</span>
<span id="cb78-605"><a href="#cb78-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-606"><a href="#cb78-606" aria-hidden="true" tabindex="-1"></a><span class="co">#Removed reanalysis_sat_precip_amt_mm to avoid rank deficiency</span></span>
<span id="cb78-607"><a href="#cb78-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-608"><a href="#cb78-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-611"><a href="#cb78-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-612"><a href="#cb78-612" aria-hidden="true" tabindex="-1"></a>den_arreg_fit3 <span class="sc">|&gt;</span></span>
<span id="cb78-613"><a href="#cb78-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> den_test_ts2) <span class="ot">-&gt;</span> den_arreg_fc4</span>
<span id="cb78-614"><a href="#cb78-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-615"><a href="#cb78-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-618"><a href="#cb78-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-619"><a href="#cb78-619" aria-hidden="true" tabindex="-1"></a>den_arreg_fc4 <span class="sc">|&gt;</span></span>
<span id="cb78-620"><a href="#cb78-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dengue_ts_c) <span class="sc">+</span></span>
<span id="cb78-621"><a href="#cb78-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ARIMA w/ Regressors and Seasonality forecast"</span>,</span>
<span id="cb78-622"><a href="#cb78-622" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb78-623"><a href="#cb78-623" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>)</span>
<span id="cb78-624"><a href="#cb78-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-625"><a href="#cb78-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-626"><a href="#cb78-626" aria-hidden="true" tabindex="-1"></a>The same ARIMA model with seasonality included looks better than that with Fourier but worse than NNETAR.</span>
<span id="cb78-627"><a href="#cb78-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-628"><a href="#cb78-628" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb78-629"><a href="#cb78-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-630"><a href="#cb78-630" aria-hidden="true" tabindex="-1"></a>I had to upload the forecasts to the drivendata.org to obtain the evaluation of the models. The forecast used the observations at time T to forecast the number of cases at time T, because it was a forecast for the internally missing data.</span>
<span id="cb78-631"><a href="#cb78-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-632"><a href="#cb78-632" aria-hidden="true" tabindex="-1"></a>I also had to manually remove some 3 observations from the predictions, since the evaluation dataset didn't have some dates.</span>
<span id="cb78-633"><a href="#cb78-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-634"><a href="#cb78-634" aria-hidden="true" tabindex="-1"></a>Given the Score and the Rank, NNETAR model is by far the best one. Decomposition model's performance was quite low, ARIMA with seasonality and external regressors got a score of 25.93 and rank of 2042. NNETAR did better by a wide margin: the MAE score of 22.48 and rank of 512. This is out of approximately 12 thousand participants.</span>
<span id="cb78-635"><a href="#cb78-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-636"><a href="#cb78-636" aria-hidden="true" tabindex="-1"></a>The respective submission IDs are id-240847, id-240852, and id-240853.</span>
<span id="cb78-637"><a href="#cb78-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-638"><a href="#cb78-638" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further work</span></span>
<span id="cb78-639"><a href="#cb78-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-640"><a href="#cb78-640" aria-hidden="true" tabindex="-1"></a>Adding more external variables will most probably increase the performance of NNETAR model. There also might be some calendar variables that should be included. For example, in the beginning we saw that the spikes occur in the same months. Adding dummies for high number months might improve the forecasts.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>