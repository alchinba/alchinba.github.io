<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dimash Alchinbayev - Forecasting Conventional Hydroelectric Power Generation in the US</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dimash Alchinbayev</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#data-preparation-and-analysis" id="toc-data-preparation-and-analysis" class="nav-link" data-scroll-target="#data-preparation-and-analysis">Data Preparation and Analysis</a></li>
  <li><a href="#creating-training-and-testing-sets." id="toc-creating-training-and-testing-sets." class="nav-link" data-scroll-target="#creating-training-and-testing-sets.">Creating Training and Testing sets.</a></li>
  <li><a href="#arima-estimation" id="toc-arima-estimation" class="nav-link" data-scroll-target="#arima-estimation">ARIMA Estimation</a></li>
  <li><a href="#seasonal-naive-ts-regression-and-ets" id="toc-seasonal-naive-ts-regression-and-ets" class="nav-link" data-scroll-target="#seasonal-naive-ts-regression-and-ets">Seasonal Naive, TS Regression, and ETS</a></li>
  <li><a href="#arima-with-external-regressors" id="toc-arima-with-external-regressors" class="nav-link" data-scroll-target="#arima-with-external-regressors">ARIMA with external Regressors</a></li>
  <li><a href="#accuracy-evaluation" id="toc-accuracy-evaluation" class="nav-link" data-scroll-target="#accuracy-evaluation">Accuracy Evaluation</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Forecasting Conventional Hydroelectric Power Generation in the US</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>In the efforts of reaching net zero emissions, renewable energy sources get more and more important. One of the cheapest and most sustainable sources of electricity is conventional hydroelectric power generation.</p>
<p>Even though, the US has been using conventional hydropower since 1950s, the industry is far from reaching its full potential. With thousands of yet to be used dams and an increasing pressure to switch to the renewable energy, the demand and investments are going to rise significantly. Meanwhile, high seasonality and annual variation of the hydropower output can produce more accurate forecasting models. Here Seasonal Naïve, Regression, ETS, ARIMA, and ARIMA with external regressors are tested using RMSE and MPE to see which model better predicts unseen data. Using the net monthly conventional hydropower generation dataset, I identified ARIMA as the best one for the role.</p>
<p><strong>Technical Note</strong>: A megawatt is a unit for measuring instantaneous power equivalent to one million watts or thousand kilowatts. A megawatt hour (MWh) is equal to 1,000 kilowatt hours (kWh). It is equal to 1,000 kilowatts of energy consumed or produced in one hour. It is a bit more than the amount of electricity used by an average US residential utility customer in one month (886 kWh), according to the EIA.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────────────── fpp3 0.5 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ tibble      3.1.8     ✔ tsibble     1.1.3
✔ dplyr       1.1.0     ✔ tsibbledata 0.4.1
✔ tidyr       1.2.0     ✔ feasts      0.3.1
✔ lubridate   1.8.0     ✔ fable       0.3.3
✔ ggplot2     3.3.5     ✔ fabletools  0.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────────────── fpp3_conflicts ──
✖ lubridate::date()    masks base::date()
✖ dplyr::filter()      masks stats::filter()
✖ tsibble::intersect() masks base::intersect()
✖ tsibble::interval()  masks lubridate::interval()
✖ dplyr::lag()         masks stats::lag()
✖ tsibble::setdiff()   masks base::setdiff()
✖ tsibble::union()     masks base::union()</code></pre>
</div>
</div>
</section>
<section id="data-preparation-and-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation-and-analysis">Data Preparation and Analysis</h2>
<p>I import the data on net energy generation of electricity from the conventional hydroelectric sources from the <a href="https://www.eia.gov/electricity/data/browser/#/topic/0?agg=2,0,1&amp;fuel=05&amp;geo=vvvvvvvvvvvvo&amp;sec=g&amp;linechart=elec.gen.hyc-us-99.m&amp;columnchart=elec.gen.hyc-us-99.m&amp;map=elec.gen.hyc-us-99.m&amp;freq=m&amp;ctype=linechart&amp;ltype=pin&amp;rtype=s&amp;maptype=0&amp;rse=0&amp;pin=">EIA website</a>. The units are measured in thousand megawatt hours. The timeframe is from January 2001 through April 2023.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Net_generation_United_States_all_sectors_monthly.csv"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 268 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): Month
dbl (1): conventional hydroelectric thousand megawatthours

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Here is a preview of the dataset:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(net_gen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  Month    `conventional hydroelectric thousand megawatthours`
  &lt;chr&gt;                                                  &lt;dbl&gt;
1 Apr 2023                                              17917.
2 Mar 2023                                              20630.
3 Feb 2023                                              19338.
4 Jan 2023                                              22954.
5 Dec 2022                                              21870.
6 Nov 2022                                              18764.</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'summarytools'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tibble':

    view</code></pre>
</div>
</div>
<p>I am changing the name of the variable to MWH for brevity.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the variable to MWH</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MWH =</span> <span class="st">"conventional hydroelectric thousand megawatthours"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a table of some descriptive statistics:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">descr</span>(net_gen,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>,<span class="st">"med"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>), </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numerical variable(s) ignored: Month</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
net_gen$MWH  
N: 268  

                Mean   Std.Dev     Median        Min        Max
--------- ---------- --------- ---------- ---------- ----------
      MWH   22469.85   3972.41   22187.54   14638.18   32607.12</code></pre>
</div>
</div>
<p>I reorder the rows, so that the last observation (earliest date) is now the first one.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>net_gen<span class="ot">=</span>net_gen[<span class="fu">order</span>(<span class="fu">nrow</span>(net_gen)<span class="sc">:</span><span class="dv">1</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#changing to yearmonth format, naming Date, and indexing</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(MWH) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Power Generation"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/plotting net_gen-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we can observe a general plot of the Hydropower time series. There seems to be no significant trend and high seasonality.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(MWH, <span class="at">labels =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/seasonal plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As we can see here, there are spikes in the same months across all years, indicating high seasonality.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(MWH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot, where the blue line is the average across the same months, shows that on average there is a spike in the late spring to early summer. The trough is in fall.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(MWH)) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(season_year) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot we can see the average and the trend by month across different years. This plot shows the same spikes and troughs, but we can also observe that the months with the highest values have a downward trend. This means that even though the energy output in those months is still the highest, it diminishes.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(MWH)) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Ignoring unknown parameters: linewidth</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we see the STL decomposition components: trend, seasonality, and the remainder. There is high seasonality and some downward trend at the end of the series. The gray bars on the left show us that seasonality is very significant, whereas the general trend is less so.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(MWH) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot of Autocorrelation Figure also indicates high seasonality, since the the values 12 months apart have the highest correlation.</p>
<p>I estimate Naive, Seasonal Naive, Drift, and two ETS models. There are two ETS models because the optimal ETS() (the default one) seems to be underperforming, since it chooses no trend. I add ETS(A,Ad,M) since it seems to increase forecast accuracy.</p>
<p>A mable: 1 x 5 Naive Season_Naive Drift ETSopt ETS <model> <model> <model> <model> <model> 1 <naive> <snaive> <rw w="" drift=""> &lt;ETS(M,N,A)&gt; &lt;ETS(A,Ad,M)&gt;</rw></snaive></naive></model></model></model></model></model></p>
</section>
<section id="creating-training-and-testing-sets." class="level2">
<h2 class="anchored" data-anchor-id="creating-training-and-testing-sets.">Creating Training and Testing sets.</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#creating the var with the number of ~80% and ~20% of the observations and then splitting them accordingly.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">268</span><span class="sc">*</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 214</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>total_obs.net_gen <span class="ot">=</span> <span class="fu">dim</span>(net_gen)[<span class="dv">1</span>] <span class="co">#puts n of obs into total_obs</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>test_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">-</span> train_obs</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="ot">=</span> <span class="fu">head</span>(net_gen, train_obs)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>net_gen.test2 <span class="ot">=</span> <span class="fu">tail</span>(net_gen, test_obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="arima-estimation" class="level2">
<h2 class="anchored" data-anchor-id="arima-estimation">ARIMA Estimation</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(MWH,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(MWH, <span class="dv">12</span>),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(MWH, <span class="dv">12</span>) <span class="sc">|&gt;</span> <span class="fu">difference</span>(),</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#initial ARIMA estimation</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">auto =</span> <span class="fu">ARIMA</span>(MWH,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="co">#gives ARIMA more time to calculate</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">approx =</span> <span class="cn">FALSE</span>)) <span class="ot">-&gt;</span> arima.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(best$var.coef)): NaNs produced</code></pre>
</div>
</div>
<p>When estimating ARIMA models, it is important to check if the residuals look like white noise and have no patterns.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>arima.fit <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>(<span class="at">lag_max=</span><span class="dv">36</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/ARIMA residuals-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graphic of the residuals shows that residuals look pretty random, but there is a spike in acf that is statistically significant (crossed the blue line). I have to perform Ljung-Box test.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>arima.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
                       auto
                    &lt;model&gt;
1 &lt;ARIMA(2,0,0)(2,1,1)[12]&gt;</code></pre>
</div>
</div>
<p>A mable: 1 x 1 auto <model> 1 &lt;ARIMA(2,0,0)(2,1,1)[12]&gt;</model></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ljung-Box test</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(arima.fit) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">36</span>, <span class="at">dof =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .model lb_stat lb_pvalue
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 auto      28.9     0.575</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dof=p+q+P+Q from ARIMA(p,d,q)(P,D,Q)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The p-value is very large, which is exactly what we need to proceed and not care about autocorrelation in the residuals.</p>
</section>
<section id="seasonal-naive-ts-regression-and-ets" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-naive-ts-regression-and-ets">Seasonal Naive, TS Regression, and ETS</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>net_gen.fit2 <span class="ot">=</span> net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">Season_Naive =</span> <span class="fu">SNAIVE</span>(MWH),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">Regression =</span> <span class="fu">TSLM</span>(MWH <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">season</span>()),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ETSopt =</span> <span class="fu">ETS</span>(MWH), <span class="co">#automatic</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ETS =</span> <span class="fu">ETS</span>(MWH <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                      <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"Ad"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                      <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>))  <span class="co">#industry standard</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>net_gen.fit2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
  Season_Naive Regression        ETSopt           ETS
       &lt;model&gt;    &lt;model&gt;       &lt;model&gt;       &lt;model&gt;
1     &lt;SNAIVE&gt;     &lt;TSLM&gt; &lt;ETS(M,Ad,M)&gt; &lt;ETS(A,Ad,M)&gt;</code></pre>
</div>
</div>
<p>A mable: 1 x 4 Season_Naive Regression ETSopt ETS <model> <model> <model> <model> 1 <snaive> <tslm> &lt;ETS(M,Ad,M)&gt; &lt;ETS(A,Ad,M)&gt;</tslm></snaive></model></model></model></model></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(net_gen.fit2) <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, MAE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  .model        RMSE   MAE
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
1 Season_Naive 3201. 2437.
2 Regression   2421. 1856.
3 ETSopt       1687. 1296.
4 ETS          1685. 1290.</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(arima.fit) <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, MAE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .model  RMSE   MAE
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 auto   1698. 1243.</code></pre>
</div>
</div>
<p>We can see how closely the corresponding models predict the data within the Training set.</p>
<p>Now using these models I predict the next 54 months and compare the predictions to the withheld observations.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generating forecast</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="ot">=</span> net_gen.fit2 <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">54</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="ot">=</span> arima.fit <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">54</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">6.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.model = "") |&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(plot.caption = element_text(hjust = 5))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.model = "") |&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(plot.caption = element_text(hjust = 5))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Nov 2018 - Apr 2023, Monthly"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In these plots we can closely observe the ARIMA forecast is quite close, and even though some predicted observations are off, almost all actual values are within the 95% prediction interval.</p>
</section>
<section id="arima-with-external-regressors" class="level2">
<h2 class="anchored" data-anchor-id="arima-with-external-regressors">ARIMA with external Regressors</h2>
<p>I import the meteorological data on droughts in the US. I used the <a href="https://www.drought.gov/data-maps-tools/historical-drought-data-conditions-tool">Monthly Historical Drought Data</a>, because I assume that the general amount of water affects the aggregate power generated in that month. According to the <a href="https://www.drought.gov/historical-information?dataset=1&amp;selectedDateUSDM=20101221&amp;selectedDateSpi=19580601">National Integrated Drought Information System</a>, “SPI captures how observed precipitation (rain, hail, snow) deviates from the climatological average over a given time period—in this case, over the 9 months leading up to the selected date.”</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>SPI <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SPI.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1542 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): DATE
dbl (12): 0, D0, D1, D2, D3, D4, -9, W0, W1, W2, W3, W4

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>I prepare the meteorological dataset and combine it with the Hydropower one.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#finding the start date</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(SPI<span class="sc">$</span>DATE<span class="sc">==</span><span class="st">"d_20010101"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1273</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#matching the timeframe with that of Hydropower dataset</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>spi <span class="ot">=</span> SPI[<span class="dv">1273</span><span class="sc">:</span><span class="fu">nrow</span>(SPI), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>)]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>spi <span class="ot">=</span> spi[<span class="dv">1</span><span class="sc">:</span><span class="dv">268</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(spi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a preview of the resulting data:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(net_gen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 6 x 15 [1M]
  Month       MWH     Date DATE     D0    D1    D2    D3    D4  `-9`    W0    W1
  &lt;chr&gt;     &lt;dbl&gt;    &lt;mth&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Jan 2001 18852. 2001 Jan d_20…  40.8  28.2  12.7   7.3   2.8     0  18.4  11.3
2 Feb 2001 17473. 2001 Feb d_20…  37.3  27.1  13.9   8.5   4.5     0  23.9  14.5
3 Mar 2001 20477. 2001 Mar d_20…  37.6  25.9  11.8   7     3.8     0  17.5   8.6
4 Apr 2001 18013. 2001 Apr d_20…  37.5  26.8  13     7.3   3.1     0  22.8  13.6
5 May 2001 19176. 2001 May d_20…  36.4  27.6  14.4   8.2   3.4     0  29.7  20.6
6 Jun 2001 20728. 2001 Jun d_20…  36.8  29.5  16.4   9.3   3.3     0  36.2  25.1
# … with 3 more variables: W2 &lt;dbl&gt;, W3 &lt;dbl&gt;, W4 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>I again split my data in two parts: training and testing sets.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Split of the data</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>total_obs.net_gen <span class="ot">=</span> <span class="fu">dim</span>(net_gen)[<span class="dv">1</span>] <span class="co">#puts n of obs into total_obs</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>test_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">-</span> train_obs</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="ot">=</span> <span class="fu">head</span>(net_gen, train_obs)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>net_gen.test2 <span class="ot">=</span> <span class="fu">tail</span>(net_gen, test_obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we can see the percentage of the US territory that had experienced exceptional drought (D4).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(D4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I combine this plot with the hydropower time series, to see if there is any visual relationship.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(MWH, D4)) <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is hard to tell if there is any strong relationship between the two.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(MWH, W4)) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The same lack of obvious relationship can be said about the exceptionally wet %.</p>
<p>I look at the correlation between these variables.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"MWH"</span>,<span class="st">"D4"</span>,<span class="st">"W4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, no strong relationship, althought correlation with W4 is statistically significant.</p>
<p>I include all the independent variables in the regression, as well as the seasonality variable.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>net_gen.fit3 <span class="ot">=</span> net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(MWH <span class="sc">~</span> D0<span class="sc">+</span>D1<span class="sc">+</span>D2<span class="sc">+</span>D3<span class="sc">+</span>D4<span class="sc">+</span>W0<span class="sc">+</span>W1<span class="sc">+</span>W2<span class="sc">+</span>W3<span class="sc">+</span>W4<span class="sc">+</span><span class="fu">season</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>net_gen.fit3 <span class="sc">|&gt;</span> <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can clearly see here that the residuals look random, which is good.</p>
<p>I then create the future observations for the independent meteorological observations, by averaging the past values.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>net_gen_future <span class="ot">&lt;-</span> <span class="fu">new_data</span>(net_gen.train2, <span class="dv">54</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D0 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D0),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">D1 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D1),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">D2 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D2),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">D3 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D3),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">D4 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D4),</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">W0 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W0),</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">W1 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W1),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">W2 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W2),</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">W3 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W3),</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">W4 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#forecasting using the newly created observations</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="ot">=</span> net_gen.fit3 <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> net_gen_future)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2) <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA with Regressors Forecast"</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA with Regressors Forecast"</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Nov 2018 - Apr 2023, Monthly"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="accuracy-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="accuracy-evaluation">Accuracy Evaluation</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  .model     RMSE    ME   MPE
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 ARIMA.reg 2367. -112. -1.29</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  .model        RMSE     ME    MPE
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 ETS          3824. -2821. -13.4 
2 ETSopt       3863. -2877. -13.7 
3 Regression   2928. -1518.  -7.79
4 Season_Naive 3323. -1733.  -8.80</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  .model  RMSE    ME   MPE
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 auto   2638. -567. -3.41</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(acc.metric) <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(acc.metric) <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>acc.metric[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"ARIMA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.model, RMSE) <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSE, </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">2300</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(.model, <span class="fu">desc</span>(RMSE)), </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>.model,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(RMSE, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="sc">-</span><span class="dv">40</span>, <span class="at">nudge_y =</span> <span class="fl">0.2</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RMSE"</span>, <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span> rmse.plot</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>rmse.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/RMSE plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.model, MPE) <span class="sc">%&gt;%</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MPE, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">0</span>, </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(.model, <span class="fu">desc</span>(<span class="fu">abs</span>(MPE))), </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>.model,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(MPE, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="fl">0.5</span>, <span class="at">nudge_y =</span> <span class="fl">0.2</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"MPE"</span>) <span class="ot">-&gt;</span> mpe.plot</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>mpe.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/MPE plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(mpe.plot, rmse.plot,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate_figure</span>(<span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Forecast Accuracy Metrics"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ETS_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RMSE, MPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        .model     RMSE         ME        MPE
1    ARIMA.reg 2366.673  -111.5811  -1.292216
2        ARIMA 2638.318  -566.9333  -3.406917
3   Regression 2927.642 -1517.8173  -7.792288
4 Season_Naive 3322.937 -1733.2903  -8.803675
5          ETS 3823.632 -2821.2435 -13.413444
6       ETSopt 3863.003 -2876.8609 -13.679450</code></pre>
</div>
</div>
<p>As we can see from the evaluation metrics, the ARIMA with external regressors is the best performing model, in terms of both variance (RMSE) and bias (MPE).</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb92" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Forecasting Conventional Hydroelectric Power Generation in the US"</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">    freeze: auto</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abstract</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>In the efforts of reaching net zero emissions, renewable energy sources get more and more important. One of the cheapest and most sustainable sources of electricity is conventional hydroelectric power generation.</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>Even though, the US has been using conventional hydropower since 1950s, the industry is far from reaching its full potential. With thousands of yet to be used dams and an increasing pressure to switch to the renewable energy, the demand and investments are going to rise significantly. Meanwhile, high seasonality and annual variation of the hydropower output can produce more accurate forecasting models. Here Seasonal Naïve, Regression, ETS, ARIMA, and ARIMA with external regressors are tested using RMSE and MPE to see which model better predicts unseen data. Using the net monthly conventional hydropower generation dataset, I identified ARIMA as the best one for the role.</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>**Technical Note**:</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>A megawatt is a unit for measuring instantaneous power equivalent to one million watts or thousand kilowatts. A megawatt hour (MWh) is equal to 1,000 kilowatt hours (kWh).  It is equal to 1,000 kilowatts of energy consumed or produced in one hour.  It is a bit more than the amount of electricity used by an average US residential utility customer in one month (886 kWh), according to the EIA.</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Preparation and Analysis</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>I import the data on net energy generation of electricity from the conventional hydroelectric sources from the <span class="co">[</span><span class="ot">EIA website</span><span class="co">](https://www.eia.gov/electricity/data/browser/#/topic/0?agg=2,0,1&amp;fuel=05&amp;geo=vvvvvvvvvvvvo&amp;sec=g&amp;linechart=elec.gen.hyc-us-99.m&amp;columnchart=elec.gen.hyc-us-99.m&amp;map=elec.gen.hyc-us-99.m&amp;freq=m&amp;ctype=linechart&amp;ltype=pin&amp;rtype=s&amp;maptype=0&amp;rse=0&amp;pin=)</span>. The units are measured in thousand megawatt hours. The timeframe is from January 2001 through April 2023.</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Net_generation_United_States_all_sectors_monthly.csv"</span>, </span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>Here is a preview of the dataset:</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(net_gen)</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a>I am changing the name of the variable to MWH for brevity.</span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rename var to MWH}</span></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the variable to MWH</span></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MWH =</span> <span class="st">"conventional hydroelectric thousand megawatthours"</span>)</span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>Here is a table of some descriptive statistics:</span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a><span class="fu">descr</span>(net_gen,</span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>,<span class="st">"med"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>), </span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>I reorder the rows, so that the last observation (earliest date) is now the first one.</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r reorder the rows}</span></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>net_gen<span class="ot">=</span>net_gen[<span class="fu">order</span>(<span class="fu">nrow</span>(net_gen)<span class="sc">:</span><span class="dv">1</span>),]</span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r change to yearmonth and index}</span></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a><span class="co">#changing to yearmonth format, naming Date, and indexing</span></span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">|&gt;</span></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Date)</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plotting net_gen}</span></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(MWH) <span class="sc">+</span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Power Generation"</span>,</span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a>Here we can observe a general plot of the Hydropower time series. There seems to be no significant trend and high seasonality.</span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r seasonal plot}</span></span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(MWH, <span class="at">labels =</span> <span class="st">"both"</span>)</span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a>As we can see here, there are spikes in the same months across all years, indicating high seasonality.</span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(MWH)</span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>This plot, where the blue line is the average across the same months, shows that on average there is a spike in the late spring to early summer. The trough is in fall.</span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(MWH)) <span class="sc">|&gt;</span></span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(season_year) <span class="sc">+</span></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>))</span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a>In this plot we can see the average and the trend by month across different years. This plot shows the same spikes and troughs, but we can also observe that the months with the highest values have a downward trend. This means that even though the energy output in those months is still the highest, it diminishes.</span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-132"><a href="#cb92-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(MWH)) <span class="sc">|&gt;</span></span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>Here we see the STL decomposition components: trend, seasonality, and the remainder. There is high seasonality and some downward trend at the end of the series. The gray bars on the left show us that seasonality is very significant, whereas the general trend is less so.</span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-144"><a href="#cb92-144" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(MWH) <span class="sc">|&gt;</span></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a>The plot of Autocorrelation Figure also indicates high seasonality, since the the values 12 months apart have the highest correlation.</span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>I estimate Naive, Seasonal Naive, Drift, and two ETS models. There are two ETS models because the optimal ETS() (the default one) seems to be underperforming, since it chooses no trend. I add ETS(A,Ad,M) since it seems to increase forecast accuracy. </span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>A mable: 1 x 5</span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a>    Naive Season_Naive         Drift       ETSopt           ETS</span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;model&gt;</span>      <span class="kw">&lt;model&gt;</span>       <span class="kw">&lt;model&gt;</span>      <span class="kw">&lt;model&gt;</span>       <span class="kw">&lt;model&gt;</span></span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a>1 <span class="kw">&lt;NAIVE&gt;</span>     <span class="kw">&lt;SNAIVE&gt;</span> <span class="kw">&lt;RW</span> <span class="er">w/</span> <span class="er">drift</span><span class="kw">&gt;</span> &lt;ETS(M,N,A)&gt; &lt;ETS(A,Ad,M)&gt;</span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating Training and Testing sets.</span></span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 80/20 split}</span></span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a><span class="co">#creating the var with the number of ~80% and ~20% of the observations and then splitting them accordingly.</span></span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">268</span><span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a>total_obs.net_gen <span class="ot">=</span> <span class="fu">dim</span>(net_gen)[<span class="dv">1</span>] <span class="co">#puts n of obs into total_obs</span></span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a>test_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">-</span> train_obs</span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="ot">=</span> <span class="fu">head</span>(net_gen, train_obs)</span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a>net_gen.test2 <span class="ot">=</span> <span class="fu">tail</span>(net_gen, test_obs)</span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARIMA Estimation</span></span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-174"><a href="#cb92-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-175"><a href="#cb92-175" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(MWH,</span>
<span id="cb92-176"><a href="#cb92-176" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span>
<span id="cb92-177"><a href="#cb92-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-178"><a href="#cb92-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(MWH, <span class="dv">12</span>),</span>
<span id="cb92-184"><a href="#cb92-184" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span>
<span id="cb92-185"><a href="#cb92-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-190"><a href="#cb92-190" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(MWH, <span class="dv">12</span>) <span class="sc">|&gt;</span> <span class="fu">difference</span>(),</span>
<span id="cb92-191"><a href="#cb92-191" aria-hidden="true" tabindex="-1"></a>                     <span class="at">plot_type=</span><span class="st">'partial'</span>, <span class="at">lag_max =</span> <span class="dv">24</span>)</span>
<span id="cb92-192"><a href="#cb92-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial ARIMA estimation}</span></span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a><span class="co">#initial ARIMA estimation</span></span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">auto =</span> <span class="fu">ARIMA</span>(MWH,</span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="co">#gives ARIMA more time to calculate</span></span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a>                     <span class="at">approx =</span> <span class="cn">FALSE</span>)) <span class="ot">-&gt;</span> arima.fit</span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a>When estimating ARIMA models, it is important to check if the residuals look like white noise and have no patterns.</span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ARIMA residuals}</span></span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a>arima.fit <span class="sc">|&gt;</span></span>
<span id="cb92-206"><a href="#cb92-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>(<span class="at">lag_max=</span><span class="dv">36</span>)</span>
<span id="cb92-207"><a href="#cb92-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-208"><a href="#cb92-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-209"><a href="#cb92-209" aria-hidden="true" tabindex="-1"></a>The graphic of the residuals shows that residuals look pretty random, but there is a spike in acf that is statistically significant (crossed the blue line). I have to perform Ljung-Box test.</span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a>arima.fit</span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-216"><a href="#cb92-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-217"><a href="#cb92-217" aria-hidden="true" tabindex="-1"></a>A mable: 1 x 1</span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a>                       auto</span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;model&gt;</span></span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a>1 &lt;ARIMA(2,0,0)(2,1,1)<span class="co">[</span><span class="ot">12</span><span class="co">]</span>&gt;</span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a><span class="co">#Ljung-Box test</span></span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(arima.fit) <span class="sc">|&gt;</span></span>
<span id="cb92-227"><a href="#cb92-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">36</span>, <span class="at">dof =</span> <span class="dv">5</span>)</span>
<span id="cb92-228"><a href="#cb92-228" aria-hidden="true" tabindex="-1"></a><span class="co">#dof=p+q+P+Q from ARIMA(p,d,q)(P,D,Q)</span></span>
<span id="cb92-229"><a href="#cb92-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-230"><a href="#cb92-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a>The p-value is very large, which is exactly what we need to proceed and not care about autocorrelation in the residuals.</span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Seasonal Naive, TS Regression, and ETS</span></span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Other models Estimation}</span></span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a>net_gen.fit2 <span class="ot">=</span> net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">Season_Naive =</span> <span class="fu">SNAIVE</span>(MWH),</span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">Regression =</span> <span class="fu">TSLM</span>(MWH <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">season</span>()),</span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a>        <span class="at">ETSopt =</span> <span class="fu">ETS</span>(MWH), <span class="co">#automatic</span></span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">ETS =</span> <span class="fu">ETS</span>(MWH <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>)</span>
<span id="cb92-242"><a href="#cb92-242" aria-hidden="true" tabindex="-1"></a>                      <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"Ad"</span>)</span>
<span id="cb92-243"><a href="#cb92-243" aria-hidden="true" tabindex="-1"></a>                      <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>))  <span class="co">#industry standard</span></span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb92-245"><a href="#cb92-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-246"><a href="#cb92-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-249"><a href="#cb92-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-250"><a href="#cb92-250" aria-hidden="true" tabindex="-1"></a>net_gen.fit2</span>
<span id="cb92-251"><a href="#cb92-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-252"><a href="#cb92-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-253"><a href="#cb92-253" aria-hidden="true" tabindex="-1"></a>A mable: 1 x 4</span>
<span id="cb92-254"><a href="#cb92-254" aria-hidden="true" tabindex="-1"></a>  Season_Naive Regression        ETSopt           ETS</span>
<span id="cb92-255"><a href="#cb92-255" aria-hidden="true" tabindex="-1"></a>       <span class="kw">&lt;model&gt;</span>    <span class="kw">&lt;model&gt;</span>       <span class="kw">&lt;model&gt;</span>       <span class="kw">&lt;model&gt;</span></span>
<span id="cb92-256"><a href="#cb92-256" aria-hidden="true" tabindex="-1"></a>1     <span class="kw">&lt;SNAIVE&gt;</span>     <span class="kw">&lt;TSLM&gt;</span> &lt;ETS(M,Ad,M)&gt; &lt;ETS(A,Ad,M)&gt;</span>
<span id="cb92-257"><a href="#cb92-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-260"><a href="#cb92-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-261"><a href="#cb92-261" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(net_gen.fit2) <span class="sc">|&gt;</span></span>
<span id="cb92-262"><a href="#cb92-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, MAE)</span>
<span id="cb92-263"><a href="#cb92-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-264"><a href="#cb92-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-267"><a href="#cb92-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-268"><a href="#cb92-268" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(arima.fit) <span class="sc">|&gt;</span></span>
<span id="cb92-269"><a href="#cb92-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, MAE)</span>
<span id="cb92-270"><a href="#cb92-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-271"><a href="#cb92-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-272"><a href="#cb92-272" aria-hidden="true" tabindex="-1"></a>We can see how closely the corresponding models predict the data within the Training set.</span>
<span id="cb92-273"><a href="#cb92-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-274"><a href="#cb92-274" aria-hidden="true" tabindex="-1"></a>Now using these models I predict the next 54 months and compare the predictions to the withheld observations.</span>
<span id="cb92-275"><a href="#cb92-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-276"><a href="#cb92-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forecast generation}</span></span>
<span id="cb92-277"><a href="#cb92-277" aria-hidden="true" tabindex="-1"></a><span class="co">#generating forecast</span></span>
<span id="cb92-278"><a href="#cb92-278" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="ot">=</span> net_gen.fit2 <span class="sc">|&gt;</span></span>
<span id="cb92-279"><a href="#cb92-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">54</span>)</span>
<span id="cb92-280"><a href="#cb92-280" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="ot">=</span> arima.fit <span class="sc">|&gt;</span></span>
<span id="cb92-281"><a href="#cb92-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">54</span>)</span>
<span id="cb92-282"><a href="#cb92-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-283"><a href="#cb92-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-286"><a href="#cb92-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-287"><a href="#cb92-287" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb92-288"><a href="#cb92-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb92-289"><a href="#cb92-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-290"><a href="#cb92-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast"</span>,</span>
<span id="cb92-291"><a href="#cb92-291" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-292"><a href="#cb92-292" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-293"><a href="#cb92-293" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-294"><a href="#cb92-294" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-295"><a href="#cb92-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-296"><a href="#cb92-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">6.5</span>))</span>
<span id="cb92-297"><a href="#cb92-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-298"><a href="#cb92-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-301"><a href="#cb92-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-302"><a href="#cb92-302" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb92-303"><a href="#cb92-303" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.model = "") |&gt;</span></span>
<span id="cb92-304"><a href="#cb92-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb92-305"><a href="#cb92-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-306"><a href="#cb92-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast"</span>,</span>
<span id="cb92-307"><a href="#cb92-307" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-308"><a href="#cb92-308" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-309"><a href="#cb92-309" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-310"><a href="#cb92-310" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-311"><a href="#cb92-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-312"><a href="#cb92-312" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(plot.caption = element_text(hjust = 5))</span></span>
<span id="cb92-313"><a href="#cb92-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-314"><a href="#cb92-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-317"><a href="#cb92-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-318"><a href="#cb92-318" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb92-319"><a href="#cb92-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2) <span class="sc">+</span></span>
<span id="cb92-320"><a href="#cb92-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-321"><a href="#cb92-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb92-322"><a href="#cb92-322" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb92-323"><a href="#cb92-323" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-324"><a href="#cb92-324" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-325"><a href="#cb92-325" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-326"><a href="#cb92-326" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-327"><a href="#cb92-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-328"><a href="#cb92-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-329"><a href="#cb92-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-332"><a href="#cb92-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-333"><a href="#cb92-333" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb92-334"><a href="#cb92-334" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.model = "") |&gt;</span></span>
<span id="cb92-335"><a href="#cb92-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2) <span class="sc">+</span></span>
<span id="cb92-336"><a href="#cb92-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-337"><a href="#cb92-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb92-338"><a href="#cb92-338" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb92-339"><a href="#cb92-339" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-340"><a href="#cb92-340" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-341"><a href="#cb92-341" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-342"><a href="#cb92-342" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-343"><a href="#cb92-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-344"><a href="#cb92-344" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(plot.caption = element_text(hjust = 5))</span></span>
<span id="cb92-345"><a href="#cb92-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-346"><a href="#cb92-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-349"><a href="#cb92-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-350"><a href="#cb92-350" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb92-351"><a href="#cb92-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb92-352"><a href="#cb92-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-353"><a href="#cb92-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb92-354"><a href="#cb92-354" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA Forecast"</span>,</span>
<span id="cb92-355"><a href="#cb92-355" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Nov 2018 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-356"><a href="#cb92-356" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-357"><a href="#cb92-357" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-358"><a href="#cb92-358" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-359"><a href="#cb92-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-360"><a href="#cb92-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-361"><a href="#cb92-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-362"><a href="#cb92-362" aria-hidden="true" tabindex="-1"></a>In these plots we can closely observe the ARIMA forecast is quite close, and even though some predicted observations are off, almost all actual values are within the 95% prediction interval.</span>
<span id="cb92-363"><a href="#cb92-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-364"><a href="#cb92-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARIMA with external Regressors</span></span>
<span id="cb92-365"><a href="#cb92-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-366"><a href="#cb92-366" aria-hidden="true" tabindex="-1"></a>I import the meteorological data on droughts in the US. I used the <span class="co">[</span><span class="ot">Monthly Historical Drought Data</span><span class="co">](https://www.drought.gov/data-maps-tools/historical-drought-data-conditions-tool)</span>, because I assume that the general amount of water affects the aggregate power generated in that month. According to the <span class="co">[</span><span class="ot">National Integrated Drought Information System</span><span class="co">](https://www.drought.gov/historical-information?dataset=1&amp;selectedDateUSDM=20101221&amp;selectedDateSpi=19580601)</span>, "SPI captures how observed precipitation (rain, hail, snow) deviates from the climatological average over a given time period—in this case, over the 9 months leading up to the selected date."</span>
<span id="cb92-367"><a href="#cb92-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-370"><a href="#cb92-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-371"><a href="#cb92-371" aria-hidden="true" tabindex="-1"></a>SPI <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SPI.csv"</span>)</span>
<span id="cb92-372"><a href="#cb92-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-373"><a href="#cb92-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-374"><a href="#cb92-374" aria-hidden="true" tabindex="-1"></a>I prepare the meteorological dataset and combine it with the Hydropower one.</span>
<span id="cb92-375"><a href="#cb92-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-378"><a href="#cb92-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-379"><a href="#cb92-379" aria-hidden="true" tabindex="-1"></a><span class="co">#finding the start date</span></span>
<span id="cb92-380"><a href="#cb92-380" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(SPI<span class="sc">$</span>DATE<span class="sc">==</span><span class="st">"d_20010101"</span>)</span>
<span id="cb92-381"><a href="#cb92-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-382"><a href="#cb92-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-385"><a href="#cb92-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-386"><a href="#cb92-386" aria-hidden="true" tabindex="-1"></a><span class="co">#matching the timeframe with that of Hydropower dataset</span></span>
<span id="cb92-387"><a href="#cb92-387" aria-hidden="true" tabindex="-1"></a>spi <span class="ot">=</span> SPI[<span class="dv">1273</span><span class="sc">:</span><span class="fu">nrow</span>(SPI), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>)]</span>
<span id="cb92-388"><a href="#cb92-388" aria-hidden="true" tabindex="-1"></a>spi <span class="ot">=</span> spi[<span class="dv">1</span><span class="sc">:</span><span class="dv">268</span>,]</span>
<span id="cb92-389"><a href="#cb92-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-390"><a href="#cb92-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-393"><a href="#cb92-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-394"><a href="#cb92-394" aria-hidden="true" tabindex="-1"></a>net_gen <span class="ot">=</span> net_gen <span class="sc">%&gt;%</span> </span>
<span id="cb92-395"><a href="#cb92-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(spi)</span>
<span id="cb92-396"><a href="#cb92-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-397"><a href="#cb92-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-398"><a href="#cb92-398" aria-hidden="true" tabindex="-1"></a>Here is a preview of the resulting data:</span>
<span id="cb92-399"><a href="#cb92-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-402"><a href="#cb92-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-403"><a href="#cb92-403" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(net_gen)</span>
<span id="cb92-404"><a href="#cb92-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-405"><a href="#cb92-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-406"><a href="#cb92-406" aria-hidden="true" tabindex="-1"></a>I again split my data in two parts: training and testing sets.</span>
<span id="cb92-407"><a href="#cb92-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-408"><a href="#cb92-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Second Split}</span></span>
<span id="cb92-409"><a href="#cb92-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Split of the data</span></span>
<span id="cb92-410"><a href="#cb92-410" aria-hidden="true" tabindex="-1"></a>total_obs.net_gen <span class="ot">=</span> <span class="fu">dim</span>(net_gen)[<span class="dv">1</span>] <span class="co">#puts n of obs into total_obs</span></span>
<span id="cb92-411"><a href="#cb92-411" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb92-412"><a href="#cb92-412" aria-hidden="true" tabindex="-1"></a>test_obs <span class="ot">=</span> total_obs.net_gen <span class="sc">-</span> train_obs</span>
<span id="cb92-413"><a href="#cb92-413" aria-hidden="true" tabindex="-1"></a>net_gen.train2 <span class="ot">=</span> <span class="fu">head</span>(net_gen, train_obs)</span>
<span id="cb92-414"><a href="#cb92-414" aria-hidden="true" tabindex="-1"></a>net_gen.test2 <span class="ot">=</span> <span class="fu">tail</span>(net_gen, test_obs)</span>
<span id="cb92-415"><a href="#cb92-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-416"><a href="#cb92-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-417"><a href="#cb92-417" aria-hidden="true" tabindex="-1"></a>Here we can see the percentage of the US territory that had experienced exceptional drought (D4).</span>
<span id="cb92-418"><a href="#cb92-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-421"><a href="#cb92-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-422"><a href="#cb92-422" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span> </span>
<span id="cb92-423"><a href="#cb92-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(D4)</span>
<span id="cb92-424"><a href="#cb92-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-425"><a href="#cb92-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-426"><a href="#cb92-426" aria-hidden="true" tabindex="-1"></a>I combine this plot with the hydropower time series, to see if there is any visual relationship.</span>
<span id="cb92-427"><a href="#cb92-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-430"><a href="#cb92-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-431"><a href="#cb92-431" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-432"><a href="#cb92-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(MWH, D4)) <span class="sc">|&gt;</span></span>
<span id="cb92-433"><a href="#cb92-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb92-434"><a href="#cb92-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb92-435"><a href="#cb92-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb92-436"><a href="#cb92-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-437"><a href="#cb92-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-438"><a href="#cb92-438" aria-hidden="true" tabindex="-1"></a>It is hard to tell if there is any strong relationship between the two.</span>
<span id="cb92-439"><a href="#cb92-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-442"><a href="#cb92-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-443"><a href="#cb92-443" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-444"><a href="#cb92-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(MWH, W4)) <span class="sc">|&gt;</span></span>
<span id="cb92-445"><a href="#cb92-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb92-446"><a href="#cb92-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb92-447"><a href="#cb92-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb92-448"><a href="#cb92-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-449"><a href="#cb92-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-450"><a href="#cb92-450" aria-hidden="true" tabindex="-1"></a>The same lack of obvious relationship can be said about the exceptionally wet %.</span>
<span id="cb92-451"><a href="#cb92-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-452"><a href="#cb92-452" aria-hidden="true" tabindex="-1"></a>I look at the correlation between these variables.</span>
<span id="cb92-453"><a href="#cb92-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-456"><a href="#cb92-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-457"><a href="#cb92-457" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb92-458"><a href="#cb92-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-459"><a href="#cb92-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-462"><a href="#cb92-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-463"><a href="#cb92-463" aria-hidden="true" tabindex="-1"></a>net_gen <span class="sc">|&gt;</span></span>
<span id="cb92-464"><a href="#cb92-464" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"MWH"</span>,<span class="st">"D4"</span>,<span class="st">"W4"</span>))</span>
<span id="cb92-465"><a href="#cb92-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-466"><a href="#cb92-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-467"><a href="#cb92-467" aria-hidden="true" tabindex="-1"></a>Again, no strong relationship, althought correlation with W4 is statistically significant.</span>
<span id="cb92-468"><a href="#cb92-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-469"><a href="#cb92-469" aria-hidden="true" tabindex="-1"></a>I include all the independent variables in the regression, as well as the seasonality variable.</span>
<span id="cb92-470"><a href="#cb92-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-473"><a href="#cb92-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-474"><a href="#cb92-474" aria-hidden="true" tabindex="-1"></a>net_gen.fit3 <span class="ot">=</span> net_gen.train2 <span class="sc">|&gt;</span></span>
<span id="cb92-475"><a href="#cb92-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ARIMA.reg =</span> <span class="fu">ARIMA</span>(MWH <span class="sc">~</span> D0<span class="sc">+</span>D1<span class="sc">+</span>D2<span class="sc">+</span>D3<span class="sc">+</span>D4<span class="sc">+</span>W0<span class="sc">+</span>W1<span class="sc">+</span>W2<span class="sc">+</span>W3<span class="sc">+</span>W4<span class="sc">+</span><span class="fu">season</span>()))</span>
<span id="cb92-476"><a href="#cb92-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-477"><a href="#cb92-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-480"><a href="#cb92-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-481"><a href="#cb92-481" aria-hidden="true" tabindex="-1"></a>net_gen.fit3 <span class="sc">|&gt;</span> <span class="fu">gg_tsresiduals</span>()</span>
<span id="cb92-482"><a href="#cb92-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-483"><a href="#cb92-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-484"><a href="#cb92-484" aria-hidden="true" tabindex="-1"></a>We can clearly see here that the residuals look random, which is good.</span>
<span id="cb92-485"><a href="#cb92-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-486"><a href="#cb92-486" aria-hidden="true" tabindex="-1"></a>I then create the future observations for the independent meteorological observations, by averaging the past values.</span>
<span id="cb92-487"><a href="#cb92-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-490"><a href="#cb92-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-491"><a href="#cb92-491" aria-hidden="true" tabindex="-1"></a>net_gen_future <span class="ot">&lt;-</span> <span class="fu">new_data</span>(net_gen.train2, <span class="dv">54</span>) <span class="sc">|&gt;</span></span>
<span id="cb92-492"><a href="#cb92-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D0 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D0),</span>
<span id="cb92-493"><a href="#cb92-493" aria-hidden="true" tabindex="-1"></a>         <span class="at">D1 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D1),</span>
<span id="cb92-494"><a href="#cb92-494" aria-hidden="true" tabindex="-1"></a>         <span class="at">D2 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D2),</span>
<span id="cb92-495"><a href="#cb92-495" aria-hidden="true" tabindex="-1"></a>         <span class="at">D3 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D3),</span>
<span id="cb92-496"><a href="#cb92-496" aria-hidden="true" tabindex="-1"></a>         <span class="at">D4 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>D4),</span>
<span id="cb92-497"><a href="#cb92-497" aria-hidden="true" tabindex="-1"></a>         <span class="at">W0 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W0),</span>
<span id="cb92-498"><a href="#cb92-498" aria-hidden="true" tabindex="-1"></a>         <span class="at">W1 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W1),</span>
<span id="cb92-499"><a href="#cb92-499" aria-hidden="true" tabindex="-1"></a>         <span class="at">W2 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W2),</span>
<span id="cb92-500"><a href="#cb92-500" aria-hidden="true" tabindex="-1"></a>         <span class="at">W3 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W3),</span>
<span id="cb92-501"><a href="#cb92-501" aria-hidden="true" tabindex="-1"></a>         <span class="at">W4 =</span> <span class="fu">mean</span>(net_gen<span class="sc">$</span>W4))</span>
<span id="cb92-502"><a href="#cb92-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-503"><a href="#cb92-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-506"><a href="#cb92-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-507"><a href="#cb92-507" aria-hidden="true" tabindex="-1"></a><span class="co">#forecasting using the newly created observations</span></span>
<span id="cb92-508"><a href="#cb92-508" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="ot">=</span> net_gen.fit3 <span class="sc">|&gt;</span></span>
<span id="cb92-509"><a href="#cb92-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> net_gen_future)</span>
<span id="cb92-510"><a href="#cb92-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-511"><a href="#cb92-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-514"><a href="#cb92-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-515"><a href="#cb92-515" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb92-516"><a href="#cb92-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.train2) <span class="sc">+</span></span>
<span id="cb92-517"><a href="#cb92-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-518"><a href="#cb92-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation Forecast</span></span>
<span id="cb92-519"><a href="#cb92-519" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA with Regressors Forecast"</span>,</span>
<span id="cb92-520"><a href="#cb92-520" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Jan 2001 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-521"><a href="#cb92-521" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-522"><a href="#cb92-522" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-523"><a href="#cb92-523" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-524"><a href="#cb92-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-525"><a href="#cb92-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-526"><a href="#cb92-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-529"><a href="#cb92-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-530"><a href="#cb92-530" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb92-531"><a href="#cb92-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(net_gen.test2) <span class="sc">+</span></span>
<span id="cb92-532"><a href="#cb92-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb92-533"><a href="#cb92-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Net Conventional Hydroelectric Generation</span></span>
<span id="cb92-534"><a href="#cb92-534" aria-hidden="true" tabindex="-1"></a><span class="st">ARIMA with Regressors Forecast"</span>,</span>
<span id="cb92-535"><a href="#cb92-535" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Nov 2018 - Apr 2023, Monthly"</span>,</span>
<span id="cb92-536"><a href="#cb92-536" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Thousand Megawatthours"</span>,</span>
<span id="cb92-537"><a href="#cb92-537" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb92-538"><a href="#cb92-538" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: U.S. Energy Information Administration"</span>) <span class="sc">+</span></span>
<span id="cb92-539"><a href="#cb92-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb92-540"><a href="#cb92-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-541"><a href="#cb92-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-542"><a href="#cb92-542" aria-hidden="true" tabindex="-1"></a><span class="fu">## Accuracy Evaluation</span></span>
<span id="cb92-543"><a href="#cb92-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-546"><a href="#cb92-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-547"><a href="#cb92-547" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb92-548"><a href="#cb92-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-549"><a href="#cb92-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span>
<span id="cb92-550"><a href="#cb92-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-551"><a href="#cb92-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-554"><a href="#cb92-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-555"><a href="#cb92-555" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb92-556"><a href="#cb92-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-557"><a href="#cb92-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span>
<span id="cb92-558"><a href="#cb92-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-559"><a href="#cb92-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-562"><a href="#cb92-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-563"><a href="#cb92-563" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb92-564"><a href="#cb92-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-565"><a href="#cb92-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE)</span>
<span id="cb92-566"><a href="#cb92-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-567"><a href="#cb92-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-568"><a href="#cb92-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating accuracy metrics df}</span></span>
<span id="cb92-569"><a href="#cb92-569" aria-hidden="true" tabindex="-1"></a>net_gen.fc2 <span class="sc">|&gt;</span></span>
<span id="cb92-570"><a href="#cb92-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-571"><a href="#cb92-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb92-572"><a href="#cb92-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb92-573"><a href="#cb92-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-574"><a href="#cb92-574" aria-hidden="true" tabindex="-1"></a>net_gen.fc2.arima <span class="sc">|&gt;</span></span>
<span id="cb92-575"><a href="#cb92-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-576"><a href="#cb92-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb92-577"><a href="#cb92-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb92-578"><a href="#cb92-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(acc.metric) <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb92-579"><a href="#cb92-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-580"><a href="#cb92-580" aria-hidden="true" tabindex="-1"></a>net_gen.fc3 <span class="sc">|&gt;</span></span>
<span id="cb92-581"><a href="#cb92-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(net_gen) <span class="sc">|&gt;</span></span>
<span id="cb92-582"><a href="#cb92-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, RMSE, ME, MPE) <span class="sc">|&gt;</span></span>
<span id="cb92-583"><a href="#cb92-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb92-584"><a href="#cb92-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(acc.metric) <span class="ot">-&gt;</span> acc.metric</span>
<span id="cb92-585"><a href="#cb92-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-586"><a href="#cb92-586" aria-hidden="true" tabindex="-1"></a>acc.metric[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"ARIMA"</span></span>
<span id="cb92-587"><a href="#cb92-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-588"><a href="#cb92-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-589"><a href="#cb92-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r RMSE plot}</span></span>
<span id="cb92-590"><a href="#cb92-590" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">%&gt;%</span> </span>
<span id="cb92-591"><a href="#cb92-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.model, RMSE) <span class="sc">%&gt;%</span> </span>
<span id="cb92-592"><a href="#cb92-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSE, </span>
<span id="cb92-593"><a href="#cb92-593" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">2300</span>, </span>
<span id="cb92-594"><a href="#cb92-594" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(.model, <span class="fu">desc</span>(RMSE)), </span>
<span id="cb92-595"><a href="#cb92-595" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>.model,</span>
<span id="cb92-596"><a href="#cb92-596" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(RMSE, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb92-597"><a href="#cb92-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-598"><a href="#cb92-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb92-599"><a href="#cb92-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-600"><a href="#cb92-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="sc">-</span><span class="dv">40</span>, <span class="at">nudge_y =</span> <span class="fl">0.2</span>,</span>
<span id="cb92-601"><a href="#cb92-601" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb92-602"><a href="#cb92-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb92-603"><a href="#cb92-603" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb92-604"><a href="#cb92-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RMSE"</span>, <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span> rmse.plot</span>
<span id="cb92-605"><a href="#cb92-605" aria-hidden="true" tabindex="-1"></a>rmse.plot</span>
<span id="cb92-606"><a href="#cb92-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-607"><a href="#cb92-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-608"><a href="#cb92-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MPE plot}</span></span>
<span id="cb92-609"><a href="#cb92-609" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">%&gt;%</span> </span>
<span id="cb92-610"><a href="#cb92-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.model, MPE) <span class="sc">%&gt;%</span> </span>
<span id="cb92-611"><a href="#cb92-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MPE, </span>
<span id="cb92-612"><a href="#cb92-612" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">0</span>, </span>
<span id="cb92-613"><a href="#cb92-613" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(.model, <span class="fu">desc</span>(<span class="fu">abs</span>(MPE))), </span>
<span id="cb92-614"><a href="#cb92-614" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>.model,</span>
<span id="cb92-615"><a href="#cb92-615" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(MPE, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb92-616"><a href="#cb92-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-617"><a href="#cb92-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb92-618"><a href="#cb92-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-619"><a href="#cb92-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="fl">0.5</span>, <span class="at">nudge_y =</span> <span class="fl">0.2</span>,</span>
<span id="cb92-620"><a href="#cb92-620" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb92-621"><a href="#cb92-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"MPE"</span>) <span class="ot">-&gt;</span> mpe.plot</span>
<span id="cb92-622"><a href="#cb92-622" aria-hidden="true" tabindex="-1"></a>mpe.plot</span>
<span id="cb92-623"><a href="#cb92-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-624"><a href="#cb92-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-625"><a href="#cb92-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ggpubr for ggarrange}</span></span>
<span id="cb92-626"><a href="#cb92-626" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb92-627"><a href="#cb92-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-628"><a href="#cb92-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-631"><a href="#cb92-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-632"><a href="#cb92-632" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(mpe.plot, rmse.plot,</span>
<span id="cb92-633"><a href="#cb92-633" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb92-634"><a href="#cb92-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate_figure</span>(<span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Forecast Accuracy Metrics"</span>))</span>
<span id="cb92-635"><a href="#cb92-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-636"><a href="#cb92-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-637"><a href="#cb92-637" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb92-638"><a href="#cb92-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-641"><a href="#cb92-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-642"><a href="#cb92-642" aria-hidden="true" tabindex="-1"></a>acc.metric <span class="sc">|&gt;</span></span>
<span id="cb92-643"><a href="#cb92-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RMSE, MPE)</span>
<span id="cb92-644"><a href="#cb92-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-645"><a href="#cb92-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-646"><a href="#cb92-646" aria-hidden="true" tabindex="-1"></a>As we can see from the evaluation metrics, the ARIMA with external regressors is the best performing model, in terms of both variance (RMSE) and bias (MPE).</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>