<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dimash Alchinbayev - Procurement Contracts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dimash Alchinbayev</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#stats" id="toc-stats" class="nav-link" data-scroll-target="#stats">Stats</a></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">Cleaning</a></li>
  <li><a href="#analysis-of-variables" id="toc-analysis-of-variables" class="nav-link" data-scroll-target="#analysis-of-variables">Analysis of Variables</a></li>
  <li><a href="#plot" id="toc-plot" class="nav-link" data-scroll-target="#plot">Plot</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a></li>
  <li><a href="#ridge-regression-with-grid-search" id="toc-ridge-regression-with-grid-search" class="nav-link" data-scroll-target="#ridge-regression-with-grid-search">Ridge Regression with Grid Search</a></li>
  <li><a href="#corrected-ridge-without-cri_wb" id="toc-corrected-ridge-without-cri_wb" class="nav-link" data-scroll-target="#corrected-ridge-without-cri_wb">Corrected Ridge without cri_wb</a></li>
  <li><a href="#logit-for-contract-value-categories" id="toc-logit-for-contract-value-categories" class="nav-link" data-scroll-target="#logit-for-contract-value-categories">Logit for contract value categories</a></li>
  <li><a href="#knn" id="toc-knn" class="nav-link" data-scroll-target="#knn">KNN</a></li>
  <li><a href="#beyond-linearity-splines" id="toc-beyond-linearity-splines" class="nav-link" data-scroll-target="#beyond-linearity-splines">Beyond Linearity: Splines</a></li>
  <li><a href="#regression-tree" id="toc-regression-tree" class="nav-link" data-scroll-target="#regression-tree">Regression Tree</a></li>
  <li><a href="#tuning-regression-tree" id="toc-tuning-regression-tree" class="nav-link" data-scroll-target="#tuning-regression-tree">Tuning Regression Tree</a></li>
  <li><a href="#bagging" id="toc-bagging" class="nav-link" data-scroll-target="#bagging">Bagging</a></li>
  <li><a href="#support-vector-machine" id="toc-support-vector-machine" class="nav-link" data-scroll-target="#support-vector-machine">Support Vector Machine</a></li>
  <li><a href="#comparing-rmse-sse-prediction-rate-and-conclusion" id="toc-comparing-rmse-sse-prediction-rate-and-conclusion" class="nav-link" data-scroll-target="#comparing-rmse-sse-prediction-rate-and-conclusion">Comparing RMSE, SSE, &amp; Prediction rate and Conclusion</a></li>
  <li><a href="#further-discussion" id="toc-further-discussion" class="nav-link" data-scroll-target="#further-discussion">Further discussion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Procurement Contracts</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>I use ML techniques to predict and classify the value of the Procurement Contracts.</p>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Procurement <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Procurement.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(Procurement)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ tibble  3.1.8     ✔ purrr   1.0.1
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
Loading required package: Ecfun


Attaching package: 'Ecfun'


The following object is masked from 'package:base':

    sign



Attaching package: 'Ecdat'


The following object is masked from 'package:datasets':

    Orange


Loading required package: Matrix


Attaching package: 'Matrix'


The following objects are masked from 'package:tidyr':

    expand, pack, unpack


Loaded glmnet 4.1-6</code></pre>
</div>
</div>
</section>
<section id="stats" class="level2">
<h2 class="anchored" data-anchor-id="stats">Stats</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    0.00    0.25    0.34    0.50    1.00   86535 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3489315</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 161465</code></pre>
</div>
</div>
</section>
<section id="cleaning" class="level2">
<h2 class="anchored" data-anchor-id="cleaning">Cleaning</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> country_wb_string    country             WBCode          country_iso3      
 Length:161465      Length:161465      Length:161465      Length:161465     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 country_iso2           fyear           year         region         
 Length:161465      Min.   :1998   Min.   :1997   Length:161465     
 Class :character   1st Qu.:2000   1st Qu.:1999   Class :character  
 Mode  :character   Median :2002   Median :2001   Mode  :character  
                    Mean   :2002   Mean   :2002                     
                    3rd Qu.:2004   3rd Qu.:2004                     
                    Max.   :2009   Max.   :2009                     
                                                                    
    pr_id             pr_name          pr_loannumber      cft_methodtype    
 Length:161465      Length:161465      Length:161465      Length:161465     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
  cft_sector          ca_type            ca_title            ca_id          
 Length:161465      Length:161465      Length:161465      Length:161465     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
  ca_nrbidsrec    ca_nrbidscons      ca_contract_value_original
 Min.   :  1.00   Length:161465      Length:161465             
 1st Qu.:  2.00   Class :character   Class :character          
 Median :  3.00   Mode  :character   Mode  :character          
 Mean   :  5.02                                                
 3rd Qu.:  6.00                                                
 Max.   :824.00                                                
 NA's   :55151                                                 
 ca_contract_value   lca_contract_value ca_contract_valuec ca_signdate       
 Min.   :0.000e+00   Min.   :-3.632     Length:161465      Length:161465     
 1st Qu.:5.608e+04   1st Qu.:10.935     Class :character   Class :character  
 Median :2.297e+05   Median :12.345     Mode  :character   Mode  :character  
 Mean   :1.876e+06   Mean   :12.287                                          
 3rd Qu.:8.755e+05   3rd Qu.:13.683                                          
 Max.   :2.132e+09   Max.   :21.480                                          
 NA's   :13          NA's   :13                                              
   ca_date           ca_bids_all         ca_bids       ca_procedure      
 Length:161465      Min.   :  1.000   Min.   : 1.000   Length:161465     
 Class :character   1st Qu.:  1.000   1st Qu.: 1.000   Class :character  
 Mode  :character   Median :  2.000   Median : 2.000   Mode  :character  
                    Mean   :  3.918   Mean   : 3.701                     
                    3rd Qu.:  4.000   3rd Qu.: 4.000                     
                    Max.   :993.000   Max.   :50.000                     
                                                                         
  ca_signper        ca_signper_corr  ca_signper_corr5   ca_signper_corr25
 Length:161465      Min.   :  0.00   Length:161465      Min.   : 1.00    
 Class :character   1st Qu.: 10.00   Class :character   1st Qu.: 8.00    
 Mode  :character   Median : 27.00   Mode  :character   Median :16.00    
                    Mean   : 48.92                      Mean   :15.13    
                    3rd Qu.: 57.00                      3rd Qu.:22.00    
                    Max.   :728.00                      Max.   :26.00    
                    NA's   :19568                                        
    w_name           w_country             w_id             anb_name        
 Length:161465      Length:161465      Length:161465      Length:161465     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
    SuppAwd       b2_country         b3_country         b4_country       
 Min.   :1.000   Length:161465      Length:161465      Length:161465     
 1st Qu.:1.000   Class :character   Class :character   Class :character  
 Median :1.000   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.049                                                           
 3rd Qu.:1.000                                                           
 Max.   :7.000                                                           
                                                                         
  ppp_original        ppp          country_st            anb_id     
 Min.   :0.108   Min.   :0.1077   Length:161465      Min.   :    1  
 1st Qu.:0.236   1st Qu.:0.2363   Class :character   1st Qu.: 3775  
 Median :0.306   Median :0.3107   Mode  :character   Median : 6902  
 Mean   :0.330   Mean   :0.3310                      Mean   : 7556  
 3rd Qu.:0.386   3rd Qu.:0.3865                      3rd Qu.:11454  
 Max.   :1.086   Max.   :1.0864                      Max.   :15600  
 NA's   :6868    NA's   :11                          NA's   :366    
 procedure_type        singleb         prop_bidnr      corr_proc        
 Length:161465      Min.   :0.0000   Min.   :0.0004   Length:161465     
 Class :character   1st Qu.:0.0000   1st Qu.:0.0625   Class :character  
 Mode  :character   Median :0.0000   Median :0.2500   Mode  :character  
                    Mean   :0.4147   Mean   :0.4676                     
                    3rd Qu.:1.0000   3rd Qu.:1.0000                     
                    Max.   :1.0000   Max.   :1.0000                     
                                                                        
  corr_proc3         corr_signp        corr_signp1         corr_signp2    
 Length:161465      Length:161465      Length:161465      Min.   :0.0000  
 Class :character   Class :character   Class :character   1st Qu.:0.0000  
 Mode  :character   Mode  :character   Mode  :character   Median :0.0000  
                                                          Mean   :0.2533  
                                                          3rd Qu.:1.0000  
                                                          Max.   :1.0000  
                                                                          
  corr_signp3      corr_signp4      corr_proc31     corr_proc32   
 Min.   :0.0000   Min.   :0.0000   Min.   :0.000   Min.   :0.000  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:0.000  
 Median :0.0000   Median :0.0000   Median :1.000   Median :0.000  
 Mean   :0.1148   Mean   :0.1212   Mean   :0.556   Mean   :0.228  
 3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:1.000   3rd Qu.:0.000  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.000   Max.   :1.000  
                                                                  
  corr_proc33         nrc           w_iso             sec_score    
 Min.   :0.000   Min.   :    2   Length:161465      Min.   :31.38  
 1st Qu.:0.000   1st Qu.: 1707   Class :character   1st Qu.:50.11  
 Median :0.000   Median : 2752   Mode  :character   Median :53.92  
 Mean   :0.216   Mean   : 4989                      Mean   :55.61  
 3rd Qu.:0.000   3rd Qu.: 6202                      3rd Qu.:58.00  
 Max.   :1.000   Max.   :15701                      Max.   :92.00  
                                                    NA's   :79897  
 sec_score_max      taxhav          taxhav_fixed         taxhav3         
 Min.   :31.38   Length:161465      Length:161465      Length:161465     
 1st Qu.:51.00   Class :character   Class :character   Class :character  
 Median :54.00   Mode  :character   Mode  :character   Mode  :character  
 Mean   :56.01                                                           
 3rd Qu.:60.00                                                           
 Max.   :92.00                                                           
 NA's   :84096                                                           
  taxhav3bi             fsuppl          taxhav31        taxhav32     
 Length:161465      Min.   :0.0000   Min.   :0.000   Min.   :0.0000  
 Class :character   1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:0.0000  
 Mode  :character   Median :0.0000   Median :0.000   Median :0.0000  
                    Mean   :0.2568   Mean   :0.237   Mean   :0.0148  
                    3rd Qu.:1.0000   3rd Qu.:0.000   3rd Qu.:0.0000  
                    Max.   :1.0000   Max.   :1.000   Max.   :1.0000  
                                                                     
    taxhav33           taxhav34          cri_wb      
 Min.   :0.000000   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:0.000000   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :0.000000   Median :1.0000   Median :0.2500  
 Mean   :0.005017   Mean   :0.7432   Mean   :0.3419  
 3rd Qu.:0.000000   3rd Qu.:1.0000   3rd Qu.:0.5000  
 Max.   :1.000000   Max.   :1.0000   Max.   :1.0000  
                                                     </code></pre>
</div>
</div>
</section>
<section id="analysis-of-variables" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-variables">Analysis of Variables</h2>
<p>Seeing unique values of categorical vars and descriptive stats of numerical ones.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "National Competitive Bidding"                 
 [2] "Single Source Selection"                      
 [3] "International Competitive Bidding"            
 [4] "Direct Contracting"                           
 [5] "Quality And Cost-Based Selection"             
 [6] "Limited International Bidding"                
 [7] "National Shopping"                            
 [8] "International Shopping"                       
 [9] "Selection Based On Consultant's Qualification"
[10] "Least Cost Selection"                         
[11] "Quality Based Selection"                      
[12] "Individual"                                   
[13] "Selection Under a Fixed Budget"               
[14] "CQS"                                          
[15] "SHOP"                                         </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Public admin, Law"    "Health &amp; social serv" "Education"           
 [4] "Water/sanit/fld prot" "Industry and trade"   "Transportation"      
 [7] "Finance"              "Agriculture"          "Energy &amp; mining"     
[10] "Info &amp; communication" "(H)"                  "(H)Multisector"      
[13] ""                     "(H)Priv Sector Dev"  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                      (H)       (H)Multisector 
                  61                   66                   28 
  (H)Priv Sector Dev          Agriculture            Education 
                   1                13494                15424 
     Energy &amp; mining              Finance Health &amp; social serv 
               11106                 4878                25301 
  Industry and trade Info &amp; communication    Public admin, Law 
                7501                 2067                46307 
      Transportation Water/sanit/fld prot 
               19215                16016 </code></pre>
</div>
</div>
<p>Sector can be divided into dummies later</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Civil Works"         "Consultant Services" "Goods"              </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1]   6   3   1   5   2   4  NA   7  17  19  10  12   8  11  16   9  21  13  14
[20]  15  23  27  18 250  25  26  20  22  28  24  40 109  35  70  50  38  36 100
[39]  56  33  31  58  57  48  45  30  41  79  39  67  65  32  47  54  29  76  34
[58] 133  64  52  55  78  80 105  44  71 230  43  87  82  69 824  37  46 101 170
[77] 149</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   1.00    2.00    3.00    5.02    6.00  824.00   55151 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] ""    "1"   "2"   "3"   "5"   "4"   "7"   "6"   "88"  "13"  "8"   "12" 
[13] "11"  "9"   "23"  "15"  "113" "143" "22"  "51"  "101" "37"  "993" "102"
[25] "14"  "16"  "10"  "141" "886" "682" "986" "20"  "21"  "31"  "26"  "17" 
[37] "60" </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
   161465 character character </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  1.0000  0.5107  1.0000  1.0000 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
0.000e+00 5.608e+04 2.297e+05 1.876e+06 8.755e+05 2.132e+09        13 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
0.000e+00 5.608e+04 2.297e+05 1.876e+06 8.755e+05 2.132e+09        13 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 -3.632  10.935  12.345  12.287  13.683  21.480      13 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "50.000-199.999" "200.000-"       "0-24.999"       "25.000-49.999" 
[5] ""              </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
   161465 character character </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
                     0-24.999       200.000-  25.000-49.999 50.000-199.999 
            13          23693          85200          14064          38495 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "open"                "single source"       "consultancy,cost"   
[4] "restricted"          "consultancy,quality"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
   consultancy,cost consultancy,quality                open          restricted 
              25508                9372               89770                7637 
      single source 
              29178 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
-29188.00      6.00     23.00     34.83     53.00   2076.00      4436 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 6 5 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   1.000   1.000   1.049   1.000   7.000 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
     1      2      3      4      5      6      7 
155524   4462   1179    199     46     45     10 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  31.38   50.11   53.92   55.61   58.00   92.00   79897 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "National Competitive Bidding"                 
 [2] "Single Source Selection"                      
 [3] "International Competitive Bidding"            
 [4] "Direct Contracting"                           
 [5] "Quality And Cost-Based Selection"             
 [6] "Limited International Bidding"                
 [7] "National Shopping"                            
 [8] "International Shopping"                       
 [9] "Selection Based On Consultant's Qualification"
[10] "Least Cost Selection"                         
[11] "Quality Based Selection"                      
[12] "Individual"                                   
[13] "Selection Under a Fixed Budget"               </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
                           Direct Contracting 
                                         5205 
                                   Individual 
                                         9782 
            International Competitive Bidding 
                                        48500 
                       International Shopping 
                                         4004 
                         Least Cost Selection 
                                          796 
                Limited International Bidding 
                                         1896 
                 National Competitive Bidding 
                                        41270 
                            National Shopping 
                                         1737 
             Quality And Cost-Based Selection 
                                        23916 
                      Quality Based Selection 
                                         2354 
Selection Based On Consultant's Qualification 
                                         7018 
               Selection Under a Fixed Budget 
                                          796 
                      Single Source Selection 
                                        14191 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "domestic supplier" "NO tax haven"      "tax haven"        </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
domestic supplier      NO tax haven         tax haven 
           119994             38272              3199 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "domestic supplier" "NO tax haven"      "tax haven"        </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "domestic supplier"                   
[2] "NO tax haven &amp; tax haven,large state"
[3] "tax haven, small state"              </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.2500  0.3419  0.5000  1.0000 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00 0.25 0.75 0.50 1.00</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0  0.25   0.5  0.75     1 
42239 50405 36622 31594   605 </code></pre>
</div>
</div>
</section>
<section id="plot" class="level2">
<h2 class="anchored" data-anchor-id="plot">Plot</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cri_wb.ch'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing non-finite values (stat_density).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can observe some differences, for example between regions like Sub-Saharan Africa and Latin America.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing non-finite values (stat_density).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Groups with fewer than two data points have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning
-Inf</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again some differences are seen between for example Energy&amp;Mining and Law, which makes sense, since Mining requires more costly equipment. The sector without a name seems to be an outlier almost.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing non-finite values (stat_summary).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Generally increasing trend of average value per contract.</p>
</section>
<section id="regression" class="level2">
<h2 class="anchored" data-anchor-id="regression">Regression</h2>
<p>I run a simple regression with variables of interest to see if anything interesting happens</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lca_contract_value ~ region + ca_type + ca_bids_all + 
    ca_procedure + singleb + corr_signp2 + corr_signp3 + corr_signp4 + 
    nrc + taxhav_fixed + cri_wb, data = Procurement2)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.4957  -1.2318   0.0867   1.2818   8.4553 

Coefficients: (1 not defined because of singularities)
                                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                      1.358e+01  3.544e-02 383.279  &lt; 2e-16 ***
regionEAP                       -5.604e-02  1.851e-02  -3.028  0.00247 ** 
regionECA                       -2.158e-01  1.546e-02 -13.959  &lt; 2e-16 ***
regionLCR                       -5.246e-01  1.536e-02 -34.153  &lt; 2e-16 ***
regionMNA                        8.887e-02  2.102e-02   4.227 2.37e-05 ***
regionSAR                       -5.903e-02  2.073e-02  -2.848  0.00441 ** 
ca_typeConsultant Services      -1.443e+00  3.071e-02 -46.986  &lt; 2e-16 ***
ca_typeGoods                    -7.299e-01  1.279e-02 -57.051  &lt; 2e-16 ***
ca_bids_all                      6.982e-04  3.591e-04   1.945  0.05184 .  
ca_procedureconsultancy,quality -9.478e-01  2.372e-02 -39.965  &lt; 2e-16 ***
ca_procedureopen                -6.071e-01  3.322e-02 -18.277  &lt; 2e-16 ***
ca_procedurerestricted          -1.573e+00  3.941e-02 -39.906  &lt; 2e-16 ***
ca_proceduresingle source       -7.534e-01  1.824e-02 -41.302  &lt; 2e-16 ***
singleb                         -1.965e-01  1.232e-02 -15.949  &lt; 2e-16 ***
corr_signp2                     -2.161e-01  1.201e-02 -17.986  &lt; 2e-16 ***
corr_signp3                      2.122e-01  1.592e-02  13.331  &lt; 2e-16 ***
corr_signp4                     -5.635e-01  1.590e-02 -35.452  &lt; 2e-16 ***
nrc                              4.125e-05  1.467e-06  28.117  &lt; 2e-16 ***
taxhav_fixedNO tax haven         8.181e-01  1.238e-02  66.078  &lt; 2e-16 ***
taxhav_fixedtax haven            8.470e-01  3.503e-02  24.176  &lt; 2e-16 ***
cri_wb                                  NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.935 on 161432 degrees of freedom
  (13 observations deleted due to missingness)
Multiple R-squared:  0.1659,    Adjusted R-squared:  0.1658 
F-statistic:  1690 on 19 and 161432 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Adjusted R-squared is about 0.17, whereas cri_wb is dropped because of singularity.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 604717.7</code></pre>
</div>
</div>
<p>RSS is quite big.</p>
<p>The variable for cri_wb was omitted due to singularities. Perhaps creating a dummy might change it.</p>
<p>I am creating several dummies for categorical vars.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Public admin, Law"    "Health &amp; social serv" "Education"           
 [4] "Water/sanit/fld prot" "Industry and trade"   "Transportation"      
 [7] "Finance"              "Agriculture"          "Energy &amp; mining"     
[10] "Info &amp; communication" "(H)"                  "(H)Multisector"      
[13] ""                     "(H)Priv Sector Dev"  </code></pre>
</div>
</div>
<p>For regression of the value per contract I am selecting the following variables: 1. Dummy variables for region, because there was a slight difference between the distributions of value by regions. 4. Procurement Sector, thinking some sectors tend to attract more valuable tender contracts. 2. Dummy for ca_type (Procurement Category) since the type of services can affect the value 3. Dummy for for n of bidders since higher n of bidders should indicate a higher price of the contract. 4. Dummy for contract award procedure associated with corruption. 5. Dummy for single bidder might indicate corrupted case, which can imply high value of the contract. 6. Period between when the contract was awarded and signed. 7. Number of contracts per country. 8. Whether the supplier is a domestic one or a tax haven. Foreign tax havens might indicate corruption and thus higher price. 9. The Corruption Index might be associated with the higher value of the contract.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lca_contract_value ~ ., data = Procurement3)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.7818  -0.6101  -0.0397   0.5108   7.0744 

Coefficients: (2 not defined because of singularities)
                                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       9.252e+00  1.382e-01  66.933  &lt; 2e-16 ***
ca_contract_valuec200.000-        4.692e+00  7.916e-03 592.686  &lt; 2e-16 ***
ca_contract_valuec25.000-49.999   1.543e+00  1.066e-02 144.820  &lt; 2e-16 ***
ca_contract_valuec50.000-199.999  2.570e+00  8.370e-03 307.066  &lt; 2e-16 ***
AFR                               5.303e-02  1.071e-02   4.951 7.40e-07 ***
EAP                               1.428e-01  9.106e-03  15.681  &lt; 2e-16 ***
ECA                               6.290e-02  1.089e-02   5.778 7.57e-09 ***
LCR                               1.050e-01  1.050e-02  10.000  &lt; 2e-16 ***
MNA                               1.890e-01  1.336e-02  14.146  &lt; 2e-16 ***
SAR                                      NA         NA      NA       NA    
ca_Consul.Service                -3.435e-01  1.593e-02 -21.562  &lt; 2e-16 ***
ca_Goods                         -2.349e-01  6.761e-03 -34.744  &lt; 2e-16 ***
ca_bids_all                       1.069e-03  1.850e-04   5.782 7.40e-09 ***
ca_proc_open                      2.515e-01  4.851e-02   5.184 2.17e-07 ***
ca_proc_quality                  -1.505e-01  1.232e-02 -12.215  &lt; 2e-16 ***
ca_proc_source                   -6.125e-02  9.609e-03  -6.374 1.85e-10 ***
ca_proc_restricted               -2.147e-01  2.046e-02 -10.492  &lt; 2e-16 ***
singleb                          -2.465e-01  4.567e-02  -5.398 6.74e-08 ***
corr_signp1                       3.224e-01  4.605e-02   7.001 2.55e-12 ***
corr_signp2                       4.846e-02  8.781e-03   5.519 3.42e-08 ***
corr_signp3                       2.146e-01  1.054e-02  20.355  &lt; 2e-16 ***
nrc                               1.587e-05  7.593e-07  20.903  &lt; 2e-16 ***
taxhaven                          1.119e-01  4.103e-02   2.728 0.006376 ** 
not.taxhaven                      2.798e-01  6.462e-03  43.304  &lt; 2e-16 ***
cri_wb.d0                        -6.546e-01  1.366e-01  -4.791 1.66e-06 ***
cri_wb.d25                       -5.129e-01  9.156e-02  -5.602 2.12e-08 ***
cri_wb.d50                       -2.489e-01  4.666e-02  -5.334 9.61e-08 ***
cri_wb.d75                               NA         NA      NA       NA    
P                                -2.145e-01  1.278e-01  -1.678 0.093383 .  
Health                           -9.958e-02  1.279e-01  -0.779 0.436187    
Edu                              -9.031e-02  1.280e-01  -0.706 0.480466    
W                                 2.929e-02  1.280e-01   0.229 0.819010    
I                                -1.220e-01  1.282e-01  -0.952 0.341306    
Tran                              3.261e-01  1.280e-01   2.549 0.010814 *  
Fin                              -9.101e-02  1.285e-01  -0.708 0.478748    
A                                -4.242e-02  1.280e-01  -0.331 0.740364    
Ener                              3.031e-01  1.281e-01   2.366 0.017991 *  
Info                             -1.693e-01  1.296e-01  -1.306 0.191443    
H                                -6.562e-02  1.771e-01  -0.371 0.710976    
Multi                            -8.459e-01  2.276e-01  -3.717 0.000202 ***
Priv                              5.614e-01  1.005e+00   0.559 0.576349    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9966 on 161413 degrees of freedom
Multiple R-squared:  0.7789,    Adjusted R-squared:  0.7788 
F-statistic: 1.496e+04 on 38 and 161413 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Two variables were dropped because of singularity still. Most of the remaining vars have high statistical significance.</p>
</section>
<section id="ridge-regression-with-grid-search" class="level2">
<h2 class="anchored" data-anchor-id="ridge-regression-with-grid-search">Ridge Regression with Grid Search</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> ca_contract_valuec lca_contract_value      AFR             EAP        
 Length:161452      Min.   :-3.632     Min.   :0.000   Min.   :0.0000  
 Class :character   1st Qu.:10.935     1st Qu.:0.000   1st Qu.:0.0000  
 Mode  :character   Median :12.345     Median :0.000   Median :0.0000  
                    Mean   :12.287     Mean   :0.232   Mean   :0.1787  
                    3rd Qu.:13.683     3rd Qu.:0.000   3rd Qu.:0.0000  
                    Max.   :21.480     Max.   :1.000   Max.   :1.0000  
      ECA              LCR              MNA               SAR        
 Min.   :0.0000   Min.   :0.0000   Min.   :0.00000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.0000  
 Median :0.0000   Median :0.0000   Median :0.00000   Median :0.0000  
 Mean   :0.1791   Mean   :0.1975   Mean   :0.07035   Mean   :0.1424  
 3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.0000  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.00000   Max.   :1.0000  
 ca_Consul.Service    ca_Goods       ca_bids_all       ca_proc_open  
 Min.   :0.0000    Min.   :0.0000   Min.   :  1.000   Min.   :0.000  
 1st Qu.:0.0000    1st Qu.:0.0000   1st Qu.:  1.000   1st Qu.:0.000  
 Median :0.0000    Median :0.0000   Median :  2.000   Median :1.000  
 Mean   :0.3645    Mean   :0.3459   Mean   :  3.918   Mean   :0.556  
 3rd Qu.:1.0000    3rd Qu.:1.0000   3rd Qu.:  4.000   3rd Qu.:1.000  
 Max.   :1.0000    Max.   :1.0000   Max.   :993.000   Max.   :1.000  
 ca_proc_quality   ca_proc_source   ca_proc_restricted    singleb      
 Min.   :0.00000   Min.   :0.0000   Min.   :0.0000     Min.   :0.0000  
 1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.0000     1st Qu.:0.0000  
 Median :0.00000   Median :0.0000   Median :0.0000     Median :0.0000  
 Mean   :0.05805   Mean   :0.1806   Mean   :0.0473     Mean   :0.4147  
 3rd Qu.:0.00000   3rd Qu.:0.0000   3rd Qu.:0.0000     3rd Qu.:1.0000  
 Max.   :1.00000   Max.   :1.0000   Max.   :1.0000     Max.   :1.0000  
  corr_signp1      corr_signp2      corr_signp3          nrc       
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :    2  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.: 1707  
 Median :1.0000   Median :0.0000   Median :0.0000   Median : 2752  
 Mean   :0.5108   Mean   :0.2532   Mean   :0.1148   Mean   : 4990  
 3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.: 6202  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :15701  
    taxhaven       not.taxhaven     cri_wb.d0        cri_wb.d25    
 Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :0.0000   Median :0.000   Median :0.0000   Median :0.0000  
 Mean   :0.0198   Mean   :0.237   Mean   :0.2616   Mean   :0.3122  
 3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:1.0000   3rd Qu.:1.0000  
 Max.   :1.0000   Max.   :1.000   Max.   :1.0000   Max.   :1.0000  
   cri_wb.d50       cri_wb.d75           P              Health      
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :0.0000   Median :0.0000   Median :0.0000   Median :0.0000  
 Mean   :0.2268   Mean   :0.1956   Mean   :0.2868   Mean   :0.1567  
 3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:0.0000  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000  
      Edu                W                 I                Tran      
 Min.   :0.00000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000  
 1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000  
 Median :0.00000   Median :0.00000   Median :0.00000   Median :0.000  
 Mean   :0.09553   Mean   :0.09919   Mean   :0.04646   Mean   :0.119  
 3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000  
 Max.   :1.00000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000  
      Fin                A               Ener              Info       
 Min.   :0.00000   Min.   :0.0000   Min.   :0.00000   Min.   :0.0000  
 1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.0000  
 Median :0.00000   Median :0.0000   Median :0.00000   Median :0.0000  
 Mean   :0.03021   Mean   :0.0835   Mean   :0.06879   Mean   :0.0128  
 3rd Qu.:0.00000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.0000  
 Max.   :1.00000   Max.   :1.0000   Max.   :1.00000   Max.   :1.0000  
       H                 Multi                Priv        
 Min.   :0.0000000   Min.   :0.0000000   Min.   :0.0e+00  
 1st Qu.:0.0000000   1st Qu.:0.0000000   1st Qu.:0.0e+00  
 Median :0.0000000   Median :0.0000000   Median :0.0e+00  
 Mean   :0.0004088   Mean   :0.0001734   Mean   :6.2e-06  
 3rd Qu.:0.0000000   3rd Qu.:0.0000000   3rd Qu.:0.0e+00  
 Max.   :1.0000000   Max.   :1.0000000   Max.   :1.0e+00  </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>35 x 1 sparse Matrix of class "dgCMatrix"
                              s0
(Intercept)         1.295066e+01
(Intercept)         .           
AFR                 1.740151e-01
EAP                 5.540119e-02
ECA                -5.063949e-03
LCR                -2.871303e-01
MNA                 3.080603e-01
SAR                 1.182342e-01
ca_Consul.Service  -1.243931e+00
ca_Goods           -6.270021e-01
ca_bids_all         9.673877e-04
ca_proc_open       -4.830663e-01
ca_proc_quality    -8.910647e-01
ca_proc_source     -7.194468e-01
ca_proc_restricted -1.445686e+00
singleb            -1.378996e-01
corr_signp1         5.353419e-01
corr_signp2         3.257312e-01
corr_signp3         7.423295e-01
nrc                 3.892206e-05
taxhaven            8.405527e-01
not.taxhaven        8.169726e-01
P                  -9.535187e-01
Health             -3.615957e-01
Edu                -7.520389e-02
W                   9.985832e-03
I                  -6.340170e-01
Tran                4.970437e-01
Fin                -6.351149e-01
A                   3.418690e-02
Ener                5.531834e-01
Info               -8.652731e-01
H                  -1.507041e-01
Multi              -5.725173e-01
Priv                1.060161e+00</code></pre>
</div>
</div>
<p>Coefficients of this regression did not drop the two from the lr2, which might be because the estimates in glmnet and lm will never be exactly the same and one is the subset of the other.</p>
<p>RMSE of the first Ridge regression is bigger than that of the unregularized linear regression. Seems that the optimal lambda should be small.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05474761</code></pre>
</div>
</div>
<p>The optimal lambda is very close to 0.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01582965</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01447194</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01409955</code></pre>
</div>
</div>
<p>The RMSE for Ridge regression with the optimal parameter is smaller than that with lambda 0 just a little bit. Which means regularized regression is just a little more efficient than the simple linear regression.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56996.77</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57044.26</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y ~ ., data = train_x)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.9811  -1.1631   0.0784   1.2355   8.4591 

Coefficients: (1 not defined because of singularities)
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         1.231e+01  2.672e-01  46.051  &lt; 2e-16 ***
AFR                 5.563e-02  2.107e-02   2.640 0.008280 ** 
EAP                -6.235e-02  1.788e-02  -3.488 0.000488 ***
ECA                -1.228e-01  2.140e-02  -5.735 9.75e-09 ***
LCR                -4.057e-01  2.058e-02 -19.717  &lt; 2e-16 ***
MNA                 1.897e-01  2.630e-02   7.215 5.40e-13 ***
SAR                        NA         NA      NA       NA    
ca_Consul.Service  -1.254e+00  3.123e-02 -40.153  &lt; 2e-16 ***
ca_Goods           -6.273e-01  1.324e-02 -47.388  &lt; 2e-16 ***
ca_bids_all         9.722e-04  3.647e-04   2.666 0.007686 ** 
ca_proc_open       -4.938e-01  3.371e-02 -14.650  &lt; 2e-16 ***
ca_proc_quality    -8.915e-01  2.411e-02 -36.982  &lt; 2e-16 ***
ca_proc_source     -7.207e-01  1.854e-02 -38.863  &lt; 2e-16 ***
ca_proc_restricted -1.456e+00  3.999e-02 -36.409  &lt; 2e-16 ***
singleb            -1.378e-01  1.251e-02 -11.009  &lt; 2e-16 ***
corr_signp1         5.356e-01  1.612e-02  33.230  &lt; 2e-16 ***
corr_signp2         3.258e-01  1.724e-02  18.900  &lt; 2e-16 ***
corr_signp3         7.424e-01  2.055e-02  36.121  &lt; 2e-16 ***
nrc                 3.891e-05  1.493e-06  26.061  &lt; 2e-16 ***
taxhaven            8.407e-01  3.551e-02  23.672  &lt; 2e-16 ***
not.taxhaven        8.168e-01  1.261e-02  64.770  &lt; 2e-16 ***
P                  -1.791e-01  2.635e-01  -0.679 0.496886    
Health              4.127e-01  2.637e-01   1.565 0.117569    
Edu                 6.990e-01  2.639e-01   2.649 0.008080 ** 
W                   7.842e-01  2.639e-01   2.972 0.002962 ** 
I                   1.401e-01  2.643e-01   0.530 0.596089    
Tran                1.271e+00  2.638e-01   4.818 1.45e-06 ***
Fin                 1.388e-01  2.648e-01   0.524 0.600193    
A                   8.082e-01  2.639e-01   3.062 0.002199 ** 
Ener                1.327e+00  2.641e-01   5.026 5.03e-07 ***
Info               -9.151e-02  2.669e-01  -0.343 0.731706    
H                   6.233e-01  3.608e-01   1.728 0.084042 .  
Multi               2.018e-01  4.622e-01   0.437 0.662471    
Priv                1.833e+00  1.879e+00   0.976 0.329313    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.861 on 145274 degrees of freedom
Multiple R-squared:  0.2276,    Adjusted R-squared:  0.2275 
F-statistic:  1338 on 32 and 145274 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(lr3, test_x): prediction from a rank-deficient fit may be
misleading</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56998.57</code></pre>
</div>
</div>
<p>Residual Sums Squared are almost identical for both regressions. Given that, I’d suggest sticking to a simpler model, i.e.&nbsp;unpenalized Linear Regression Model.</p>
</section>
<section id="corrected-ridge-without-cri_wb" class="level2">
<h2 class="anchored" data-anchor-id="corrected-ridge-without-cri_wb">Corrected Ridge without cri_wb</h2>
<p>Later in the research I discovered that cri_wb caused multicollinearity, so I removed it and performed Ridge regression again</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01447194</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56996.77</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05474761</code></pre>
</div>
</div>
<p>The optimal lambda is very close to 0.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01409955</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57044.26</code></pre>
</div>
</div>
</section>
<section id="logit-for-contract-value-categories" class="level2">
<h2 class="anchored" data-anchor-id="logit-for-contract-value-categories">Logit for contract value categories</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = value.cat ~ ., family = binomial(link = "logit"), 
    data = Procurement4)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1680  -1.0435   0.5946   0.9686   2.4301  

Coefficients: (2 not defined because of singularities)
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         2.173e-01  3.725e-01   0.583 0.559751    
AFR                -1.557e-01  2.348e-02  -6.632 3.32e-11 ***
EAP                -2.572e-01  2.025e-02 -12.697  &lt; 2e-16 ***
ECA                -2.847e-01  2.384e-02 -11.941  &lt; 2e-16 ***
LCR                -6.262e-01  2.302e-02 -27.201  &lt; 2e-16 ***
MNA                -8.363e-02  2.911e-02  -2.873 0.004065 ** 
SAR                        NA         NA      NA       NA    
ca_Consul.Service  -1.132e+00  3.419e-02 -33.102  &lt; 2e-16 ***
ca_Goods           -4.248e-01  1.462e-02 -29.046  &lt; 2e-16 ***
ca_bids_all         3.636e-04  4.081e-04   0.891 0.372981    
ca_proc_open       -2.588e-01  1.072e-01  -2.414 0.015777 *  
ca_proc_quality    -7.728e-01  2.734e-02 -28.270  &lt; 2e-16 ***
ca_proc_source     -8.616e-01  2.107e-02 -40.888  &lt; 2e-16 ***
ca_proc_restricted -1.399e+00  4.401e-02 -31.799  &lt; 2e-16 ***
singleb            -4.436e-01  1.012e-01  -4.381 1.18e-05 ***
corr_signp1         8.260e-01  1.021e-01   8.090 5.98e-16 ***
corr_signp2         3.143e-01  1.952e-02  16.099  &lt; 2e-16 ***
corr_signp3         6.527e-01  2.323e-02  28.100  &lt; 2e-16 ***
nrc                 2.967e-05  1.669e-06  17.774  &lt; 2e-16 ***
taxhaven            4.303e-01  9.095e-02   4.731 2.23e-06 ***
not.taxhaven        6.952e-01  1.412e-02  49.228  &lt; 2e-16 ***
cri_wb.d0          -9.895e-01  3.031e-01  -3.265 0.001095 ** 
cri_wb.d25         -7.253e-01  2.031e-01  -3.572 0.000354 ***
cri_wb.d50         -3.457e-01  1.035e-01  -3.341 0.000834 ***
cri_wb.d75                 NA         NA      NA       NA    
P                   3.103e-01  3.543e-01   0.876 0.381088    
Health              9.720e-01  3.544e-01   2.743 0.006092 ** 
Edu                 1.355e+00  3.545e-01   3.822 0.000132 ***
W                   1.275e+00  3.545e-01   3.596 0.000323 ***
I                   6.389e-01  3.550e-01   1.800 0.071878 .  
Tran                1.641e+00  3.545e-01   4.629 3.68e-06 ***
Fin                 7.281e-01  3.554e-01   2.049 0.040501 *  
A                   1.378e+00  3.546e-01   3.885 0.000102 ***
Ener                1.716e+00  3.548e-01   4.837 1.32e-06 ***
Info                3.506e-01  3.573e-01   0.981 0.326468    
H                   1.121e+00  4.383e-01   2.557 0.010551 *  
Multi               2.200e+00  5.811e-01   3.786 0.000153 ***
Priv                7.657e+00  2.667e+01   0.287 0.774001    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 223324  on 161451  degrees of freedom
Residual deviance: 195143  on 161416  degrees of freedom
AIC: 195215

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = train_y.log ~ ., family = binomial(link = "logit"), 
    data = train_x.log)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1717  -1.0427   0.5951   0.9680   2.4297  

Coefficients: (2 not defined because of singularities)
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         1.446e-01  4.138e-01   0.349 0.726831    
AFR                -1.496e-01  2.475e-02  -6.045 1.49e-09 ***
EAP                -2.556e-01  2.132e-02 -11.987  &lt; 2e-16 ***
ECA                -2.766e-01  2.514e-02 -11.005  &lt; 2e-16 ***
LCR                -6.208e-01  2.426e-02 -25.591  &lt; 2e-16 ***
MNA                -6.703e-02  3.071e-02  -2.183 0.029056 *  
SAR                        NA         NA      NA       NA    
ca_Consul.Service  -1.121e+00  3.604e-02 -31.096  &lt; 2e-16 ***
ca_Goods           -4.294e-01  1.541e-02 -27.856  &lt; 2e-16 ***
ca_bids_all         3.483e-04  4.278e-04   0.814 0.415608    
ca_proc_open       -2.637e-01  1.128e-01  -2.338 0.019403 *  
ca_proc_quality    -7.794e-01  2.887e-02 -26.995  &lt; 2e-16 ***
ca_proc_source     -8.612e-01  2.224e-02 -38.728  &lt; 2e-16 ***
ca_proc_restricted -1.396e+00  4.643e-02 -30.069  &lt; 2e-16 ***
singleb            -4.285e-01  1.065e-01  -4.025 5.70e-05 ***
corr_signp1         8.177e-01  1.073e-01   7.620 2.54e-14 ***
corr_signp2         3.158e-01  2.057e-02  15.352  &lt; 2e-16 ***
corr_signp3         6.552e-01  2.447e-02  26.772  &lt; 2e-16 ***
nrc                 2.977e-05  1.760e-06  16.917  &lt; 2e-16 ***
taxhaven            4.361e-01  9.553e-02   4.565 5.00e-06 ***
not.taxhaven        6.971e-01  1.491e-02  46.765  &lt; 2e-16 ***
cri_wb.d0          -9.462e-01  3.186e-01  -2.970 0.002982 ** 
cri_wb.d25         -7.003e-01  2.135e-01  -3.280 0.001037 ** 
cri_wb.d50         -3.246e-01  1.088e-01  -2.983 0.002850 ** 
cri_wb.d75                 NA         NA      NA       NA    
P                   3.490e-01  3.955e-01   0.882 0.377560    
Health              1.020e+00  3.956e-01   2.579 0.009897 ** 
Edu                 1.398e+00  3.958e-01   3.533 0.000411 ***
W                   1.311e+00  3.958e-01   3.313 0.000924 ***
I                   6.749e-01  3.962e-01   1.704 0.088465 .  
Tran                1.680e+00  3.957e-01   4.245 2.19e-05 ***
Fin                 7.710e-01  3.966e-01   1.944 0.051913 .  
A                   1.418e+00  3.958e-01   3.582 0.000341 ***
Ener                1.769e+00  3.960e-01   4.467 7.94e-06 ***
Info                3.904e-01  3.985e-01   0.979 0.327335    
H                   1.155e+00  4.832e-01   2.391 0.016820 *  
Multi               2.246e+00  6.367e-01   3.527 0.000420 ***
Priv                8.699e+00  4.396e+01   0.198 0.843127    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 200979  on 145306  degrees of freedom
Residual deviance: 175595  on 145271  degrees of freedom
AIC: 175667

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        8        14        34        51        55        63 
0.6394443 0.6120216 0.4675069 0.3935432 0.4991478 0.7957945 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> 8 14 34 51 55 63 
 1  1  0  0  0  1 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6716011</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Model :
train_y.log ~ AFR + EAP + ECA + LCR + MNA + SAR + ca_Consul.Service + 
    ca_Goods + ca_bids_all + ca_proc_open + ca_proc_quality + 
    ca_proc_source + ca_proc_restricted + singleb + corr_signp1 + 
    corr_signp2 + corr_signp3 + nrc + taxhaven + not.taxhaven + 
    cri_wb.d0 + cri_wb.d25 + cri_wb.d50 + cri_wb.d75 + P + Health + 
    Edu + W + I + Tran + Fin + A + Ener + Info + H + Multi + 
    Priv

Complete :
           (Intercept) AFR EAP ECA LCR MNA ca_Consul.Service ca_Goods
SAR         1          -1  -1  -1  -1  -1   0                 0      
cri_wb.d75  2           0   0   0   0   0   0                 0      
           ca_bids_all ca_proc_open ca_proc_quality ca_proc_source
SAR         0           0            0               0            
cri_wb.d75  0           1            0               0            
           ca_proc_restricted singleb corr_signp1 corr_signp2 corr_signp3 nrc
SAR         0                  0       0           0           0           0 
cri_wb.d75  0                 -1       1           0           0           0 
           taxhaven not.taxhaven cri_wb.d0 cri_wb.d25 cri_wb.d50 P  Health Edu
SAR         0        0            0         0          0          0  0      0 
cri_wb.d75 -1        0           -4        -3         -2          0  0      0 
           W  I  Tran Fin A  Ener Info H  Multi Priv
SAR         0  0  0    0   0  0    0    0  0     0  
cri_wb.d75  0  0  0    0   0  0    0    0  0     0  </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = train_y.log ~ ., family = binomial(link = "logit"), 
    data = train_x.log2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1247  -1.0546   0.5972   0.9890   2.3543  

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        -4.547e-01  3.980e-01  -1.142 0.253301    
ca_Consul.Service  -1.164e+00  3.587e-02 -32.450  &lt; 2e-16 ***
ca_Goods           -4.829e-01  1.515e-02 -31.880  &lt; 2e-16 ***
ca_proc_open       -5.625e-01  3.864e-02 -14.559  &lt; 2e-16 ***
ca_proc_quality    -7.681e-01  2.861e-02 -26.849  &lt; 2e-16 ***
ca_proc_source     -8.259e-01  2.176e-02 -37.948  &lt; 2e-16 ***
ca_proc_restricted -1.451e+00  4.600e-02 -31.536  &lt; 2e-16 ***
singleb            -1.536e-01  1.412e-02 -10.880  &lt; 2e-16 ***
corr_signp1         5.438e-01  1.899e-02  28.637  &lt; 2e-16 ***
corr_signp2         3.407e-01  2.035e-02  16.740  &lt; 2e-16 ***
corr_signp3         6.837e-01  2.421e-02  28.246  &lt; 2e-16 ***
nrc                 3.793e-05  1.264e-06  30.010  &lt; 2e-16 ***
taxhaven            7.224e-01  4.179e-02  17.286  &lt; 2e-16 ***
not.taxhaven        7.763e-01  1.460e-02  53.159  &lt; 2e-16 ***
P                   2.943e-01  3.954e-01   0.744 0.456650    
Health              9.874e-01  3.955e-01   2.496 0.012545 *  
Edu                 1.335e+00  3.957e-01   3.373 0.000743 ***
W                   1.257e+00  3.957e-01   3.176 0.001496 ** 
I                   6.348e-01  3.961e-01   1.603 0.109024    
Tran                1.625e+00  3.957e-01   4.108 3.99e-05 ***
Fin                 7.117e-01  3.966e-01   1.795 0.072714 .  
A                   1.386e+00  3.958e-01   3.502 0.000461 ***
Ener                1.728e+00  3.960e-01   4.364 1.28e-05 ***
Info                3.181e-01  3.984e-01   0.798 0.424710    
H                   1.137e+00  4.840e-01   2.349 0.018802 *  
Multi               2.320e+00  6.344e-01   3.657 0.000255 ***
Priv                8.504e+00  4.396e+01   0.193 0.846597    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 200979  on 145306  degrees of freedom
Residual deviance: 176745  on 145280  degrees of freedom
AIC: 176799

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        8        14        34        51        55        63 
0.6194700 0.5866468 0.4000703 0.3530457 0.4693526 0.7737040 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> 8 14 34 51 55 63 
 1  1  0  0  0  1 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6688758</code></pre>
</div>
</div>
</section>
<section id="knn" class="level2">
<h2 class="anchored" data-anchor-id="knn">KNN</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7562713</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7529266</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7591205</code></pre>
</div>
</div>
</section>
<section id="beyond-linearity-splines" class="level2">
<h2 class="anchored" data-anchor-id="beyond-linearity-splines">Beyond Linearity: Splines</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y ~ bs(nrc, degree = 3) + Edu + Ener + Multi, 
    data = train_x)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3907  -1.3039   0.0776   1.3431   9.4819 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          11.99366    0.01865 643.154   &lt;2e-16 ***
bs(nrc, degree = 3)1 -0.03461    0.06848  -0.505    0.613    
bs(nrc, degree = 3)2  0.62123    0.06629   9.371   &lt;2e-16 ***
bs(nrc, degree = 3)3  0.87160    0.02672  32.625   &lt;2e-16 ***
Edu                   0.27344    0.01862  14.682   &lt;2e-16 ***
Ener                  1.03912    0.02175  47.769   &lt;2e-16 ***
Multi                -0.21348    0.42393  -0.504    0.615    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.077 on 145300 degrees of freedom
Multiple R-squared:  0.03805,   Adjusted R-squared:  0.03801 
F-statistic: 957.9 on 6 and 145300 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       8       14       34       51       55       63 
11.99398 12.26742 12.26742 12.00141 12.00141 12.00141 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1]  8.978580 12.802028 13.114779  9.409601 12.325201 14.210191</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01513323</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70996.55</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6446 10.9005 12.3221 12.2694 13.6952 20.3544 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y ~ bs(nrc, degree = 3) + bs(ca_bids_all, 
    degree = 3) + Edu + Ener + Multi, data = train_x)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3182  -1.2970   0.0857   1.3408   9.3605 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  11.90826    0.01882 632.741  &lt; 2e-16 ***
bs(nrc, degree = 3)1          0.01477    0.06829   0.216  0.82881    
bs(nrc, degree = 3)2          0.53280    0.06617   8.052  8.2e-16 ***
bs(nrc, degree = 3)3          0.84187    0.02665  31.586  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)1 11.07475    0.38349  28.879  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)2 -2.73186    1.81815  -1.503  0.13296    
bs(ca_bids_all, degree = 3)3  2.58227    0.83824   3.081  0.00207 ** 
Edu                           0.24309    0.01860  13.072  &lt; 2e-16 ***
Ener                          1.04128    0.02169  48.014  &lt; 2e-16 ***
Multi                        -0.20574    0.42263  -0.487  0.62639    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.07 on 145297 degrees of freedom
Multiple R-squared:  0.04394,   Adjusted R-squared:  0.04388 
F-statistic:   742 on 9 and 145297 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70454.6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01356418</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot nrc vs value-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot ca_bids_all vs value 1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23225</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 294</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002017656</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1599802</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot ca_bids_all vs value 2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot for ca_bids_all-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot for nrc-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8413083 -0.8413083 -0.8413083 -0.8413083 -0.8413083 -0.8413083</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.5530255 -0.1404550 -0.1404550 -0.6027754  0.3218654  0.5530255</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-1.0156 -0.6685 -0.4557  0.0000  0.2466  2.1803 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-0.6028 -0.6028 -0.3716  0.0000  0.0907 10.2618 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 -3.632  10.933  12.344  12.286  13.681  21.480 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y.sp ~ bs(nrc, degree = 3) + bs(ca_bids_all, 
    degree = 3) + Edu + Ener + Multi, data = train_x.sp)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.2785  -1.2860   0.0873   1.3266   8.8929 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  11.68783    0.01908 612.483  &lt; 2e-16 ***
bs(nrc, degree = 3)1          0.10699    0.06769   1.581    0.114    
bs(nrc, degree = 3)2          0.40187    0.06573   6.114 9.74e-10 ***
bs(nrc, degree = 3)3          0.74986    0.02645  28.347  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)1  3.52129    0.06223  56.588  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)2 -3.71759    0.16550 -22.463  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)3  0.90606    0.17384   5.212 1.87e-07 ***
Edu                           0.23924    0.01849  12.941  &lt; 2e-16 ***
Ener                          0.98373    0.02148  45.797  &lt; 2e-16 ***
Multi                        -0.24564    0.39442  -0.623    0.533    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.049 on 145002 degrees of freedom
Multiple R-squared:  0.06263,   Adjusted R-squared:  0.06257 
F-statistic:  1076 on 9 and 145002 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       8       14       34       51       55       56 
12.49270 12.33904 11.94622 12.11588 11.93343 12.11588 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69440.65</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01712034</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y.sp ~ bs(nrc, degree = 1) + bs(ca_bids_all, 
    degree = 1) + Edu + Ener + Multi, data = train_x.sp)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3155  -1.2925   0.0838   1.3407   9.3581 

Coefficients:
                             Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)                 11.808730   0.008531 1384.211   &lt;2e-16 ***
bs(nrc, degree = 1)          0.888195   0.017549   50.612   &lt;2e-16 ***
bs(ca_bids_all, degree = 1)  1.883331   0.059426   31.692   &lt;2e-16 ***
Edu                          0.225089   0.018657   12.064   &lt;2e-16 ***
Ener                         1.032723   0.021591   47.832   &lt;2e-16 ***
Multi                       -0.178013   0.398264   -0.447    0.655    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.069 on 145006 degrees of freedom
Multiple R-squared:  0.04415,   Adjusted R-squared:  0.04412 
F-statistic:  1340 on 5 and 145006 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       8       14       34       51       55       56 
12.05751 12.16239 12.08225 11.97277 11.93270 11.97277 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01716597</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70568.34</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  11.05   11.81   12.15   12.29   12.65   14.43 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-0.6561 10.9044 12.3478 12.2704 13.6981 20.3544 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Ecdat':

    Gasoline</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is mgcv 1.8-39. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
train_y.sp ~ bs(nrc, degree = 3) + bs(ca_bids_all, degree = 3) + 
    Edu + Ener + Multi

Parametric coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  11.68783    0.01908 612.483  &lt; 2e-16 ***
bs(nrc, degree = 3)1          0.10699    0.06769   1.581    0.114    
bs(nrc, degree = 3)2          0.40187    0.06573   6.114 9.74e-10 ***
bs(nrc, degree = 3)3          0.74986    0.02645  28.347  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)1  3.52129    0.06223  56.588  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)2 -3.71759    0.16550 -22.463  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)3  0.90606    0.17384   5.212 1.87e-07 ***
Edu                           0.23924    0.01849  12.941  &lt; 2e-16 ***
Ener                          0.98373    0.02148  45.797  &lt; 2e-16 ***
Multi                        -0.24564    0.39442  -0.623    0.533    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


R-sq.(adj) =  0.0626   Deviance explained = 6.26%
GCV = 4.1992  Scale est. = 4.1989    n = 145012</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69440.65</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01712034</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
train_y ~ bs(nrc, degree = 3) + bs(ca_bids_all, degree = 3) + 
    Edu + Ener + Multi

Parametric coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  11.90826    0.01882 632.741  &lt; 2e-16 ***
bs(nrc, degree = 3)1          0.01477    0.06829   0.216  0.82881    
bs(nrc, degree = 3)2          0.53280    0.06617   8.052  8.2e-16 ***
bs(nrc, degree = 3)3          0.84187    0.02665  31.586  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)1 11.07475    0.38349  28.879  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)2 -2.73186    1.81815  -1.503  0.13296    
bs(ca_bids_all, degree = 3)3  2.58227    0.83824   3.081  0.00207 ** 
Edu                           0.24309    0.01860  13.072  &lt; 2e-16 ***
Ener                          1.04128    0.02169  48.014  &lt; 2e-16 ***
Multi                        -0.20574    0.42263  -0.487  0.62639    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


R-sq.(adj) =  0.0439   Deviance explained = 4.39%
GCV = 4.2859  Scale est. = 4.2856    n = 145307</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70454.6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01356418</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                 (Intercept)         bs(nrc, degree = 3)1 
                  11.6878264                    0.1069901 
        bs(nrc, degree = 3)2         bs(nrc, degree = 3)3 
                   0.4018697                    0.7498629 
bs(ca_bids_all, degree = 3)1 bs(ca_bids_all, degree = 3)2 
                   3.5212868                   -3.7175900 
bs(ca_bids_all, degree = 3)3                          Edu 
                   0.9060622                    0.2392372 
                        Ener                        Multi 
                   0.9837282                   -0.2456402 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot to compare with the previous one of nrc vs value-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = train_y.sp ~ nrc + ca_bids_all + Edu + Ener + Multi, 
    data = train_x.sp)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.3155  -1.2925   0.0838   1.3407   9.3581 

Coefficients:
             Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) 12.195462   0.005944 2051.686   &lt;2e-16 ***
nrc          0.277917   0.005491   50.612   &lt;2e-16 ***
ca_bids_all  0.173347   0.005470   31.692   &lt;2e-16 ***
Edu          0.225089   0.018657   12.064   &lt;2e-16 ***
Ener         1.032723   0.021591   47.832   &lt;2e-16 ***
Multi       -0.178013   0.398264   -0.447    0.655    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.069 on 145006 degrees of freedom
Multiple R-squared:  0.04415,   Adjusted R-squared:  0.04412 
F-statistic:  1340 on 5 and 145006 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01716597</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70568.34</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
train_y ~ bs(nrc, degree = 3) + bs(ca_bids_all, degree = 3) + 
    AFR + EAP + ECA + LCR + MNA + SAR + ca_Consul.Service + ca_Goods + 
    ca_proc_open + ca_proc_quality + ca_proc_source + ca_proc_restricted + 
    corr_signp1 + corr_signp2 + corr_signp3 + taxhaven + not.taxhaven + 
    P + Health + Edu + W + I + Tran + Fin + A + Ener + Info + 
    H + Multi + Priv

Parametric coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  10.24556    0.22866  44.806  &lt; 2e-16 ***
bs(nrc, degree = 3)1          0.83188    0.07045  11.807  &lt; 2e-16 ***
bs(nrc, degree = 3)2          0.64910    0.07630   8.507  &lt; 2e-16 ***
bs(nrc, degree = 3)3          0.71961    0.02955  24.356  &lt; 2e-16 ***
bs(ca_bids_all, degree = 3)1 -0.07827    0.36783  -0.213  0.83150    
bs(ca_bids_all, degree = 3)2  6.43106    1.63680   3.929 8.53e-05 ***
bs(ca_bids_all, degree = 3)3 -0.64031    0.75370  -0.850  0.39557    
AFR                           1.82642    0.03962  46.100  &lt; 2e-16 ***
EAP                           1.70413    0.04063  41.944  &lt; 2e-16 ***
ECA                           1.63749    0.03979  41.158  &lt; 2e-16 ***
LCR                           1.30747    0.03976  32.884  &lt; 2e-16 ***
MNA                           1.98542    0.04169  47.623  &lt; 2e-16 ***
SAR                           1.78463    0.04135  43.156  &lt; 2e-16 ***
ca_Consul.Service            -1.26199    0.03122 -40.428  &lt; 2e-16 ***
ca_Goods                     -0.63796    0.01323 -48.204  &lt; 2e-16 ***
ca_proc_open                 -0.42812    0.03361 -12.739  &lt; 2e-16 ***
ca_proc_quality              -0.91561    0.02399 -38.174  &lt; 2e-16 ***
ca_proc_source               -0.76538    0.01804 -42.417  &lt; 2e-16 ***
ca_proc_restricted           -1.38403    0.03981 -34.767  &lt; 2e-16 ***
corr_signp1                   0.53926    0.01612  33.450  &lt; 2e-16 ***
corr_signp2                   0.32408    0.01723  18.805  &lt; 2e-16 ***
corr_signp3                   0.75086    0.02056  36.521  &lt; 2e-16 ***
taxhaven                      0.86965    0.03552  24.482  &lt; 2e-16 ***
not.taxhaven                  0.83840    0.01265  66.259  &lt; 2e-16 ***
P                            -0.16916    0.26336  -0.642  0.52066    
Health                        0.42271    0.26350   1.604  0.10867    
Edu                           0.70060    0.26369   2.657  0.00789 ** 
W                             0.79292    0.26368   3.007  0.00264 ** 
I                             0.15557    0.26414   0.589  0.55589    
Tran                          1.27607    0.26362   4.841 1.30e-06 ***
Fin                           0.15867    0.26461   0.600  0.54876    
A                             0.82551    0.26374   3.130  0.00175 ** 
Ener                          1.34328    0.26388   5.090 3.58e-07 ***
Info                         -0.04931    0.26670  -0.185  0.85333    
H                             0.70120    0.36051   1.945  0.05178 .  
Multi                         0.15113    0.46191   0.327  0.74352    
Priv                          1.80728    1.87819   0.962  0.33593    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Rank: 36/37
R-sq.(adj) =  0.229   Deviance explained = 22.9%
GCV = 3.4586  Scale est. = 3.4577    n = 145307</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01400472</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56856.29</code></pre>
</div>
</div>
</section>
<section id="regression-tree" class="level2">
<h2 class="anchored" data-anchor-id="regression-tree">Regression Tree</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   161452 obs. of  39 variables:
 $ ca_contract_valuec: chr  "50.000-199.999" "200.000-" "200.000-" "200.000-" ...
 $ lca_contract_value: num  12 12.4 12.3 13.5 11.3 ...
 $ AFR               : num  1 1 1 1 1 1 1 1 1 1 ...
 $ EAP               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ECA               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ LCR               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ MNA               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ SAR               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ca_Consul.Service : num  0 0 0 1 0 0 0 0 0 0 ...
 $ ca_Goods          : num  0 0 0 0 1 0 1 1 1 1 ...
 $ ca_bids_all       : int  6 3 3 1 5 6 1 6 5 2 ...
 $ ca_proc_open      : num  1 1 1 0 1 1 0 1 1 1 ...
 $ ca_proc_quality   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ca_proc_source    : num  0 0 0 1 0 0 1 0 0 0 ...
 $ ca_proc_restricted: num  0 0 0 0 0 0 0 0 0 0 ...
 $ singleb           : num  0 0 0 1 0 0 1 0 0 0 ...
 $ corr_signp1       : num  1 0 0 0 1 0 0 1 1 0 ...
 $ corr_signp2       : int  0 0 0 0 0 0 1 0 0 1 ...
 $ corr_signp3       : int  0 0 0 1 0 0 0 0 0 0 ...
 $ nrc               : int  858 858 858 858 858 858 858 858 858 858 ...
 $ taxhaven          : num  0 0 0 0 0 0 0 0 0 0 ...
 $ not.taxhaven      : num  0 0 0 1 1 0 1 1 1 0 ...
 $ cri_wb.d0         : num  1 0 0 0 1 0 0 1 1 0 ...
 $ cri_wb.d25        : num  0 1 1 0 0 1 0 0 0 1 ...
 $ cri_wb.d50        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ cri_wb.d75        : num  0 0 0 1 0 0 1 0 0 0 ...
 $ P                 : num  1 0 0 0 0 1 0 0 0 0 ...
 $ Health            : num  0 1 0 0 0 0 1 0 0 0 ...
 $ Edu               : num  0 0 1 0 0 0 0 0 0 0 ...
 $ W                 : num  0 0 0 1 0 0 0 0 0 0 ...
 $ I                 : num  0 0 0 0 1 0 0 1 0 0 ...
 $ Tran              : num  0 0 0 0 0 0 0 0 1 0 ...
 $ Fin               : num  0 0 0 0 0 0 0 0 0 1 ...
 $ A                 : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Ener              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Info              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ H                 : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Multi             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Priv              : num  0 0 0 0 0 0 0 0 0 0 ...
 - attr(*, "na.action")= 'omit' Named int [1:13] 59655 59815 138472 138473 138474 138475 138476 138477 138478 138479 ...
  ..- attr(*, "names")= chr [1:13] "59655" "59815" "138472" "138473" ...</code></pre>
</div>
</div>
<p>We need to recode dummies as factors for the decision tree.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `all_of()` outside of a selecting function was deprecated in tidyselect
1.2.0.
ℹ See details at
  &lt;https://tidyselect.r-lib.org/reference/faq-selection-context.html&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(cols_for_factor)

  # Now:
  data %&gt;% select(all_of(cols_for_factor))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   161452 obs. of  34 variables:
 $ lca_contract_value: num  12 12.4 12.3 13.5 11.3 ...
 $ AFR               : Factor w/ 2 levels "0","1": 2 2 2 2 2 2 2 2 2 2 ...
 $ EAP               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ ECA               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ LCR               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ MNA               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ SAR               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ ca_Consul.Service : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 1 1 1 1 ...
 $ ca_Goods          : Factor w/ 2 levels "0","1": 1 1 1 1 2 1 2 2 2 2 ...
 $ ca_bids_all       : int  6 3 3 1 5 6 1 6 5 2 ...
 $ ca_proc_open      : Factor w/ 2 levels "0","1": 2 2 2 1 2 2 1 2 2 2 ...
 $ ca_proc_quality   : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ ca_proc_source    : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 2 1 1 1 ...
 $ ca_proc_restricted: Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ singleb           : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 2 1 1 1 ...
 $ corr_signp1       : Factor w/ 2 levels "0","1": 2 1 1 1 2 1 1 2 2 1 ...
 $ corr_signp2       : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 2 1 1 2 ...
 $ corr_signp3       : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 1 1 1 1 ...
 $ nrc               : int  858 858 858 858 858 858 858 858 858 858 ...
 $ taxhaven          : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ not.taxhaven      : Factor w/ 2 levels "0","1": 1 1 1 2 2 1 2 2 2 1 ...
 $ P                 : Factor w/ 2 levels "0","1": 2 1 1 1 1 2 1 1 1 1 ...
 $ Health            : Factor w/ 2 levels "0","1": 1 2 1 1 1 1 2 1 1 1 ...
 $ Edu               : Factor w/ 2 levels "0","1": 1 1 2 1 1 1 1 1 1 1 ...
 $ W                 : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 1 1 1 1 ...
 $ I                 : Factor w/ 2 levels "0","1": 1 1 1 1 2 1 1 2 1 1 ...
 $ Tran              : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 2 1 ...
 $ Fin               : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 2 ...
 $ A                 : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ Ener              : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ Info              : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ H                 : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ Multi             : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ Priv              : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, "na.action")= 'omit' Named int [1:13] 59655 59815 138472 138473 138474 138475 138476 138477 138478 138479 ...
  ..- attr(*, "names")= chr [1:13] "59655" "59815" "138472" "138473" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/plot for the first tree-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>n= 145307 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 145307 651308.50 12.28944  
   2) ca_proc_open=0 64392 263413.50 11.67573  
     4) not.taxhaven=0 43530 174856.70 11.34876  
       8) nrc&lt; 4495.5 32645 124934.50 11.12766  
        16) AFR=0 23100  90592.66 10.81381 *
        17) AFR=1 9545  26559.77 11.88722 *
       9) nrc&gt;=4495.5 10885  43540.74 12.01183 *
     5) not.taxhaven=1 20862  74191.81 12.35800 *
   3) ca_proc_open=1 80915 344342.10 12.77783  
     6) P=1 22287  76991.40 11.79576 *
     7) P=0 58628 237684.10 13.15116  
      14) Tran=0 48010 179324.80 12.97448  
        28) Ener=0 41969 148938.10 12.82764 *
        29) Ener=1 6041  23194.13 13.99469 *
      15) Tran=1 10618  50084.31 13.95003 *</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/plot size of the tree-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          CP nsplit rel error    xerror        xstd
1 0.06686981      0 1.0000000 1.0000376 0.004230378
2 0.04554926      1 0.9331302 0.9331805 0.003978562
3 0.02205551      2 0.8875809 0.8876452 0.003861356
4 0.01270517      3 0.8655254 0.8656022 0.003788718
5 0.01104325      4 0.8528203 0.8529071 0.003725318
6 0.01087315      5 0.8417770 0.8448465 0.003705916
7 0.01000000      7 0.8200307 0.8201653 0.003598033</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01486034</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60814.71</code></pre>
</div>
</div>
</section>
<section id="tuning-regression-tree" class="level2">
<h2 class="anchored" data-anchor-id="tuning-regression-tree">Tuning Regression Tree</h2>
<p>WARNING: Takes a lot of time to run</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 12.26575 mins</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  minsplit maxdepth   cp     error
1        6       10 0.01 0.8200839
2        9       15 0.01 0.8200990
3       13        8 0.01 0.8200991
4       17       15 0.01 0.8201020
5       15       15 0.01 0.8201025</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01486034</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60814.71</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/plot for the tuned tree-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Absolutely no difference between the automatically optimized regression tree and the tuned one.</p>
</section>
<section id="bagging" class="level2">
<h2 class="anchored" data-anchor-id="bagging">Bagging</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Bagging regression trees with 25 bootstrap replications 

Call: bagging.data.frame(formula = train_y.t ~ ., data = train_x.t, 
    coob = TRUE, importance = TRUE)

Out-of-bag estimate of root mean squared error:  1.9175 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/plot for var importance-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01477689</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60813.53</code></pre>
</div>
</div>
<p>WARNING: Takes time to run</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 22.36131 mins</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/plot ntree vs RMSE-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the error drops and suddenly rises. After that the fall is slower. Given that 11 bootstraps give the lowest error before the default of 25, we can use it to reduce computation time.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.917357</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Bagging regression trees with 11 bootstrap replications 

Call: bagging.data.frame(formula = train_y.t ~ ., data = train_x.t, 
    coob = TRUE, nbagg = 11)

Out-of-bag estimate of root mean squared error:  1.9174 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01353659</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60816.51</code></pre>
</div>
</div>
</section>
<section id="support-vector-machine" class="level2">
<h2 class="anchored" data-anchor-id="support-vector-machine">Support Vector Machine</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plotting nrc vs bidders and looking at classes-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   161125 obs. of  39 variables:
 $ ca_contract_valuec: chr  "50.000-199.999" "200.000-" "200.000-" "200.000-" ...
 $ lca_contract_value: num  12 12.4 12.3 13.5 11.3 ...
 $ AFR               : num  1 1 1 1 1 1 1 1 1 1 ...
 $ EAP               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ECA               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ LCR               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ MNA               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ SAR               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ca_Consul.Service : num  0 0 0 1 0 0 0 0 0 0 ...
 $ ca_Goods          : num  0 0 0 0 1 0 1 1 1 1 ...
 $ ca_bids_all       : num  0.553 -0.14 -0.14 -0.603 0.322 ...
 $ ca_proc_open      : num  1 1 1 0 1 1 0 1 1 1 ...
 $ ca_proc_quality   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ca_proc_source    : num  0 0 0 1 0 0 1 0 0 0 ...
 $ ca_proc_restricted: num  0 0 0 0 0 0 0 0 0 0 ...
 $ singleb           : num  0 0 0 1 0 0 1 0 0 0 ...
 $ corr_signp1       : num  1 0 0 0 1 0 0 1 1 0 ...
 $ corr_signp2       : int  0 0 0 0 0 0 1 0 0 1 ...
 $ corr_signp3       : int  0 0 0 1 0 0 0 0 0 0 ...
 $ nrc               : num  -0.841 -0.841 -0.841 -0.841 -0.841 ...
 $ taxhaven          : num  0 0 0 0 0 0 0 0 0 0 ...
 $ not.taxhaven      : num  0 0 0 1 1 0 1 1 1 0 ...
 $ cri_wb.d0         : num  1 0 0 0 1 0 0 1 1 0 ...
 $ cri_wb.d25        : num  0 1 1 0 0 1 0 0 0 1 ...
 $ cri_wb.d50        : num  0 0 0 0 0 0 0 0 0 0 ...
 $ cri_wb.d75        : num  0 0 0 1 0 0 1 0 0 0 ...
 $ P                 : num  1 0 0 0 0 1 0 0 0 0 ...
 $ Health            : num  0 1 0 0 0 0 1 0 0 0 ...
 $ Edu               : num  0 0 1 0 0 0 0 0 0 0 ...
 $ W                 : num  0 0 0 1 0 0 0 0 0 0 ...
 $ I                 : num  0 0 0 0 1 0 0 1 0 0 ...
 $ Tran              : num  0 0 0 0 0 0 0 0 1 0 ...
 $ Fin               : num  0 0 0 0 0 0 0 0 0 1 ...
 $ A                 : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Ener              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Info              : num  0 0 0 0 0 0 0 0 0 0 ...
 $ H                 : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Multi             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Priv              : num  0 0 0 0 0 0 0 0 0 0 ...
 - attr(*, "na.action")= 'omit' Named int [1:13] 59655 59815 138472 138473 138474 138475 138476 138477 138478 138479 ...
  ..- attr(*, "names")= chr [1:13] "59655" "59815" "138472" "138473" ...</code></pre>
</div>
</div>
<p>We need scaled data, because the svm models take very long to run.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `funs()` was deprecated in dplyr 0.8.0.
ℹ Please use a list of either functions or lambdas:

# Simple named list: list(mean = mean, median = median)

# Auto named with `tibble::lst()`: tibble::lst(mean, median)

# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       abv200k        nrc ca_bids_all P
122931       0 -0.4101392  1.01534588 0
98909        1 -0.1583185 -0.14045500 0
65611        1  0.9206223  0.09070517 0
95847        1 -0.4101392  2.63346713 0
91914        1 -0.7741290 -0.37161518 0
62368        1  0.9206223 -0.14045500 0</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>119261 139363 107621 129186  93690  85110 
     1      1      0      0      1      0 
Levels: 0 1</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6296549</code></pre>
</div>
</div>
<p>WARNING: The next chunk is very time-consuming.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
best.tune(METHOD = svm, train.x = abv200k ~ ., data = Procurement.svm[tune_idx.svm, 
    ], ranges = list(cost = c(0.1, 1, 10, 100), gamma = c(0.25, 0.5, 
    1, 2)), kernel = "radial")


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  1 

Number of Support Vectors:  3783</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 3.187033 mins</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6310204</code></pre>
</div>
</div>
</section>
<section id="comparing-rmse-sse-prediction-rate-and-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="comparing-rmse-sse-prediction-rate-and-conclusion">Comparing RMSE, SSE, &amp; Prediction rate and Conclusion</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          model.var   rmse.var  sse.var
1        lm_ridge.c 0.01447194 56996.77
2       lm_ridge.c2 0.01409955 57044.26
3 spline_model.bids 0.01356418 70454.60
4 spline_model.gam3 0.01400472 56856.29
5        tuned_tree 0.01486034 60814.71
6         bag_tree2 0.01353659 60816.51</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot RMSE-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot SSE-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  pred.rate        pred.model
1 0.6688758 log_model_train.2
2 0.7591205              knn3
3 0.6310204          svm.tune</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/Plot for classifications correctness rates-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="further-discussion" class="level2">
<h2 class="anchored" data-anchor-id="further-discussion">Further discussion</h2>
<p>There is a variable for period between the time of award of the contract and the signing of the said contract. I excluded the variable for now, since there are many missing values and the effect on the value is unclear.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
   248000 character character </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
-29231.00      5.00     20.00     30.14     48.00   4384.00     11857 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02747345</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    n
1 195</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing non-finite values (stat_smooth).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ml_procurement_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb175" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Procurement Contracts"</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co">    freeze: auto</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>I use ML techniques to predict and classify the value of the Procurement Contracts.</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Preliminary Data, echo = TRUE}</span></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>Procurement <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Procurement.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(Procurement)</span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Libraries</span></span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r opening necessary packages}</span></span>
<span id="cb175-28"><a href="#cb175-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb175-29"><a href="#cb175-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb175-30"><a href="#cb175-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb175-31"><a href="#cb175-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Ecdat)</span>
<span id="cb175-32"><a href="#cb175-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb175-33"><a href="#cb175-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb175-34"><a href="#cb175-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-35"><a href="#cb175-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-36"><a href="#cb175-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-37"><a href="#cb175-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stats</span></span>
<span id="cb175-38"><a href="#cb175-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-39"><a href="#cb175-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Stats}</span></span>
<span id="cb175-40"><a href="#cb175-40" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement<span class="sc">$</span>cri_wb) <span class="co">#NA's 86,535</span></span>
<span id="cb175-41"><a href="#cb175-41" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">86535</span><span class="sc">/</span><span class="dv">248000</span>) <span class="co">#percent of total obs. Will impute later</span></span>
<span id="cb175-42"><a href="#cb175-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">248000-86535</span>) <span class="co">#n of total obs</span></span>
<span id="cb175-43"><a href="#cb175-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-44"><a href="#cb175-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-45"><a href="#cb175-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-46"><a href="#cb175-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-47"><a href="#cb175-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleaning</span></span>
<span id="cb175-48"><a href="#cb175-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-49"><a href="#cb175-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ommitting NAs and creating Procurement2}</span></span>
<span id="cb175-50"><a href="#cb175-50" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement <span class="sc">%&gt;%</span> </span>
<span id="cb175-51"><a href="#cb175-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cri_wb))</span>
<span id="cb175-52"><a href="#cb175-52" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2)</span>
<span id="cb175-53"><a href="#cb175-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-54"><a href="#cb175-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-55"><a href="#cb175-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis of Variables</span></span>
<span id="cb175-56"><a href="#cb175-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-57"><a href="#cb175-57" aria-hidden="true" tabindex="-1"></a>Seeing unique values of categorical vars and descriptive stats of numerical ones.</span>
<span id="cb175-58"><a href="#cb175-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-59"><a href="#cb175-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cft_methodtype}</span></span>
<span id="cb175-60"><a href="#cb175-60" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>cft_methodtype)</span>
<span id="cb175-61"><a href="#cb175-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-62"><a href="#cb175-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-63"><a href="#cb175-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cft_sector}</span></span>
<span id="cb175-64"><a href="#cb175-64" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>cft_sector)</span>
<span id="cb175-65"><a href="#cb175-65" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>cft_sector)</span>
<span id="cb175-66"><a href="#cb175-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-67"><a href="#cb175-67" aria-hidden="true" tabindex="-1"></a>Sector can be divided into dummies later </span>
<span id="cb175-68"><a href="#cb175-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-69"><a href="#cb175-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_type}</span></span>
<span id="cb175-70"><a href="#cb175-70" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>ca_type)</span>
<span id="cb175-71"><a href="#cb175-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-72"><a href="#cb175-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-73"><a href="#cb175-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_nrbidsrec}</span></span>
<span id="cb175-74"><a href="#cb175-74" aria-hidden="true" tabindex="-1"></a><span class="co">#N of bids recieved</span></span>
<span id="cb175-75"><a href="#cb175-75" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>ca_nrbidsrec)</span>
<span id="cb175-76"><a href="#cb175-76" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>ca_nrbidsrec)</span>
<span id="cb175-77"><a href="#cb175-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-78"><a href="#cb175-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-79"><a href="#cb175-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_nrbidscons}</span></span>
<span id="cb175-80"><a href="#cb175-80" aria-hidden="true" tabindex="-1"></a><span class="co">#N of bids considered</span></span>
<span id="cb175-81"><a href="#cb175-81" aria-hidden="true" tabindex="-1"></a><span class="co">#Was a character class, so transformed into a numerical one</span></span>
<span id="cb175-82"><a href="#cb175-82" aria-hidden="true" tabindex="-1"></a><span class="co">#Empty spaces treated as if 0</span></span>
<span id="cb175-83"><a href="#cb175-83" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>ca_nrbidscons)</span>
<span id="cb175-84"><a href="#cb175-84" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>ca_nrbidscons)</span>
<span id="cb175-85"><a href="#cb175-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-86"><a href="#cb175-86" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-87"><a href="#cb175-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bidscons =</span> <span class="fu">as.numeric</span>(ca_nrbidscons)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-88"><a href="#cb175-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bidscons =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(bidscons), <span class="dv">0</span>, bidscons))</span>
<span id="cb175-89"><a href="#cb175-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-90"><a href="#cb175-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-91"><a href="#cb175-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r corr_signp1}</span></span>
<span id="cb175-92"><a href="#cb175-92" aria-hidden="true" tabindex="-1"></a><span class="co">#signature period from 14 to 93 days</span></span>
<span id="cb175-93"><a href="#cb175-93" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-94"><a href="#cb175-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">corr_signp1 =</span> <span class="fu">as.numeric</span>(corr_signp1))</span>
<span id="cb175-95"><a href="#cb175-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-96"><a href="#cb175-96" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>corr_signp1)</span>
<span id="cb175-97"><a href="#cb175-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-98"><a href="#cb175-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-99"><a href="#cb175-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-100"><a href="#cb175-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_contract_value}</span></span>
<span id="cb175-101"><a href="#cb175-101" aria-hidden="true" tabindex="-1"></a><span class="co">#Value of the contract</span></span>
<span id="cb175-102"><a href="#cb175-102" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-103"><a href="#cb175-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cntrct_val =</span> <span class="fu">as.numeric</span>(ca_contract_value))</span>
<span id="cb175-104"><a href="#cb175-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-105"><a href="#cb175-105" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>ca_contract_value)</span>
<span id="cb175-106"><a href="#cb175-106" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>cntrct_val)</span>
<span id="cb175-107"><a href="#cb175-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-108"><a href="#cb175-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-109"><a href="#cb175-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-110"><a href="#cb175-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-111"><a href="#cb175-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lca_contract_value}</span></span>
<span id="cb175-112"><a href="#cb175-112" aria-hidden="true" tabindex="-1"></a><span class="co">#Value of the contract logged</span></span>
<span id="cb175-113"><a href="#cb175-113" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>lca_contract_value)</span>
<span id="cb175-114"><a href="#cb175-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-115"><a href="#cb175-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-116"><a href="#cb175-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-117"><a href="#cb175-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_contract_valuec}</span></span>
<span id="cb175-118"><a href="#cb175-118" aria-hidden="true" tabindex="-1"></a><span class="co">#Contract Value Categories</span></span>
<span id="cb175-119"><a href="#cb175-119" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>ca_contract_valuec)</span>
<span id="cb175-120"><a href="#cb175-120" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>ca_contract_valuec)</span>
<span id="cb175-121"><a href="#cb175-121" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>ca_contract_valuec)</span>
<span id="cb175-122"><a href="#cb175-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-123"><a href="#cb175-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-124"><a href="#cb175-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_procedure}</span></span>
<span id="cb175-125"><a href="#cb175-125" aria-hidden="true" tabindex="-1"></a><span class="co">#Main procurement type category</span></span>
<span id="cb175-126"><a href="#cb175-126" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>ca_procedure)</span>
<span id="cb175-127"><a href="#cb175-127" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>ca_procedure)</span>
<span id="cb175-128"><a href="#cb175-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-129"><a href="#cb175-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-130"><a href="#cb175-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ca_signper}</span></span>
<span id="cb175-131"><a href="#cb175-131" aria-hidden="true" tabindex="-1"></a><span class="co">#Signature Period (probably in days)</span></span>
<span id="cb175-132"><a href="#cb175-132" aria-hidden="true" tabindex="-1"></a><span class="co">#Was character class</span></span>
<span id="cb175-133"><a href="#cb175-133" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-134"><a href="#cb175-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">signper =</span> <span class="fu">as.numeric</span>(ca_signper))</span>
<span id="cb175-135"><a href="#cb175-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-136"><a href="#cb175-136" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>signper)</span>
<span id="cb175-137"><a href="#cb175-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-138"><a href="#cb175-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-139"><a href="#cb175-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-140"><a href="#cb175-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SuppAwd}</span></span>
<span id="cb175-141"><a href="#cb175-141" aria-hidden="true" tabindex="-1"></a><span class="co">#Unclear</span></span>
<span id="cb175-142"><a href="#cb175-142" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>SuppAwd)</span>
<span id="cb175-143"><a href="#cb175-143" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>SuppAwd)</span>
<span id="cb175-144"><a href="#cb175-144" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>SuppAwd)</span>
<span id="cb175-145"><a href="#cb175-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-146"><a href="#cb175-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-147"><a href="#cb175-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sec_score}</span></span>
<span id="cb175-148"><a href="#cb175-148" aria-hidden="true" tabindex="-1"></a><span class="co">#Supplier country secrecy score</span></span>
<span id="cb175-149"><a href="#cb175-149" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>sec_score)</span>
<span id="cb175-150"><a href="#cb175-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-151"><a href="#cb175-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-152"><a href="#cb175-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r procedure_type}</span></span>
<span id="cb175-153"><a href="#cb175-153" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>procedure_type)</span>
<span id="cb175-154"><a href="#cb175-154" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>procedure_type)</span>
<span id="cb175-155"><a href="#cb175-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-156"><a href="#cb175-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-157"><a href="#cb175-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r taxhav}</span></span>
<span id="cb175-158"><a href="#cb175-158" aria-hidden="true" tabindex="-1"></a><span class="co">#Whether tax haven or not</span></span>
<span id="cb175-159"><a href="#cb175-159" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>taxhav)</span>
<span id="cb175-160"><a href="#cb175-160" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>taxhav)</span>
<span id="cb175-161"><a href="#cb175-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-162"><a href="#cb175-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-163"><a href="#cb175-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r taxhav_fixed (Time invariant)}</span></span>
<span id="cb175-164"><a href="#cb175-164" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>taxhav_fixed)</span>
<span id="cb175-165"><a href="#cb175-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-166"><a href="#cb175-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-167"><a href="#cb175-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-168"><a href="#cb175-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r taxhav3bi}</span></span>
<span id="cb175-169"><a href="#cb175-169" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>taxhav3bi)</span>
<span id="cb175-170"><a href="#cb175-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-171"><a href="#cb175-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-174"><a href="#cb175-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-175"><a href="#cb175-175" aria-hidden="true" tabindex="-1"></a><span class="co">#Corruption Risk Index, according to GTI</span></span>
<span id="cb175-176"><a href="#cb175-176" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement2<span class="sc">$</span>cri_wb)</span>
<span id="cb175-177"><a href="#cb175-177" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>cri_wb)</span>
<span id="cb175-178"><a href="#cb175-178" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Procurement2<span class="sc">$</span>cri_wb)</span>
<span id="cb175-179"><a href="#cb175-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-180"><a href="#cb175-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-181"><a href="#cb175-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Create cri_wb character}</span></span>
<span id="cb175-182"><a href="#cb175-182" aria-hidden="true" tabindex="-1"></a><span class="co">#creating cri_wb character var for plotting</span></span>
<span id="cb175-183"><a href="#cb175-183" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-184"><a href="#cb175-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cri_wb.ch =</span> <span class="fu">as.character</span>(cri_wb))</span>
<span id="cb175-185"><a href="#cb175-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-186"><a href="#cb175-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-187"><a href="#cb175-187" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot</span></span>
<span id="cb175-188"><a href="#cb175-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-191"><a href="#cb175-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-192"><a href="#cb175-192" aria-hidden="true" tabindex="-1"></a><span class="co"># plot cri_wb</span></span>
<span id="cb175-193"><a href="#cb175-193" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(Procurement2<span class="sc">$</span>cri_wb))</span>
<span id="cb175-194"><a href="#cb175-194" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">hist</span>(Procurement2<span class="sc">$</span>cri_wb))</span>
<span id="cb175-195"><a href="#cb175-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-196"><a href="#cb175-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-199"><a href="#cb175-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-200"><a href="#cb175-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot distribution</span></span>
<span id="cb175-201"><a href="#cb175-201" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-202"><a href="#cb175-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cri_wb, <span class="at">colour=</span>region)) <span class="sc">+</span> </span>
<span id="cb175-203"><a href="#cb175-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb175-204"><a href="#cb175-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-205"><a href="#cb175-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-206"><a href="#cb175-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-209"><a href="#cb175-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-210"><a href="#cb175-210" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot by cri_wb and region</span></span>
<span id="cb175-211"><a href="#cb175-211" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="sc">%&gt;%</span>  </span>
<span id="cb175-212"><a href="#cb175-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cri_wb.ch, region) <span class="sc">%&gt;%</span>  </span>
<span id="cb175-213"><a href="#cb175-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb175-214"><a href="#cb175-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>region, <span class="at">y=</span>Count, <span class="at">fill=</span>cri_wb.ch)) <span class="sc">+</span> </span>
<span id="cb175-215"><a href="#cb175-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>, <span class="at">position=</span> <span class="st">"dodge"</span>)</span>
<span id="cb175-216"><a href="#cb175-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-217"><a href="#cb175-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-218"><a href="#cb175-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-221"><a href="#cb175-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-222"><a href="#cb175-222" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot of lca_contract_value</span></span>
<span id="cb175-223"><a href="#cb175-223" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(<span class="fu">na.omit</span>(Procurement2<span class="sc">$</span>lca_contract_value)))</span>
<span id="cb175-224"><a href="#cb175-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-225"><a href="#cb175-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-228"><a href="#cb175-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-229"><a href="#cb175-229" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot lca_contract_value by region</span></span>
<span id="cb175-230"><a href="#cb175-230" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-231"><a href="#cb175-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lca_contract_value, <span class="at">color=</span>region)) <span class="sc">+</span> </span>
<span id="cb175-232"><a href="#cb175-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb175-233"><a href="#cb175-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-234"><a href="#cb175-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-235"><a href="#cb175-235" aria-hidden="true" tabindex="-1"></a>We can observe some differences, for example between regions like Sub-Saharan Africa and Latin America.</span>
<span id="cb175-236"><a href="#cb175-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-239"><a href="#cb175-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-240"><a href="#cb175-240" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot lca_contract_value by sector</span></span>
<span id="cb175-241"><a href="#cb175-241" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-242"><a href="#cb175-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lca_contract_value, <span class="at">color=</span>cft_sector)) <span class="sc">+</span> </span>
<span id="cb175-243"><a href="#cb175-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb175-244"><a href="#cb175-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-245"><a href="#cb175-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-246"><a href="#cb175-246" aria-hidden="true" tabindex="-1"></a>Again some differences are seen between for example Energy&amp;Mining and Law, which makes sense, since Mining requires more costly equipment. The sector without a name seems to be an outlier almost.</span>
<span id="cb175-247"><a href="#cb175-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-250"><a href="#cb175-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-251"><a href="#cb175-251" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot average lca_contract_value over time</span></span>
<span id="cb175-252"><a href="#cb175-252" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-253"><a href="#cb175-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, lca_contract_value) <span class="sc">%&gt;%</span> </span>
<span id="cb175-254"><a href="#cb175-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>lca_contract_value, <span class="at">x=</span>year)) <span class="sc">+</span></span>
<span id="cb175-255"><a href="#cb175-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"line"</span>)</span>
<span id="cb175-256"><a href="#cb175-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-257"><a href="#cb175-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-258"><a href="#cb175-258" aria-hidden="true" tabindex="-1"></a>Generally increasing trend of average value per contract.</span>
<span id="cb175-259"><a href="#cb175-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-260"><a href="#cb175-260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression</span></span>
<span id="cb175-261"><a href="#cb175-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-262"><a href="#cb175-262" aria-hidden="true" tabindex="-1"></a>I run a simple regression with variables of interest to see if anything interesting happens</span>
<span id="cb175-263"><a href="#cb175-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-266"><a href="#cb175-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-267"><a href="#cb175-267" aria-hidden="true" tabindex="-1"></a><span class="co">#Simple Regression for the logged Value</span></span>
<span id="cb175-268"><a href="#cb175-268" aria-hidden="true" tabindex="-1"></a>lr1 <span class="ot">=</span> <span class="fu">lm</span>(lca_contract_value <span class="sc">~</span> region <span class="sc">+</span> ca_type <span class="sc">+</span> ca_bids_all <span class="sc">+</span> ca_procedure <span class="sc">+</span> singleb <span class="sc">+</span> corr_signp2 <span class="sc">+</span> corr_signp3 <span class="sc">+</span> corr_signp4 <span class="sc">+</span> nrc <span class="sc">+</span> taxhav_fixed <span class="sc">+</span> cri_wb, <span class="at">data =</span> Procurement2)</span>
<span id="cb175-269"><a href="#cb175-269" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr1)</span>
<span id="cb175-270"><a href="#cb175-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-271"><a href="#cb175-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-272"><a href="#cb175-272" aria-hidden="true" tabindex="-1"></a>Adjusted R-squared is about 0.17, whereas cri_wb is dropped because of singularity. </span>
<span id="cb175-273"><a href="#cb175-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-276"><a href="#cb175-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-277"><a href="#cb175-277" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(lr1)</span>
<span id="cb175-278"><a href="#cb175-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-279"><a href="#cb175-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-280"><a href="#cb175-280" aria-hidden="true" tabindex="-1"></a>RSS is quite big.</span>
<span id="cb175-281"><a href="#cb175-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-282"><a href="#cb175-282" aria-hidden="true" tabindex="-1"></a>The variable for cri_wb was omitted due to singularities. Perhaps creating a dummy might change it.</span>
<span id="cb175-283"><a href="#cb175-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-286"><a href="#cb175-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-287"><a href="#cb175-287" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating cri_wb dummy</span></span>
<span id="cb175-288"><a href="#cb175-288" aria-hidden="true" tabindex="-1"></a><span class="co">#0.00 0.25 0.75 0.50 1.00</span></span>
<span id="cb175-289"><a href="#cb175-289" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-290"><a href="#cb175-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cri_wb.d0 =</span> <span class="fu">ifelse</span>(cri_wb<span class="sc">==</span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-291"><a href="#cb175-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cri_wb.d25 =</span> <span class="fu">ifelse</span>(cri_wb<span class="sc">==</span><span class="fl">0.25</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-292"><a href="#cb175-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cri_wb.d50 =</span> <span class="fu">ifelse</span>(cri_wb<span class="sc">==</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-293"><a href="#cb175-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cri_wb.d75 =</span> <span class="fu">ifelse</span>(cri_wb<span class="sc">==</span><span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-294"><a href="#cb175-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-295"><a href="#cb175-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-296"><a href="#cb175-296" aria-hidden="true" tabindex="-1"></a>I am creating several dummies for categorical vars.</span>
<span id="cb175-297"><a href="#cb175-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-300"><a href="#cb175-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-301"><a href="#cb175-301" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating cft_sector dummmies, omitting ""</span></span>
<span id="cb175-302"><a href="#cb175-302" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-303"><a href="#cb175-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Public admin, Law"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-304"><a href="#cb175-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Health =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Health &amp; social serv"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-305"><a href="#cb175-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Edu =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Education"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-306"><a href="#cb175-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">W =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Water/sanit/fld prot"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-307"><a href="#cb175-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Industry and trade"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-308"><a href="#cb175-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tran =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Transportation"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-309"><a href="#cb175-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fin =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Finance"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-310"><a href="#cb175-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">A =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Agriculture"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-311"><a href="#cb175-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ener =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Energy &amp; mining"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-312"><a href="#cb175-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Info =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"Info &amp; communication"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-313"><a href="#cb175-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"(H)"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-314"><a href="#cb175-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Multi =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"(H)Multisector"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-315"><a href="#cb175-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Priv =</span> <span class="fu">ifelse</span>(cft_sector<span class="sc">==</span><span class="st">"(H)Priv Sector Dev"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-316"><a href="#cb175-316" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(Procurement2<span class="sc">$</span>cft_sector)</span>
<span id="cb175-317"><a href="#cb175-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-318"><a href="#cb175-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-321"><a href="#cb175-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-322"><a href="#cb175-322" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-323"><a href="#cb175-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AFR =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"AFR"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-324"><a href="#cb175-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EAP =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"EAP"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-325"><a href="#cb175-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ECA =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"ECA"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-326"><a href="#cb175-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LCR =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"LCR"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-327"><a href="#cb175-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MNA =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"MNA"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-328"><a href="#cb175-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAR =</span> <span class="fu">ifelse</span>(region<span class="sc">==</span><span class="st">"SAR"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-329"><a href="#cb175-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-330"><a href="#cb175-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-331"><a href="#cb175-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-334"><a href="#cb175-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-335"><a href="#cb175-335" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating ca_type dummies, omitting Civil Works</span></span>
<span id="cb175-336"><a href="#cb175-336" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-337"><a href="#cb175-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_Consul.Service =</span> <span class="fu">ifelse</span>(ca_type<span class="sc">==</span><span class="st">"Consultant Services"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-338"><a href="#cb175-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_Goods =</span> <span class="fu">ifelse</span>(ca_type<span class="sc">==</span><span class="st">"Goods"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-339"><a href="#cb175-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-340"><a href="#cb175-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-343"><a href="#cb175-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-344"><a href="#cb175-344" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating taxhav_fixed dummies, omitting domestric supplier</span></span>
<span id="cb175-345"><a href="#cb175-345" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-346"><a href="#cb175-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">not.taxhaven =</span> <span class="fu">ifelse</span>(taxhav_fixed<span class="sc">==</span><span class="st">"NO tax haven"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-347"><a href="#cb175-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taxhaven =</span> <span class="fu">ifelse</span>(taxhav_fixed<span class="sc">==</span><span class="st">"tax haven"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-348"><a href="#cb175-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-349"><a href="#cb175-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-352"><a href="#cb175-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-353"><a href="#cb175-353" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating ca_procedure dummies, omitting cost</span></span>
<span id="cb175-354"><a href="#cb175-354" aria-hidden="true" tabindex="-1"></a>Procurement2 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-355"><a href="#cb175-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_proc_open =</span> <span class="fu">ifelse</span>(ca_procedure<span class="sc">==</span><span class="st">"open"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-356"><a href="#cb175-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_proc_quality =</span> <span class="fu">ifelse</span>(ca_procedure<span class="sc">==</span><span class="st">"consultancy,quality"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-357"><a href="#cb175-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_proc_source =</span> <span class="fu">ifelse</span>(ca_procedure<span class="sc">==</span><span class="st">"single source"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-358"><a href="#cb175-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_proc_restricted =</span> <span class="fu">ifelse</span>(ca_procedure<span class="sc">==</span><span class="st">"restricted"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb175-359"><a href="#cb175-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-360"><a href="#cb175-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-361"><a href="#cb175-361" aria-hidden="true" tabindex="-1"></a>For regression of the value per contract I am selecting the following variables:</span>
<span id="cb175-362"><a href="#cb175-362" aria-hidden="true" tabindex="-1"></a><span class="ss">  1. </span>Dummy variables for region, because there was a slight difference between the distributions of value by regions.</span>
<span id="cb175-363"><a href="#cb175-363" aria-hidden="true" tabindex="-1"></a><span class="ss">  4. </span>Procurement Sector, thinking some sectors tend to attract more valuable tender contracts.</span>
<span id="cb175-364"><a href="#cb175-364" aria-hidden="true" tabindex="-1"></a><span class="ss">  2. </span>Dummy for ca_type (Procurement Category) since the type of services can affect the value</span>
<span id="cb175-365"><a href="#cb175-365" aria-hidden="true" tabindex="-1"></a><span class="ss">  3. </span>Dummy for for n of bidders since higher n of bidders should indicate a higher price of the contract.</span>
<span id="cb175-366"><a href="#cb175-366" aria-hidden="true" tabindex="-1"></a><span class="ss">  4. </span>Dummy for contract award procedure associated with corruption.</span>
<span id="cb175-367"><a href="#cb175-367" aria-hidden="true" tabindex="-1"></a><span class="ss">  5. </span>Dummy for single bidder might indicate corrupted case, which can imply high value of the contract.</span>
<span id="cb175-368"><a href="#cb175-368" aria-hidden="true" tabindex="-1"></a><span class="ss">  6. </span>Period between when the contract was awarded and signed.</span>
<span id="cb175-369"><a href="#cb175-369" aria-hidden="true" tabindex="-1"></a><span class="ss">  7. </span>Number of contracts per country.</span>
<span id="cb175-370"><a href="#cb175-370" aria-hidden="true" tabindex="-1"></a><span class="ss">  8. </span>Whether the supplier is a domestic one or a tax haven. Foreign tax havens might indicate corruption and thus higher price.</span>
<span id="cb175-371"><a href="#cb175-371" aria-hidden="true" tabindex="-1"></a><span class="ss">  9. </span>The Corruption Index might be associated with the higher value of the contract.</span>
<span id="cb175-372"><a href="#cb175-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-375"><a href="#cb175-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-376"><a href="#cb175-376" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating only predictor and response dataset Procurement3</span></span>
<span id="cb175-377"><a href="#cb175-377" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="ot">=</span> Procurement2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-378"><a href="#cb175-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ca_contract_valuec"</span>, <span class="st">"lca_contract_value"</span>, <span class="st">"AFR"</span>, <span class="st">"EAP"</span>, <span class="st">"ECA"</span>, <span class="st">"LCR"</span>, <span class="st">"MNA"</span>, <span class="st">"SAR"</span>, <span class="st">"ca_Consul.Service"</span>, <span class="st">"ca_Goods"</span>, <span class="st">"ca_bids_all"</span>, <span class="st">"ca_proc_open"</span>, <span class="st">"ca_proc_quality"</span>, <span class="st">"ca_proc_source"</span>, <span class="st">"ca_proc_restricted"</span>, <span class="st">"singleb"</span>, <span class="st">"corr_signp1"</span>, <span class="st">"corr_signp2"</span>, <span class="st">"corr_signp3"</span>, <span class="st">"nrc"</span>, <span class="st">"taxhaven"</span>, <span class="st">"not.taxhaven"</span>, <span class="st">"cri_wb.d0"</span>, <span class="st">"cri_wb.d25"</span>, <span class="st">"cri_wb.d50"</span>, <span class="st">"cri_wb.d75"</span>, <span class="st">"P"</span>, <span class="st">"Health"</span>, <span class="st">"Edu"</span>, <span class="st">"W"</span>, <span class="st">"I"</span>, <span class="st">"Tran"</span>, <span class="st">"Fin"</span>, <span class="st">"A"</span>, <span class="st">"Ener"</span>, <span class="st">"Info"</span>, <span class="st">"H"</span>, <span class="st">"Multi"</span>, <span class="st">"Priv"</span>)</span>
<span id="cb175-379"><a href="#cb175-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-380"><a href="#cb175-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-381"><a href="#cb175-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-384"><a href="#cb175-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-385"><a href="#cb175-385" aria-hidden="true" tabindex="-1"></a><span class="co">#Saving Procurement3 as an excel dataset</span></span>
<span id="cb175-386"><a href="#cb175-386" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb175-387"><a href="#cb175-387" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(Procurement3, <span class="st">"~/Desktop/BC_courses/BigDataEconometrics/Procurement3.xlsx"</span>)</span>
<span id="cb175-388"><a href="#cb175-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-389"><a href="#cb175-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-390"><a href="#cb175-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-391"><a href="#cb175-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-394"><a href="#cb175-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-395"><a href="#cb175-395" aria-hidden="true" tabindex="-1"></a><span class="co">#Omitting any missing values</span></span>
<span id="cb175-396"><a href="#cb175-396" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="ot">=</span> <span class="fu">na.omit</span>(Procurement3)</span>
<span id="cb175-397"><a href="#cb175-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-398"><a href="#cb175-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-399"><a href="#cb175-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-402"><a href="#cb175-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-403"><a href="#cb175-403" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear Regression with Procurement3</span></span>
<span id="cb175-404"><a href="#cb175-404" aria-hidden="true" tabindex="-1"></a>lr2 <span class="ot">=</span> <span class="fu">lm</span>(lca_contract_value <span class="sc">~</span> ., <span class="at">data =</span> Procurement3)</span>
<span id="cb175-405"><a href="#cb175-405" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr2)</span>
<span id="cb175-406"><a href="#cb175-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-407"><a href="#cb175-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-408"><a href="#cb175-408" aria-hidden="true" tabindex="-1"></a>Two variables were dropped because of singularity still. Most of the remaining vars have high statistical significance.</span>
<span id="cb175-409"><a href="#cb175-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-410"><a href="#cb175-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-411"><a href="#cb175-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-412"><a href="#cb175-412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ridge Regression with Grid Search</span></span>
<span id="cb175-413"><a href="#cb175-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-416"><a href="#cb175-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-417"><a href="#cb175-417" aria-hidden="true" tabindex="-1"></a><span class="co">#Last check of the predictor dataset</span></span>
<span id="cb175-418"><a href="#cb175-418" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement3)</span>
<span id="cb175-419"><a href="#cb175-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-420"><a href="#cb175-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-421"><a href="#cb175-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-424"><a href="#cb175-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-425"><a href="#cb175-425" aria-hidden="true" tabindex="-1"></a><span class="co">#assigning index to each row</span></span>
<span id="cb175-426"><a href="#cb175-426" aria-hidden="true" tabindex="-1"></a>index <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procurement3)</span>
<span id="cb175-427"><a href="#cb175-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-428"><a href="#cb175-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-431"><a href="#cb175-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-432"><a href="#cb175-432" aria-hidden="true" tabindex="-1"></a><span class="co">#randomly taking 90% of the indices for training subset</span></span>
<span id="cb175-433"><a href="#cb175-433" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random</span></span>
<span id="cb175-434"><a href="#cb175-434" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">=</span> <span class="fu">sample</span>(index, <span class="fu">round</span>(<span class="fl">0.90</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement3)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 90% of rows without replacement</span></span>
<span id="cb175-435"><a href="#cb175-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-436"><a href="#cb175-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-439"><a href="#cb175-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-440"><a href="#cb175-440" aria-hidden="true" tabindex="-1"></a><span class="co">#taking the remaining indices for test subset</span></span>
<span id="cb175-441"><a href="#cb175-441" aria-hidden="true" tabindex="-1"></a>test_index <span class="ot">=</span> <span class="fu">setdiff</span>(index, train_index) <span class="co">#takes untaken rows</span></span>
<span id="cb175-442"><a href="#cb175-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-443"><a href="#cb175-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-446"><a href="#cb175-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-447"><a href="#cb175-447" aria-hidden="true" tabindex="-1"></a><span class="co">#creating train and test subsets of obs</span></span>
<span id="cb175-448"><a href="#cb175-448" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">=</span> Procurement3[train_index, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-449"><a href="#cb175-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>)) <span class="co">#Procurement3[train_index, ] expression to use only training subset %&gt;% everything except price, price category, and corruption index</span></span>
<span id="cb175-450"><a href="#cb175-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-451"><a href="#cb175-451" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">=</span> Procurement3[train_index, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-452"><a href="#cb175-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-453"><a href="#cb175-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-454"><a href="#cb175-454" aria-hidden="true" tabindex="-1"></a>test_x <span class="ot">=</span> Procurement3[test_index, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-455"><a href="#cb175-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>))</span>
<span id="cb175-456"><a href="#cb175-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-457"><a href="#cb175-457" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">=</span> Procurement3[test_index, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-458"><a href="#cb175-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-459"><a href="#cb175-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-460"><a href="#cb175-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-463"><a href="#cb175-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-464"><a href="#cb175-464" aria-hidden="true" tabindex="-1"></a><span class="co">#putting subsets into matrices for the models</span></span>
<span id="cb175-465"><a href="#cb175-465" aria-hidden="true" tabindex="-1"></a><span class="co">#creates a model) matrix, e.g., by expanding factors to a set of dummy variables (depending on the contrasts) and expanding interactions similarly.</span></span>
<span id="cb175-466"><a href="#cb175-466" aria-hidden="true" tabindex="-1"></a>train_matrix <span class="ot">=</span> <span class="fu">model.matrix</span>(train_y <span class="sc">~</span> ., <span class="at">data =</span> train_x)</span>
<span id="cb175-467"><a href="#cb175-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-468"><a href="#cb175-468" aria-hidden="true" tabindex="-1"></a>test_matrix <span class="ot">=</span> <span class="fu">model.matrix</span>(test_y <span class="sc">~</span> ., <span class="at">data =</span> test_x)</span>
<span id="cb175-469"><a href="#cb175-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-470"><a href="#cb175-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-471"><a href="#cb175-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-474"><a href="#cb175-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-475"><a href="#cb175-475" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear Regression</span></span>
<span id="cb175-476"><a href="#cb175-476" aria-hidden="true" tabindex="-1"></a><span class="co">#To run an unpenalized linear regression penalty, lambda is set to 0</span></span>
<span id="cb175-477"><a href="#cb175-477" aria-hidden="true" tabindex="-1"></a>model_lm_ridge <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">y =</span> train_y, <span class="at">x =</span> train_matrix, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb175-478"><a href="#cb175-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-479"><a href="#cb175-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-482"><a href="#cb175-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-483"><a href="#cb175-483" aria-hidden="true" tabindex="-1"></a><span class="co">#Coefficients</span></span>
<span id="cb175-484"><a href="#cb175-484" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model_lm_ridge)</span>
<span id="cb175-485"><a href="#cb175-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-486"><a href="#cb175-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-487"><a href="#cb175-487" aria-hidden="true" tabindex="-1"></a>Coefficients of this regression did not drop the two from the lr2, which might be because the estimates in glmnet and lm will never be exactly the same and one is the subset of the other.</span>
<span id="cb175-488"><a href="#cb175-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-491"><a href="#cb175-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-492"><a href="#cb175-492" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE for lm</span></span>
<span id="cb175-493"><a href="#cb175-493" aria-hidden="true" tabindex="-1"></a><span class="co">#compute the RMSE</span></span>
<span id="cb175-494"><a href="#cb175-494" aria-hidden="true" tabindex="-1"></a>preds_lm <span class="ot">=</span> <span class="fu">predict</span>(model_lm_ridge, test_matrix)</span>
<span id="cb175-495"><a href="#cb175-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-496"><a href="#cb175-496" aria-hidden="true" tabindex="-1"></a>rmse_lm <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_lm <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-497"><a href="#cb175-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-498"><a href="#cb175-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-501"><a href="#cb175-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-502"><a href="#cb175-502" aria-hidden="true" tabindex="-1"></a><span class="co">#Ridge regression with lambda 10</span></span>
<span id="cb175-503"><a href="#cb175-503" aria-hidden="true" tabindex="-1"></a>model_ridge <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">y =</span> train_y, <span class="at">x =</span> train_matrix, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">10</span>)</span>
<span id="cb175-504"><a href="#cb175-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-505"><a href="#cb175-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-508"><a href="#cb175-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-509"><a href="#cb175-509" aria-hidden="true" tabindex="-1"></a><span class="co">#compute the RMSE for Ridge</span></span>
<span id="cb175-510"><a href="#cb175-510" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(model_ridge, test_matrix)</span>
<span id="cb175-511"><a href="#cb175-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-512"><a href="#cb175-512" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-513"><a href="#cb175-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-514"><a href="#cb175-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-515"><a href="#cb175-515" aria-hidden="true" tabindex="-1"></a>RMSE of the first Ridge regression is bigger than that of the unregularized linear regression. Seems that the optimal lambda should be small.</span>
<span id="cb175-516"><a href="#cb175-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-519"><a href="#cb175-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-520"><a href="#cb175-520" aria-hidden="true" tabindex="-1"></a><span class="co">#finding optimal lambda</span></span>
<span id="cb175-521"><a href="#cb175-521" aria-hidden="true" tabindex="-1"></a><span class="co">#Function for picking the lowest RMSE</span></span>
<span id="cb175-522"><a href="#cb175-522" aria-hidden="true" tabindex="-1"></a><span class="co">#cv.glmnet: Does k-fold cross-validation for glmnet, produces a plot, and returns a value for lambda</span></span>
<span id="cb175-523"><a href="#cb175-523" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">=</span> <span class="fu">cv.glmnet</span>(train_matrix, train_y, <span class="at">alpha=</span><span class="dv">0</span>)</span>
<span id="cb175-524"><a href="#cb175-524" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda that minimizes the MSE</span></span>
<span id="cb175-525"><a href="#cb175-525" aria-hidden="true" tabindex="-1"></a>best_model<span class="sc">$</span>lambda.min</span>
<span id="cb175-526"><a href="#cb175-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-527"><a href="#cb175-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-528"><a href="#cb175-528" aria-hidden="true" tabindex="-1"></a>The optimal lambda is very close to 0.</span>
<span id="cb175-529"><a href="#cb175-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-532"><a href="#cb175-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-533"><a href="#cb175-533" aria-hidden="true" tabindex="-1"></a><span class="co">#Ridge regression with optimal lambda</span></span>
<span id="cb175-534"><a href="#cb175-534" aria-hidden="true" tabindex="-1"></a><span class="co">#use the new lambda</span></span>
<span id="cb175-535"><a href="#cb175-535" aria-hidden="true" tabindex="-1"></a>new_lambda <span class="ot">=</span> best_model<span class="sc">$</span>lambda.min</span>
<span id="cb175-536"><a href="#cb175-536" aria-hidden="true" tabindex="-1"></a>new_model_ridge <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">y =</span> train_y, <span class="at">x =</span> train_matrix, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> new_lambda)</span>
<span id="cb175-537"><a href="#cb175-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-538"><a href="#cb175-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-539"><a href="#cb175-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-542"><a href="#cb175-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-543"><a href="#cb175-543" aria-hidden="true" tabindex="-1"></a><span class="co">#new RMSE</span></span>
<span id="cb175-544"><a href="#cb175-544" aria-hidden="true" tabindex="-1"></a><span class="co">#check the RMSE</span></span>
<span id="cb175-545"><a href="#cb175-545" aria-hidden="true" tabindex="-1"></a>new_preds <span class="ot">=</span> <span class="fu">predict</span>(new_model_ridge, test_matrix)</span>
<span id="cb175-546"><a href="#cb175-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-547"><a href="#cb175-547" aria-hidden="true" tabindex="-1"></a>new_rmse <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(new_preds <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-548"><a href="#cb175-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-549"><a href="#cb175-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-552"><a href="#cb175-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-553"><a href="#cb175-553" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparing RMSE</span></span>
<span id="cb175-554"><a href="#cb175-554" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse)</span>
<span id="cb175-555"><a href="#cb175-555" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_lm)</span>
<span id="cb175-556"><a href="#cb175-556" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_rmse)</span>
<span id="cb175-557"><a href="#cb175-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-558"><a href="#cb175-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-559"><a href="#cb175-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-560"><a href="#cb175-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-561"><a href="#cb175-561" aria-hidden="true" tabindex="-1"></a>The RMSE for Ridge regression with the optimal parameter is smaller than that with lambda 0 just a little bit. Which means regularized regression is just a little more efficient than the simple linear regression.</span>
<span id="cb175-562"><a href="#cb175-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-565"><a href="#cb175-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-566"><a href="#cb175-566" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparing RSS</span></span>
<span id="cb175-567"><a href="#cb175-567" aria-hidden="true" tabindex="-1"></a>sse_lm <span class="ot">=</span> <span class="fu">sum</span>((preds_lm <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-568"><a href="#cb175-568" aria-hidden="true" tabindex="-1"></a>sse_ridge <span class="ot">=</span> <span class="fu">sum</span>((new_preds <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-569"><a href="#cb175-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-570"><a href="#cb175-570" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_lm)</span>
<span id="cb175-571"><a href="#cb175-571" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_ridge)</span>
<span id="cb175-572"><a href="#cb175-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-573"><a href="#cb175-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-576"><a href="#cb175-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-577"><a href="#cb175-577" aria-hidden="true" tabindex="-1"></a>lr3 <span class="ot">=</span> <span class="fu">lm</span>(train_y <span class="sc">~</span> ., <span class="at">data =</span> train_x)</span>
<span id="cb175-578"><a href="#cb175-578" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr3)</span>
<span id="cb175-579"><a href="#cb175-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-580"><a href="#cb175-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-583"><a href="#cb175-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-584"><a href="#cb175-584" aria-hidden="true" tabindex="-1"></a>preds_lr3 <span class="ot">=</span> <span class="fu">predict</span>(lr3, test_x)</span>
<span id="cb175-585"><a href="#cb175-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-586"><a href="#cb175-586" aria-hidden="true" tabindex="-1"></a>rmse_lr3 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_lr3 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-587"><a href="#cb175-587" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((preds_lr3 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-588"><a href="#cb175-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-589"><a href="#cb175-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-590"><a href="#cb175-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-591"><a href="#cb175-591" aria-hidden="true" tabindex="-1"></a>Residual Sums Squared are almost identical for both regressions. Given that, I'd suggest sticking to a simpler model, i.e. unpenalized Linear Regression Model.</span>
<span id="cb175-592"><a href="#cb175-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-593"><a href="#cb175-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-594"><a href="#cb175-594" aria-hidden="true" tabindex="-1"></a><span class="fu">## Corrected Ridge without cri_wb</span></span>
<span id="cb175-595"><a href="#cb175-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-596"><a href="#cb175-596" aria-hidden="true" tabindex="-1"></a>Later in the research I discovered that cri_wb caused multicollinearity, so I removed it and performed Ridge regression again</span>
<span id="cb175-597"><a href="#cb175-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-598"><a href="#cb175-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r subsetting the data}</span></span>
<span id="cb175-599"><a href="#cb175-599" aria-hidden="true" tabindex="-1"></a><span class="co">#subsetting the data</span></span>
<span id="cb175-600"><a href="#cb175-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-601"><a href="#cb175-601" aria-hidden="true" tabindex="-1"></a>index.r <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procurement3) <span class="co">#indexing each row</span></span>
<span id="cb175-602"><a href="#cb175-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-603"><a href="#cb175-603" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random</span></span>
<span id="cb175-604"><a href="#cb175-604" aria-hidden="true" tabindex="-1"></a>train_index.r <span class="ot">=</span> <span class="fu">sample</span>(index.r, <span class="fu">round</span>(<span class="fl">0.90</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement3)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 90% of rows without replacement</span></span>
<span id="cb175-605"><a href="#cb175-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-606"><a href="#cb175-606" aria-hidden="true" tabindex="-1"></a>test_index.r <span class="ot">=</span> <span class="fu">setdiff</span>(index.r, train_index.r) <span class="co">#takes untaken rows</span></span>
<span id="cb175-607"><a href="#cb175-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-608"><a href="#cb175-608" aria-hidden="true" tabindex="-1"></a>train_x.r <span class="ot">=</span> Procurement3[train_index.r, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-609"><a href="#cb175-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>)) <span class="co">#Procurement3[train_index, ] expression to use only training subset %&gt;% everything except price, price category, and corruption index</span></span>
<span id="cb175-610"><a href="#cb175-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-611"><a href="#cb175-611" aria-hidden="true" tabindex="-1"></a>train_y.r <span class="ot">=</span> Procurement3[train_index.r, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-612"><a href="#cb175-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-613"><a href="#cb175-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-614"><a href="#cb175-614" aria-hidden="true" tabindex="-1"></a>test_x.r <span class="ot">=</span> Procurement3[test_index.r, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-615"><a href="#cb175-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>))</span>
<span id="cb175-616"><a href="#cb175-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-617"><a href="#cb175-617" aria-hidden="true" tabindex="-1"></a>test_y.r <span class="ot">=</span> Procurement3[test_index.r, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-618"><a href="#cb175-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-619"><a href="#cb175-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-620"><a href="#cb175-620" aria-hidden="true" tabindex="-1"></a><span class="co">#creates a model) matrix, e.g., by expanding factors to a set of dummy variables (depending on the contrasts) and expanding interactions similarly. The matrices are for glmnet.</span></span>
<span id="cb175-621"><a href="#cb175-621" aria-hidden="true" tabindex="-1"></a>train_matrix.r <span class="ot">=</span> <span class="fu">model.matrix</span>(train_y.r <span class="sc">~</span> ., <span class="at">data =</span> train_x.r)</span>
<span id="cb175-622"><a href="#cb175-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-623"><a href="#cb175-623" aria-hidden="true" tabindex="-1"></a>test_matrix.r <span class="ot">=</span> <span class="fu">model.matrix</span>(test_y.r <span class="sc">~</span> ., <span class="at">data =</span> test_x.r)</span>
<span id="cb175-624"><a href="#cb175-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-625"><a href="#cb175-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-626"><a href="#cb175-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-627"><a href="#cb175-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r CORRECTED Linear Regression with glmnet}</span></span>
<span id="cb175-628"><a href="#cb175-628" aria-hidden="true" tabindex="-1"></a><span class="co">#CORRECTED Linear Regression with glmnet</span></span>
<span id="cb175-629"><a href="#cb175-629" aria-hidden="true" tabindex="-1"></a><span class="co">#To run an unpenalized linear regression penalty, lambda is set to 0</span></span>
<span id="cb175-630"><a href="#cb175-630" aria-hidden="true" tabindex="-1"></a>lm_ridge.c <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">y =</span> train_y.r, <span class="at">x =</span> train_matrix.r, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb175-631"><a href="#cb175-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-632"><a href="#cb175-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-633"><a href="#cb175-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r RMSE and SSE for corrected lm glmnet}</span></span>
<span id="cb175-634"><a href="#cb175-634" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE and SSE for corrected lm glmnet</span></span>
<span id="cb175-635"><a href="#cb175-635" aria-hidden="true" tabindex="-1"></a>preds_r <span class="ot">=</span> <span class="fu">predict</span>(lm_ridge.c, test_matrix.r)</span>
<span id="cb175-636"><a href="#cb175-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-637"><a href="#cb175-637" aria-hidden="true" tabindex="-1"></a>rmse_r <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_r <span class="sc">-</span> test_y.r)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-638"><a href="#cb175-638" aria-hidden="true" tabindex="-1"></a>sse_r <span class="ot">=</span> <span class="fu">sum</span>((preds_r <span class="sc">-</span> test_y.r)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-639"><a href="#cb175-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-640"><a href="#cb175-640" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_r)</span>
<span id="cb175-641"><a href="#cb175-641" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_r)</span>
<span id="cb175-642"><a href="#cb175-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-643"><a href="#cb175-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-644"><a href="#cb175-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r finding optimal lambda}</span></span>
<span id="cb175-645"><a href="#cb175-645" aria-hidden="true" tabindex="-1"></a><span class="co">#finding optimal lambda</span></span>
<span id="cb175-646"><a href="#cb175-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-647"><a href="#cb175-647" aria-hidden="true" tabindex="-1"></a><span class="co">#Function for picking the lowest RMSE</span></span>
<span id="cb175-648"><a href="#cb175-648" aria-hidden="true" tabindex="-1"></a><span class="co">#cv.glmnet: Does k-fold cross-validation for glmnet, produces a plot, and returns a value for lambda</span></span>
<span id="cb175-649"><a href="#cb175-649" aria-hidden="true" tabindex="-1"></a>best_model.r <span class="ot">=</span> <span class="fu">cv.glmnet</span>(train_matrix.r, train_y.r, <span class="at">alpha=</span><span class="dv">0</span>)</span>
<span id="cb175-650"><a href="#cb175-650" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda that minimizes the MSE</span></span>
<span id="cb175-651"><a href="#cb175-651" aria-hidden="true" tabindex="-1"></a>best_model.r<span class="sc">$</span>lambda.min</span>
<span id="cb175-652"><a href="#cb175-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-653"><a href="#cb175-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-654"><a href="#cb175-654" aria-hidden="true" tabindex="-1"></a>The optimal lambda is very close to 0.</span>
<span id="cb175-655"><a href="#cb175-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-658"><a href="#cb175-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-659"><a href="#cb175-659" aria-hidden="true" tabindex="-1"></a><span class="co">#Ridge regression with optimal lambda</span></span>
<span id="cb175-660"><a href="#cb175-660" aria-hidden="true" tabindex="-1"></a><span class="co">#use the new lambda</span></span>
<span id="cb175-661"><a href="#cb175-661" aria-hidden="true" tabindex="-1"></a>new_lambda.r <span class="ot">=</span> best_model.r<span class="sc">$</span>lambda.min</span>
<span id="cb175-662"><a href="#cb175-662" aria-hidden="true" tabindex="-1"></a>lm_ridge.c2 <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">y =</span> train_y.r, <span class="at">x =</span> train_matrix.r, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> new_lambda.r)</span>
<span id="cb175-663"><a href="#cb175-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-664"><a href="#cb175-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-665"><a href="#cb175-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-668"><a href="#cb175-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-669"><a href="#cb175-669" aria-hidden="true" tabindex="-1"></a><span class="co">#new RMSE</span></span>
<span id="cb175-670"><a href="#cb175-670" aria-hidden="true" tabindex="-1"></a><span class="co">#check the RMSE</span></span>
<span id="cb175-671"><a href="#cb175-671" aria-hidden="true" tabindex="-1"></a>new_preds.r <span class="ot">=</span> <span class="fu">predict</span>(lm_ridge.c2, test_matrix.r)</span>
<span id="cb175-672"><a href="#cb175-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-673"><a href="#cb175-673" aria-hidden="true" tabindex="-1"></a>new_rmse.r <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(new_preds.r <span class="sc">-</span> test_y.r)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-674"><a href="#cb175-674" aria-hidden="true" tabindex="-1"></a>new_sse.r <span class="ot">=</span> <span class="fu">sum</span>((new_preds.r <span class="sc">-</span> test_y.r)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-675"><a href="#cb175-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-676"><a href="#cb175-676" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_rmse.r)</span>
<span id="cb175-677"><a href="#cb175-677" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_sse.r)</span>
<span id="cb175-678"><a href="#cb175-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-679"><a href="#cb175-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-680"><a href="#cb175-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-681"><a href="#cb175-681" aria-hidden="true" tabindex="-1"></a><span class="fu">## Logit for contract value categories</span></span>
<span id="cb175-682"><a href="#cb175-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-683"><a href="#cb175-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Creating contract_valuec dummy and Procurement4}</span></span>
<span id="cb175-684"><a href="#cb175-684" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating contract_valuec dummy and Procurement4</span></span>
<span id="cb175-685"><a href="#cb175-685" aria-hidden="true" tabindex="-1"></a>Procurement4 <span class="ot">=</span> Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-686"><a href="#cb175-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value.cat =</span> <span class="fu">ifelse</span>(ca_contract_valuec<span class="sc">==</span><span class="st">"200.000-"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-687"><a href="#cb175-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ca_contract_valuec, lca_contract_value)) <span class="co">#I drop cols for value logged and category</span></span>
<span id="cb175-688"><a href="#cb175-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-689"><a href="#cb175-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-690"><a href="#cb175-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-691"><a href="#cb175-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-692"><a href="#cb175-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simple logit model}</span></span>
<span id="cb175-693"><a href="#cb175-693" aria-hidden="true" tabindex="-1"></a><span class="co">#simple logit model</span></span>
<span id="cb175-694"><a href="#cb175-694" aria-hidden="true" tabindex="-1"></a>log_model <span class="ot">=</span> <span class="fu">glm</span>(value.cat <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), Procurement4)</span>
<span id="cb175-695"><a href="#cb175-695" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_model)</span>
<span id="cb175-696"><a href="#cb175-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-697"><a href="#cb175-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-698"><a href="#cb175-698" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating train and test dataset}</span></span>
<span id="cb175-699"><a href="#cb175-699" aria-hidden="true" tabindex="-1"></a><span class="co">#creating train and test dataset</span></span>
<span id="cb175-700"><a href="#cb175-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-701"><a href="#cb175-701" aria-hidden="true" tabindex="-1"></a>index.log <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procurement4)</span>
<span id="cb175-702"><a href="#cb175-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-703"><a href="#cb175-703" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random</span></span>
<span id="cb175-704"><a href="#cb175-704" aria-hidden="true" tabindex="-1"></a>train_index.log <span class="ot">=</span> <span class="fu">sample</span>(index.log, <span class="fu">round</span>(<span class="fl">0.90</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement4)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 90% of rows without replacement</span></span>
<span id="cb175-705"><a href="#cb175-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-706"><a href="#cb175-706" aria-hidden="true" tabindex="-1"></a>test_index.log <span class="ot">=</span> <span class="fu">setdiff</span>(index.log, train_index.log) <span class="co">#takes remaining rows for test</span></span>
<span id="cb175-707"><a href="#cb175-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-708"><a href="#cb175-708" aria-hidden="true" tabindex="-1"></a><span class="co">#creating train and test subsets of obs</span></span>
<span id="cb175-709"><a href="#cb175-709" aria-hidden="true" tabindex="-1"></a>train_x.log <span class="ot">=</span> Procurement4[train_index.log, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-710"><a href="#cb175-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value.cat) <span class="co">#Procurement3[train_index.log, ] expression to use only training subset %&gt;% everything except price category</span></span>
<span id="cb175-711"><a href="#cb175-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-712"><a href="#cb175-712" aria-hidden="true" tabindex="-1"></a>train_y.log <span class="ot">=</span> Procurement4[train_index.log, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-713"><a href="#cb175-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value.cat) <span class="co">#pulls only value.cat</span></span>
<span id="cb175-714"><a href="#cb175-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-715"><a href="#cb175-715" aria-hidden="true" tabindex="-1"></a>test_x.log <span class="ot">=</span> Procurement4[test_index.log, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-716"><a href="#cb175-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value.cat)</span>
<span id="cb175-717"><a href="#cb175-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-718"><a href="#cb175-718" aria-hidden="true" tabindex="-1"></a>test_y.log <span class="ot">=</span> Procurement4[test_index.log, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-719"><a href="#cb175-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value.cat)</span>
<span id="cb175-720"><a href="#cb175-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-721"><a href="#cb175-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-722"><a href="#cb175-722" aria-hidden="true" tabindex="-1"></a><span class="in">```{r logit model training}</span></span>
<span id="cb175-723"><a href="#cb175-723" aria-hidden="true" tabindex="-1"></a><span class="co">#logit model training</span></span>
<span id="cb175-724"><a href="#cb175-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-725"><a href="#cb175-725" aria-hidden="true" tabindex="-1"></a>log_model_train <span class="ot">=</span> <span class="fu">glm</span>(train_y.log <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), train_x.log)</span>
<span id="cb175-726"><a href="#cb175-726" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_model_train)</span>
<span id="cb175-727"><a href="#cb175-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-728"><a href="#cb175-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-729"><a href="#cb175-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-730"><a href="#cb175-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r predict probabilities for test subset (Warning)}</span></span>
<span id="cb175-731"><a href="#cb175-731" aria-hidden="true" tabindex="-1"></a><span class="co">#predict probabilities for test subset (Warning)</span></span>
<span id="cb175-732"><a href="#cb175-732" aria-hidden="true" tabindex="-1"></a>probabilities1 <span class="ot">&lt;-</span> log_model_train <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">newdata=</span>test_x.log, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb175-733"><a href="#cb175-733" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(probabilities1) <span class="co">#the warning might be bc there is collinearity or too many predictors. </span></span>
<span id="cb175-734"><a href="#cb175-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-735"><a href="#cb175-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-736"><a href="#cb175-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create predicted.classes1}</span></span>
<span id="cb175-737"><a href="#cb175-737" aria-hidden="true" tabindex="-1"></a><span class="co">#create predicted.classes1</span></span>
<span id="cb175-738"><a href="#cb175-738" aria-hidden="true" tabindex="-1"></a>predicted.classes1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(probabilities1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb175-739"><a href="#cb175-739" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicted.classes1)</span>
<span id="cb175-740"><a href="#cb175-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-741"><a href="#cb175-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-742"><a href="#cb175-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Comparison between actual and predicted values}</span></span>
<span id="cb175-743"><a href="#cb175-743" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparison between actual and predicted values</span></span>
<span id="cb175-744"><a href="#cb175-744" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicted.classes1 <span class="sc">==</span> test_y.log)</span>
<span id="cb175-745"><a href="#cb175-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-746"><a href="#cb175-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-747"><a href="#cb175-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Check for aliased coeffs in the model}</span></span>
<span id="cb175-748"><a href="#cb175-748" aria-hidden="true" tabindex="-1"></a><span class="co">#Check for aliased coeffs in the model</span></span>
<span id="cb175-749"><a href="#cb175-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-750"><a href="#cb175-750" aria-hidden="true" tabindex="-1"></a><span class="fu">alias</span>(log_model_train)</span>
<span id="cb175-751"><a href="#cb175-751" aria-hidden="true" tabindex="-1"></a><span class="co">#aliased coeffs indicate collinearity problem in the model (some variables are linearly dependent on others) and should be removed or transformed.</span></span>
<span id="cb175-752"><a href="#cb175-752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-753"><a href="#cb175-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-756"><a href="#cb175-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-757"><a href="#cb175-757" aria-hidden="true" tabindex="-1"></a><span class="fu">alias</span>(log_model_train)<span class="sc">$</span>reduced</span>
<span id="cb175-758"><a href="#cb175-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-759"><a href="#cb175-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-760"><a href="#cb175-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Remove cri_wb.d and other superfluous vars}</span></span>
<span id="cb175-761"><a href="#cb175-761" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove cri_wb.d and other superfluous vars</span></span>
<span id="cb175-762"><a href="#cb175-762" aria-hidden="true" tabindex="-1"></a><span class="co">#Most probably cri_wb was calculated based on the other vars in the dataset, so it is linearly dependent on them and should be removed</span></span>
<span id="cb175-763"><a href="#cb175-763" aria-hidden="true" tabindex="-1"></a>train_x.log2 <span class="ot">=</span> train_x.log <span class="sc">%&gt;%</span> </span>
<span id="cb175-764"><a href="#cb175-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>), <span class="sc">-</span><span class="fu">c</span>(AFR, EAP, ECA, LCR, MNA, SAR, ca_bids_all)) <span class="co">#starts_with() removes all cri_wb dummies </span></span>
<span id="cb175-765"><a href="#cb175-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-766"><a href="#cb175-766" aria-hidden="true" tabindex="-1"></a>test_x.log2 <span class="ot">=</span> test_x.log <span class="sc">%&gt;%</span> </span>
<span id="cb175-767"><a href="#cb175-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>), <span class="sc">-</span><span class="fu">c</span>(AFR, EAP, ECA, LCR, MNA, SAR, ca_bids_all))</span>
<span id="cb175-768"><a href="#cb175-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-769"><a href="#cb175-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-770"><a href="#cb175-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 2 logit model training}</span></span>
<span id="cb175-771"><a href="#cb175-771" aria-hidden="true" tabindex="-1"></a><span class="co">#2 logit model training</span></span>
<span id="cb175-772"><a href="#cb175-772" aria-hidden="true" tabindex="-1"></a>log_model_train<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">glm</span>(train_y.log <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), train_x.log2)</span>
<span id="cb175-773"><a href="#cb175-773" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_model_train<span class="fl">.2</span>)</span>
<span id="cb175-774"><a href="#cb175-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-775"><a href="#cb175-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-778"><a href="#cb175-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-779"><a href="#cb175-779" aria-hidden="true" tabindex="-1"></a><span class="fu">alias</span>(log_model_train<span class="fl">.2</span>)<span class="sc">$</span>complete</span>
<span id="cb175-780"><a href="#cb175-780" aria-hidden="true" tabindex="-1"></a><span class="co">#no aliased coeffs</span></span>
<span id="cb175-781"><a href="#cb175-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-782"><a href="#cb175-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-783"><a href="#cb175-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Predict probabilities2}</span></span>
<span id="cb175-784"><a href="#cb175-784" aria-hidden="true" tabindex="-1"></a><span class="co">#Predict probabilities2</span></span>
<span id="cb175-785"><a href="#cb175-785" aria-hidden="true" tabindex="-1"></a>probabilities2 <span class="ot">&lt;-</span> log_model_train<span class="fl">.2</span> <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">newdata=</span>test_x.log2, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb175-786"><a href="#cb175-786" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(probabilities2)</span>
<span id="cb175-787"><a href="#cb175-787" aria-hidden="true" tabindex="-1"></a><span class="co">#No warning this time</span></span>
<span id="cb175-788"><a href="#cb175-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-789"><a href="#cb175-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-790"><a href="#cb175-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Predcited classes based on probabilities}</span></span>
<span id="cb175-791"><a href="#cb175-791" aria-hidden="true" tabindex="-1"></a><span class="co">#Predcited classes based on probabilities</span></span>
<span id="cb175-792"><a href="#cb175-792" aria-hidden="true" tabindex="-1"></a>predicted.classes2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(probabilities2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb175-793"><a href="#cb175-793" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicted.classes2)</span>
<span id="cb175-794"><a href="#cb175-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-795"><a href="#cb175-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-796"><a href="#cb175-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Compare observed and predicted values}</span></span>
<span id="cb175-797"><a href="#cb175-797" aria-hidden="true" tabindex="-1"></a><span class="co">#Compare observed and predicted values</span></span>
<span id="cb175-798"><a href="#cb175-798" aria-hidden="true" tabindex="-1"></a>pred.rate.log <span class="ot">=</span> <span class="fu">mean</span>(predicted.classes2 <span class="sc">==</span> test_y.log)</span>
<span id="cb175-799"><a href="#cb175-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-800"><a href="#cb175-800" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(predicted.classes2 <span class="sc">==</span> test_y.log)</span>
<span id="cb175-801"><a href="#cb175-801" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-802"><a href="#cb175-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-803"><a href="#cb175-803" aria-hidden="true" tabindex="-1"></a><span class="fu">## KNN </span></span>
<span id="cb175-804"><a href="#cb175-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-805"><a href="#cb175-805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r KNN classification}</span></span>
<span id="cb175-806"><a href="#cb175-806" aria-hidden="true" tabindex="-1"></a><span class="co">#KNN classification</span></span>
<span id="cb175-807"><a href="#cb175-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-808"><a href="#cb175-808" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb175-809"><a href="#cb175-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-810"><a href="#cb175-810" aria-hidden="true" tabindex="-1"></a>predicted_labels <span class="ot">=</span> <span class="fu">knn</span>(train_x.log, test_x.log, train_y.log, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb175-811"><a href="#cb175-811" aria-hidden="true" tabindex="-1"></a><span class="co">#Here I used the subsets with cri_wb and other coefficients because the model doesn't care about collinearity and because without them there were too many ties.</span></span>
<span id="cb175-812"><a href="#cb175-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-813"><a href="#cb175-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-814"><a href="#cb175-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Comparison between obs and predictions through KNN}</span></span>
<span id="cb175-815"><a href="#cb175-815" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparison between obs and predictions through KNN</span></span>
<span id="cb175-816"><a href="#cb175-816" aria-hidden="true" tabindex="-1"></a>pred.rate.knn <span class="ot">=</span> <span class="fu">mean</span>(predicted_labels <span class="sc">==</span> test_y.log)</span>
<span id="cb175-817"><a href="#cb175-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-818"><a href="#cb175-818" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred.rate.knn)</span>
<span id="cb175-819"><a href="#cb175-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-820"><a href="#cb175-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-821"><a href="#cb175-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-824"><a href="#cb175-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-825"><a href="#cb175-825" aria-hidden="true" tabindex="-1"></a>predicted_labels2 <span class="ot">=</span> <span class="fu">knn</span>(train_x.log, test_x.log, train_y.log, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb175-826"><a href="#cb175-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-827"><a href="#cb175-827" aria-hidden="true" tabindex="-1"></a>pred.rate.knn2 <span class="ot">=</span> <span class="fu">mean</span>(predicted_labels2 <span class="sc">==</span> test_y.log)</span>
<span id="cb175-828"><a href="#cb175-828" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred.rate.knn2)</span>
<span id="cb175-829"><a href="#cb175-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-830"><a href="#cb175-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-831"><a href="#cb175-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r KNN without cri_wb}</span></span>
<span id="cb175-832"><a href="#cb175-832" aria-hidden="true" tabindex="-1"></a><span class="co">#KNN without cri_wb</span></span>
<span id="cb175-833"><a href="#cb175-833" aria-hidden="true" tabindex="-1"></a>train_x.log3 <span class="ot">=</span> train_x.log <span class="sc">%&gt;%</span> </span>
<span id="cb175-834"><a href="#cb175-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>)) <span class="co">#-starts_with() removes all cri_wb dummies </span></span>
<span id="cb175-835"><a href="#cb175-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-836"><a href="#cb175-836" aria-hidden="true" tabindex="-1"></a>test_x.log3 <span class="ot">=</span> test_x.log <span class="sc">%&gt;%</span> </span>
<span id="cb175-837"><a href="#cb175-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>))</span>
<span id="cb175-838"><a href="#cb175-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-839"><a href="#cb175-839" aria-hidden="true" tabindex="-1"></a>predicted_labels3 <span class="ot">=</span> <span class="fu">knn</span>(train_x.log3, test_x.log3, train_y.log, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb175-840"><a href="#cb175-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-841"><a href="#cb175-841" aria-hidden="true" tabindex="-1"></a>pred.rate.knn3 <span class="ot">=</span> <span class="fu">mean</span>(predicted_labels3 <span class="sc">==</span> test_y.log)</span>
<span id="cb175-842"><a href="#cb175-842" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred.rate.knn3)</span>
<span id="cb175-843"><a href="#cb175-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-844"><a href="#cb175-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-845"><a href="#cb175-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Beyond Linearity: Splines</span></span>
<span id="cb175-846"><a href="#cb175-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-849"><a href="#cb175-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-850"><a href="#cb175-850" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb175-851"><a href="#cb175-851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-852"><a href="#cb175-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-853"><a href="#cb175-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-854"><a href="#cb175-854" aria-hidden="true" tabindex="-1"></a><span class="in">```{r modelling basic spline without bids}</span></span>
<span id="cb175-855"><a href="#cb175-855" aria-hidden="true" tabindex="-1"></a><span class="co">#modelling basic spline without bids</span></span>
<span id="cb175-856"><a href="#cb175-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a regression model with cubic splines for multiple predictors</span></span>
<span id="cb175-857"><a href="#cb175-857" aria-hidden="true" tabindex="-1"></a>spline_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(train_y <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x)</span>
<span id="cb175-858"><a href="#cb175-858" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model)</span>
<span id="cb175-859"><a href="#cb175-859" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-860"><a href="#cb175-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-861"><a href="#cb175-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for basic spline}</span></span>
<span id="cb175-862"><a href="#cb175-862" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for basic spline</span></span>
<span id="cb175-863"><a href="#cb175-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-864"><a href="#cb175-864" aria-hidden="true" tabindex="-1"></a>preds_spline <span class="ot">=</span> <span class="fu">predict</span>(spline_model, test_x)</span>
<span id="cb175-865"><a href="#cb175-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-866"><a href="#cb175-866" aria-hidden="true" tabindex="-1"></a>rmse_spline <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-867"><a href="#cb175-867" aria-hidden="true" tabindex="-1"></a>sse_spline <span class="ot">=</span> <span class="fu">sum</span>((preds_spline <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-868"><a href="#cb175-868" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds_spline)</span>
<span id="cb175-869"><a href="#cb175-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-870"><a href="#cb175-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-873"><a href="#cb175-873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-874"><a href="#cb175-874" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_y)</span>
<span id="cb175-875"><a href="#cb175-875" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-876"><a href="#cb175-876" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((preds_spline <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-877"><a href="#cb175-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-878"><a href="#cb175-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-881"><a href="#cb175-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-882"><a href="#cb175-882" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_y)</span>
<span id="cb175-883"><a href="#cb175-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-884"><a href="#cb175-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-885"><a href="#cb175-885" aria-hidden="true" tabindex="-1"></a><span class="in">```{r spline model with bids included}</span></span>
<span id="cb175-886"><a href="#cb175-886" aria-hidden="true" tabindex="-1"></a><span class="co">#spline model with bids included</span></span>
<span id="cb175-887"><a href="#cb175-887" aria-hidden="true" tabindex="-1"></a>spline_model.bids <span class="ot">&lt;-</span> <span class="fu">lm</span>(train_y <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x)</span>
<span id="cb175-888"><a href="#cb175-888" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model.bids)</span>
<span id="cb175-889"><a href="#cb175-889" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-890"><a href="#cb175-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-891"><a href="#cb175-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r spline rmse and sse including bids variable}</span></span>
<span id="cb175-892"><a href="#cb175-892" aria-hidden="true" tabindex="-1"></a><span class="co">#spline rmse and sse including bids variable</span></span>
<span id="cb175-893"><a href="#cb175-893" aria-hidden="true" tabindex="-1"></a>preds_spline.bids <span class="ot">=</span> <span class="fu">predict</span>(spline_model.bids, test_x)</span>
<span id="cb175-894"><a href="#cb175-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-895"><a href="#cb175-895" aria-hidden="true" tabindex="-1"></a>rmse_spline.bids <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.bids <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-896"><a href="#cb175-896" aria-hidden="true" tabindex="-1"></a>sse_spline.bids <span class="ot">=</span> <span class="fu">sum</span>((preds_spline.bids <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-897"><a href="#cb175-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-898"><a href="#cb175-898" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_spline.bids)</span>
<span id="cb175-899"><a href="#cb175-899" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_spline.bids)</span>
<span id="cb175-900"><a href="#cb175-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-901"><a href="#cb175-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-902"><a href="#cb175-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-903"><a href="#cb175-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot nrc vs value}</span></span>
<span id="cb175-904"><a href="#cb175-904" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot nrc vs value</span></span>
<span id="cb175-905"><a href="#cb175-905" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-906"><a href="#cb175-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>nrc, <span class="at">y=</span>lca_contract_value)) <span class="sc">+</span></span>
<span id="cb175-907"><a href="#cb175-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-908"><a href="#cb175-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb175-909"><a href="#cb175-909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-910"><a href="#cb175-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-911"><a href="#cb175-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot ca_bids_all vs value 1}</span></span>
<span id="cb175-912"><a href="#cb175-912" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ca_bids_all vs value 1</span></span>
<span id="cb175-913"><a href="#cb175-913" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-914"><a href="#cb175-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_bids_all, <span class="at">y=</span>lca_contract_value)) <span class="sc">+</span></span>
<span id="cb175-915"><a href="#cb175-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-916"><a href="#cb175-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb175-917"><a href="#cb175-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-918"><a href="#cb175-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-921"><a href="#cb175-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-922"><a href="#cb175-922" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(train_x<span class="sc">$</span>nrc <span class="sc">&gt;</span> <span class="dv">10000</span>)</span>
<span id="cb175-923"><a href="#cb175-923" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(train_x<span class="sc">$</span>ca_bids_all <span class="sc">&gt;=</span> <span class="dv">50</span>)</span>
<span id="cb175-924"><a href="#cb175-924" aria-hidden="true" tabindex="-1"></a><span class="dv">293</span><span class="sc">/</span><span class="dv">145218</span></span>
<span id="cb175-925"><a href="#cb175-925" aria-hidden="true" tabindex="-1"></a><span class="dv">23232</span><span class="sc">/</span><span class="dv">145218</span></span>
<span id="cb175-926"><a href="#cb175-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-927"><a href="#cb175-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-928"><a href="#cb175-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot ca_bids_all vs value 2}</span></span>
<span id="cb175-929"><a href="#cb175-929" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ca_bids_all vs value 2</span></span>
<span id="cb175-930"><a href="#cb175-930" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span></span>
<span id="cb175-931"><a href="#cb175-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ca_bids_all <span class="sc">&gt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-932"><a href="#cb175-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_bids_all, <span class="at">y=</span>lca_contract_value)) <span class="sc">+</span></span>
<span id="cb175-933"><a href="#cb175-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-934"><a href="#cb175-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb175-935"><a href="#cb175-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-936"><a href="#cb175-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-937"><a href="#cb175-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-938"><a href="#cb175-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-939"><a href="#cb175-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot for ca_bids_all}</span></span>
<span id="cb175-940"><a href="#cb175-940" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot for ca_bids_all</span></span>
<span id="cb175-941"><a href="#cb175-941" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-942"><a href="#cb175-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ca_bids_all <span class="sc">&gt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-943"><a href="#cb175-943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_bids_all)) <span class="sc">+</span> </span>
<span id="cb175-944"><a href="#cb175-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>)</span>
<span id="cb175-945"><a href="#cb175-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-946"><a href="#cb175-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-947"><a href="#cb175-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scaling ca_bids_all &amp; Creating Procure_scaled}</span></span>
<span id="cb175-948"><a href="#cb175-948" aria-hidden="true" tabindex="-1"></a><span class="co">#scaling ca_bids_all &amp; Creating Procure_scaled</span></span>
<span id="cb175-949"><a href="#cb175-949" aria-hidden="true" tabindex="-1"></a>Procure_scaled <span class="ot">=</span> Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-950"><a href="#cb175-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ca_bids_all <span class="sc">&gt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-951"><a href="#cb175-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(ca_bids_all), scale) <span class="sc">%&gt;%</span> </span>
<span id="cb175-952"><a href="#cb175-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(ca_bids_all), as.numeric) <span class="co">#scale returns a matrix, so we need to save as.numeric</span></span>
<span id="cb175-953"><a href="#cb175-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-954"><a href="#cb175-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-955"><a href="#cb175-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-956"><a href="#cb175-956" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot for nrc}</span></span>
<span id="cb175-957"><a href="#cb175-957" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot for nrc</span></span>
<span id="cb175-958"><a href="#cb175-958" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-959"><a href="#cb175-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>nrc)) <span class="sc">+</span> </span>
<span id="cb175-960"><a href="#cb175-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb175-961"><a href="#cb175-961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-962"><a href="#cb175-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-963"><a href="#cb175-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-964"><a href="#cb175-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scaling nrc}</span></span>
<span id="cb175-965"><a href="#cb175-965" aria-hidden="true" tabindex="-1"></a><span class="co">#scaling nrc</span></span>
<span id="cb175-966"><a href="#cb175-966" aria-hidden="true" tabindex="-1"></a>Procure_scaled <span class="ot">=</span> Procure_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb175-967"><a href="#cb175-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(nrc), scale) <span class="sc">%&gt;%</span> </span>
<span id="cb175-968"><a href="#cb175-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(nrc), as.numeric)</span>
<span id="cb175-969"><a href="#cb175-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-970"><a href="#cb175-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-971"><a href="#cb175-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Checking scale}</span></span>
<span id="cb175-972"><a href="#cb175-972" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking scale</span></span>
<span id="cb175-973"><a href="#cb175-973" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Procure_scaled<span class="sc">$</span>nrc)</span>
<span id="cb175-974"><a href="#cb175-974" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Procure_scaled<span class="sc">$</span>ca_bids_all)</span>
<span id="cb175-975"><a href="#cb175-975" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procure_scaled<span class="sc">$</span>nrc)</span>
<span id="cb175-976"><a href="#cb175-976" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procure_scaled<span class="sc">$</span>ca_bids_all)</span>
<span id="cb175-977"><a href="#cb175-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-978"><a href="#cb175-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-981"><a href="#cb175-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-982"><a href="#cb175-982" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procure_scaled<span class="sc">$</span>lca_contract_value)</span>
<span id="cb175-983"><a href="#cb175-983" aria-hidden="true" tabindex="-1"></a>Procure_scaled <span class="ot">=</span> Procure_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb175-984"><a href="#cb175-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lca_contract_value))</span>
<span id="cb175-985"><a href="#cb175-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-986"><a href="#cb175-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-987"><a href="#cb175-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-988"><a href="#cb175-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r assigning and sampling indices}</span></span>
<span id="cb175-989"><a href="#cb175-989" aria-hidden="true" tabindex="-1"></a><span class="co">#assigning and sampling indices</span></span>
<span id="cb175-990"><a href="#cb175-990" aria-hidden="true" tabindex="-1"></a>index.spline <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procure_scaled)</span>
<span id="cb175-991"><a href="#cb175-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-992"><a href="#cb175-992" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random </span></span>
<span id="cb175-993"><a href="#cb175-993" aria-hidden="true" tabindex="-1"></a>train_index.spline <span class="ot">=</span> <span class="fu">sample</span>(index.spline, <span class="fu">round</span>(<span class="fl">0.90</span><span class="sc">*</span><span class="fu">nrow</span>(Procure_scaled)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 90% of rows without replacement</span></span>
<span id="cb175-994"><a href="#cb175-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-995"><a href="#cb175-995" aria-hidden="true" tabindex="-1"></a>test_index.spline <span class="ot">=</span> <span class="fu">setdiff</span>(index.spline, train_index.spline) <span class="co">#takes untaken rows</span></span>
<span id="cb175-996"><a href="#cb175-996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-997"><a href="#cb175-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-998"><a href="#cb175-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating train and test sets for spline}</span></span>
<span id="cb175-999"><a href="#cb175-999" aria-hidden="true" tabindex="-1"></a><span class="co">#creating train and test sets for spline</span></span>
<span id="cb175-1000"><a href="#cb175-1000" aria-hidden="true" tabindex="-1"></a>train_x.sp <span class="ot">=</span> Procure_scaled[train_index.spline, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1001"><a href="#cb175-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec) <span class="co">#Procure_scaled[train_index, ] expression to use only training subset %&gt;% everything except price and price category</span></span>
<span id="cb175-1002"><a href="#cb175-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1003"><a href="#cb175-1003" aria-hidden="true" tabindex="-1"></a>train_y.sp <span class="ot">=</span> Procure_scaled[train_index.spline, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1004"><a href="#cb175-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-1005"><a href="#cb175-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1006"><a href="#cb175-1006" aria-hidden="true" tabindex="-1"></a>test_x.sp <span class="ot">=</span> Procure_scaled[test_index.spline, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1007"><a href="#cb175-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value, <span class="sc">-</span>ca_contract_valuec)</span>
<span id="cb175-1008"><a href="#cb175-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1009"><a href="#cb175-1009" aria-hidden="true" tabindex="-1"></a>test_y.sp <span class="ot">=</span> Procure_scaled[test_index.spline, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1010"><a href="#cb175-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-1011"><a href="#cb175-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1012"><a href="#cb175-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1013"><a href="#cb175-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```{r training spline regression model}</span></span>
<span id="cb175-1014"><a href="#cb175-1014" aria-hidden="true" tabindex="-1"></a><span class="co">#training spline regression model</span></span>
<span id="cb175-1015"><a href="#cb175-1015" aria-hidden="true" tabindex="-1"></a>spline_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(train_y.sp <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x.sp)</span>
<span id="cb175-1016"><a href="#cb175-1016" aria-hidden="true" tabindex="-1"></a><span class="co">#base spline with degree of polynomial 3. The resulting model will have a cubic polynomial function for each of the segments between the knots (which are quantiles by default).</span></span>
<span id="cb175-1017"><a href="#cb175-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model2)</span>
<span id="cb175-1018"><a href="#cb175-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1019"><a href="#cb175-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1020"><a href="#cb175-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r predictions by spline}</span></span>
<span id="cb175-1021"><a href="#cb175-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#predictions by spline</span></span>
<span id="cb175-1022"><a href="#cb175-1022" aria-hidden="true" tabindex="-1"></a>preds_spline2 <span class="ot">=</span> <span class="fu">predict</span>(spline_model2, test_x.sp)</span>
<span id="cb175-1023"><a href="#cb175-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1024"><a href="#cb175-1024" aria-hidden="true" tabindex="-1"></a>rmse_spline2 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline2 <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1025"><a href="#cb175-1025" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds_spline2)</span>
<span id="cb175-1026"><a href="#cb175-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1027"><a href="#cb175-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1028"><a href="#cb175-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for spline}</span></span>
<span id="cb175-1029"><a href="#cb175-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for spline</span></span>
<span id="cb175-1030"><a href="#cb175-1030" aria-hidden="true" tabindex="-1"></a>sse_spline2 <span class="ot">=</span> <span class="fu">sum</span>((preds_spline2 <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1031"><a href="#cb175-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1032"><a href="#cb175-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_spline2)</span>
<span id="cb175-1033"><a href="#cb175-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_spline2)</span>
<span id="cb175-1034"><a href="#cb175-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1035"><a href="#cb175-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1036"><a href="#cb175-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1037"><a href="#cb175-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r degree 1 to compare with spline degree 2}</span></span>
<span id="cb175-1038"><a href="#cb175-1038" aria-hidden="true" tabindex="-1"></a><span class="co">#degree 1 to compare with spline degree 2</span></span>
<span id="cb175-1039"><a href="#cb175-1039" aria-hidden="true" tabindex="-1"></a>spline_model.lr <span class="ot">&lt;-</span> <span class="fu">lm</span>(train_y.sp <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x.sp)</span>
<span id="cb175-1040"><a href="#cb175-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model.lr)</span>
<span id="cb175-1041"><a href="#cb175-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1042"><a href="#cb175-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1043"><a href="#cb175-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r predictions of spline degree 1}</span></span>
<span id="cb175-1044"><a href="#cb175-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#predictions of spline degree 1</span></span>
<span id="cb175-1045"><a href="#cb175-1045" aria-hidden="true" tabindex="-1"></a>preds_spline.lr <span class="ot">=</span> <span class="fu">predict</span>(spline_model.lr, test_x.sp)</span>
<span id="cb175-1046"><a href="#cb175-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1047"><a href="#cb175-1047" aria-hidden="true" tabindex="-1"></a>rmse_spline.lr <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.lr <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1048"><a href="#cb175-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds_spline.lr)</span>
<span id="cb175-1049"><a href="#cb175-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1050"><a href="#cb175-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1051"><a href="#cb175-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for spline degree 1}</span></span>
<span id="cb175-1052"><a href="#cb175-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for spline degree 1</span></span>
<span id="cb175-1053"><a href="#cb175-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.lr <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1054"><a href="#cb175-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((preds_spline.lr <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1055"><a href="#cb175-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1056"><a href="#cb175-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1057"><a href="#cb175-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1058"><a href="#cb175-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r breif check of predictions and obs}</span></span>
<span id="cb175-1059"><a href="#cb175-1059" aria-hidden="true" tabindex="-1"></a><span class="co">#breif check of predictions and obs</span></span>
<span id="cb175-1060"><a href="#cb175-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(preds_spline2))</span>
<span id="cb175-1061"><a href="#cb175-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(preds_spline2)</span>
<span id="cb175-1062"><a href="#cb175-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_y.sp)</span>
<span id="cb175-1063"><a href="#cb175-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1064"><a href="#cb175-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1065"><a href="#cb175-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r training spline using automatic knot selection gam}</span></span>
<span id="cb175-1066"><a href="#cb175-1066" aria-hidden="true" tabindex="-1"></a><span class="co">#training spline using automatic knot selection gam</span></span>
<span id="cb175-1067"><a href="#cb175-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb175-1068"><a href="#cb175-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1069"><a href="#cb175-1069" aria-hidden="true" tabindex="-1"></a><span class="co"># gam uses a built-in algorithm to choose optimal knots based on the data</span></span>
<span id="cb175-1070"><a href="#cb175-1070" aria-hidden="true" tabindex="-1"></a>spline_model.gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(train_y.sp <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x.sp)</span>
<span id="cb175-1071"><a href="#cb175-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model.gam)</span>
<span id="cb175-1072"><a href="#cb175-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1073"><a href="#cb175-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1074"><a href="#cb175-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for optimized-knots spline}</span></span>
<span id="cb175-1075"><a href="#cb175-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for optimized-knots spline</span></span>
<span id="cb175-1076"><a href="#cb175-1076" aria-hidden="true" tabindex="-1"></a>preds_spline.gam <span class="ot">=</span> <span class="fu">predict</span>(spline_model.gam, test_x.sp)</span>
<span id="cb175-1077"><a href="#cb175-1077" aria-hidden="true" tabindex="-1"></a>rmse_spline.gam <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.gam <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1078"><a href="#cb175-1078" aria-hidden="true" tabindex="-1"></a>sse_spline.gam <span class="ot">=</span> <span class="fu">sum</span>((preds_spline.gam <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1079"><a href="#cb175-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1080"><a href="#cb175-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_spline.gam)</span>
<span id="cb175-1081"><a href="#cb175-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_spline.gam)</span>
<span id="cb175-1082"><a href="#cb175-1082" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1083"><a href="#cb175-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1084"><a href="#cb175-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r spline gam without removing outliers}</span></span>
<span id="cb175-1085"><a href="#cb175-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#spline gam without removing outliers</span></span>
<span id="cb175-1086"><a href="#cb175-1086" aria-hidden="true" tabindex="-1"></a>spline_model.gam2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(train_y <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x)</span>
<span id="cb175-1087"><a href="#cb175-1087" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model.gam2)</span>
<span id="cb175-1088"><a href="#cb175-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1089"><a href="#cb175-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1092"><a href="#cb175-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1093"><a href="#cb175-1093" aria-hidden="true" tabindex="-1"></a>preds_spline.gam2 <span class="ot">=</span> <span class="fu">predict</span>(spline_model.gam2, test_x)</span>
<span id="cb175-1094"><a href="#cb175-1094" aria-hidden="true" tabindex="-1"></a>rmse_spline.gam2 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.gam2 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1095"><a href="#cb175-1095" aria-hidden="true" tabindex="-1"></a>sse_spline.gam2 <span class="ot">=</span> <span class="fu">sum</span>((preds_spline.gam2 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1096"><a href="#cb175-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1097"><a href="#cb175-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_spline.gam2)</span>
<span id="cb175-1098"><a href="#cb175-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_spline.gam2)</span>
<span id="cb175-1099"><a href="#cb175-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1100"><a href="#cb175-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1101"><a href="#cb175-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1102"><a href="#cb175-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r coefs of spline_model.gam}</span></span>
<span id="cb175-1103"><a href="#cb175-1103" aria-hidden="true" tabindex="-1"></a><span class="co">#coefs of spline_model.gam</span></span>
<span id="cb175-1104"><a href="#cb175-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(spline_model.gam)</span>
<span id="cb175-1105"><a href="#cb175-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1106"><a href="#cb175-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1107"><a href="#cb175-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1108"><a href="#cb175-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot to compare with the previous one of nrc vs value}</span></span>
<span id="cb175-1109"><a href="#cb175-1109" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot to compare with the previous one of nrc vs value</span></span>
<span id="cb175-1110"><a href="#cb175-1110" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-1111"><a href="#cb175-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>nrc, <span class="at">y=</span>lca_contract_value)) <span class="sc">+</span></span>
<span id="cb175-1112"><a href="#cb175-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-1113"><a href="#cb175-1113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb175-1114"><a href="#cb175-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1115"><a href="#cb175-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1116"><a href="#cb175-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1117"><a href="#cb175-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compare with simple linear regression}</span></span>
<span id="cb175-1118"><a href="#cb175-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#compare with simple linear regression</span></span>
<span id="cb175-1119"><a href="#cb175-1119" aria-hidden="true" tabindex="-1"></a>lr_check <span class="ot">=</span> <span class="fu">lm</span>(train_y.sp <span class="sc">~</span> nrc <span class="sc">+</span> ca_bids_all <span class="sc">+</span> Edu <span class="sc">+</span> Ener <span class="sc">+</span> Multi, <span class="at">data =</span> train_x.sp)</span>
<span id="cb175-1120"><a href="#cb175-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr_check)</span>
<span id="cb175-1121"><a href="#cb175-1121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1122"><a href="#cb175-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1123"><a href="#cb175-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for linear reg}</span></span>
<span id="cb175-1124"><a href="#cb175-1124" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for linear reg</span></span>
<span id="cb175-1125"><a href="#cb175-1125" aria-hidden="true" tabindex="-1"></a>preds_lrcheck <span class="ot">=</span> <span class="fu">predict</span>(lr_check, test_x.sp)</span>
<span id="cb175-1126"><a href="#cb175-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1127"><a href="#cb175-1127" aria-hidden="true" tabindex="-1"></a>rmse_lrcheck <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_lrcheck <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1128"><a href="#cb175-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1129"><a href="#cb175-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_lrcheck <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1130"><a href="#cb175-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((preds_lrcheck <span class="sc">-</span> test_y.sp)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1131"><a href="#cb175-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1132"><a href="#cb175-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1133"><a href="#cb175-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gam spline with all vars}</span></span>
<span id="cb175-1134"><a href="#cb175-1134" aria-hidden="true" tabindex="-1"></a><span class="co">#gam spline with all vars</span></span>
<span id="cb175-1135"><a href="#cb175-1135" aria-hidden="true" tabindex="-1"></a>spline_model.gam3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(train_y <span class="sc">~</span> <span class="fu">bs</span>(nrc, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">bs</span>(ca_bids_all, <span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">+</span> AFR <span class="sc">+</span>EAP <span class="sc">+</span>ECA <span class="sc">+</span>LCR <span class="sc">+</span>MNA <span class="sc">+</span>SAR <span class="sc">+</span> ca_Consul.Service <span class="sc">+</span> ca_Goods <span class="sc">+</span> ca_proc_open <span class="sc">+</span> ca_proc_quality <span class="sc">+</span> ca_proc_source <span class="sc">+</span> ca_proc_restricted <span class="sc">+</span> corr_signp1 <span class="sc">+</span>corr_signp2 <span class="sc">+</span> corr_signp3 <span class="sc">+</span> taxhaven <span class="sc">+</span> not.taxhaven <span class="sc">+</span> P <span class="sc">+</span> Health <span class="sc">+</span> Edu <span class="sc">+</span> W <span class="sc">+</span> I <span class="sc">+</span> Tran <span class="sc">+</span> Fin <span class="sc">+</span> A <span class="sc">+</span> Ener <span class="sc">+</span> Info <span class="sc">+</span> H <span class="sc">+</span> Multi <span class="sc">+</span> Priv, <span class="at">data =</span> train_x)</span>
<span id="cb175-1136"><a href="#cb175-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1137"><a href="#cb175-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spline_model.gam3)</span>
<span id="cb175-1138"><a href="#cb175-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1139"><a href="#cb175-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1140"><a href="#cb175-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for spline with all vars}</span></span>
<span id="cb175-1141"><a href="#cb175-1141" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for spline with all vars</span></span>
<span id="cb175-1142"><a href="#cb175-1142" aria-hidden="true" tabindex="-1"></a>preds_spline.gam3 <span class="ot">=</span> <span class="fu">predict</span>(spline_model.gam3, test_x)</span>
<span id="cb175-1143"><a href="#cb175-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1144"><a href="#cb175-1144" aria-hidden="true" tabindex="-1"></a>rmse_sp.gam3 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_spline.gam3 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1145"><a href="#cb175-1145" aria-hidden="true" tabindex="-1"></a>sse_sp.gam3  <span class="ot">=</span> <span class="fu">sum</span>((preds_spline.gam3 <span class="sc">-</span> test_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1146"><a href="#cb175-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1147"><a href="#cb175-1147" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_sp.gam3)</span>
<span id="cb175-1148"><a href="#cb175-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_sp.gam3)</span>
<span id="cb175-1149"><a href="#cb175-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1150"><a href="#cb175-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1151"><a href="#cb175-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1152"><a href="#cb175-1152" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression Tree</span></span>
<span id="cb175-1153"><a href="#cb175-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1156"><a href="#cb175-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1157"><a href="#cb175-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(Procurement3)) <span class="co">#no missing values</span></span>
<span id="cb175-1158"><a href="#cb175-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1159"><a href="#cb175-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1160"><a href="#cb175-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1161"><a href="#cb175-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries for Trees}</span></span>
<span id="cb175-1162"><a href="#cb175-1162" aria-hidden="true" tabindex="-1"></a><span class="co">#libraries for Trees</span></span>
<span id="cb175-1163"><a href="#cb175-1163" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb175-1164"><a href="#cb175-1164" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot) <span class="co">#prettier plots for rpart</span></span>
<span id="cb175-1165"><a href="#cb175-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb175-1166"><a href="#cb175-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1167"><a href="#cb175-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1168"><a href="#cb175-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r checking the structure of the dataset}</span></span>
<span id="cb175-1169"><a href="#cb175-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#checking the structure of the dataset</span></span>
<span id="cb175-1170"><a href="#cb175-1170" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Procurement3)</span>
<span id="cb175-1171"><a href="#cb175-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1172"><a href="#cb175-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1173"><a href="#cb175-1173" aria-hidden="true" tabindex="-1"></a>We need to recode dummies as factors for the decision tree.</span>
<span id="cb175-1174"><a href="#cb175-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1175"><a href="#cb175-1175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r changing dummies from numeric to factor}</span></span>
<span id="cb175-1176"><a href="#cb175-1176" aria-hidden="true" tabindex="-1"></a><span class="co">#changing dummies from numeric to factor</span></span>
<span id="cb175-1177"><a href="#cb175-1177" aria-hidden="true" tabindex="-1"></a>cols_for_factor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AFR"</span>, <span class="st">"EAP"</span>, <span class="st">"ECA"</span>, <span class="st">"LCR"</span>, <span class="st">"MNA"</span>, <span class="st">"SAR"</span>, <span class="st">"ca_Consul.Service"</span>, <span class="st">"ca_Goods"</span>, <span class="st">"ca_proc_open"</span>, <span class="st">"ca_proc_quality"</span>, <span class="st">"ca_proc_source"</span>, <span class="st">"ca_proc_restricted"</span>, <span class="st">"singleb"</span>, <span class="st">"corr_signp1"</span>, <span class="st">"corr_signp2"</span>, <span class="st">"corr_signp3"</span>, <span class="st">"taxhaven"</span>, <span class="st">"not.taxhaven"</span>, <span class="st">"P"</span>, <span class="st">"Health"</span>, <span class="st">"Edu"</span>, <span class="st">"W"</span>, <span class="st">"I"</span>, <span class="st">"Tran"</span>, <span class="st">"Fin"</span>, <span class="st">"A"</span>, <span class="st">"Ener"</span>, <span class="st">"Info"</span>, <span class="st">"H"</span>, <span class="st">"Multi"</span>, <span class="st">"Priv"</span>)</span>
<span id="cb175-1178"><a href="#cb175-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1179"><a href="#cb175-1179" aria-hidden="true" tabindex="-1"></a>Procurement5 <span class="ot">&lt;-</span> Procurement3 <span class="sc">%&gt;%</span></span>
<span id="cb175-1180"><a href="#cb175-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"cri_wb.d"</span>), <span class="sc">-</span>ca_contract_valuec) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1181"><a href="#cb175-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">all_of</span>(<span class="fu">vars</span>(cols_for_factor)), factor)</span>
<span id="cb175-1182"><a href="#cb175-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1183"><a href="#cb175-1183" aria-hidden="true" tabindex="-1"></a><span class="co">#Procure_scaled2[cols_for_factor] = lapply(Procure_scaled[cols_for_factor], factor)</span></span>
<span id="cb175-1184"><a href="#cb175-1184" aria-hidden="true" tabindex="-1"></a><span class="co">#Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0. Please use `all_of()` or `any_of()` instead.</span></span>
<span id="cb175-1185"><a href="#cb175-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1186"><a href="#cb175-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1189"><a href="#cb175-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1190"><a href="#cb175-1190" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Procurement5)</span>
<span id="cb175-1191"><a href="#cb175-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1192"><a href="#cb175-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1193"><a href="#cb175-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1194"><a href="#cb175-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r assigning and sampling indices for tree model}</span></span>
<span id="cb175-1195"><a href="#cb175-1195" aria-hidden="true" tabindex="-1"></a><span class="co">#assigning and sampling indices for tree model</span></span>
<span id="cb175-1196"><a href="#cb175-1196" aria-hidden="true" tabindex="-1"></a>index.t <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procurement5)</span>
<span id="cb175-1197"><a href="#cb175-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1198"><a href="#cb175-1198" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random </span></span>
<span id="cb175-1199"><a href="#cb175-1199" aria-hidden="true" tabindex="-1"></a>train_index.t <span class="ot">=</span> <span class="fu">sample</span>(index.t, <span class="fu">round</span>(<span class="fl">0.90</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement4)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 90% of rows without replacement</span></span>
<span id="cb175-1200"><a href="#cb175-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1201"><a href="#cb175-1201" aria-hidden="true" tabindex="-1"></a>test_index.t <span class="ot">=</span> <span class="fu">setdiff</span>(index.t, train_index.t) <span class="co">#takes untaken rows</span></span>
<span id="cb175-1202"><a href="#cb175-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1203"><a href="#cb175-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1204"><a href="#cb175-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating train and test sets for tree model}</span></span>
<span id="cb175-1205"><a href="#cb175-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#creating train and test sets for tree model</span></span>
<span id="cb175-1206"><a href="#cb175-1206" aria-hidden="true" tabindex="-1"></a>train_x.t <span class="ot">=</span> Procurement5[train_index.t, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1207"><a href="#cb175-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value) <span class="co">#Procure_scaled[train_index, ] expression to use only training subset %&gt;% everything except price and price category</span></span>
<span id="cb175-1208"><a href="#cb175-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1209"><a href="#cb175-1209" aria-hidden="true" tabindex="-1"></a>train_y.t <span class="ot">=</span> Procurement5[train_index.t, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1210"><a href="#cb175-1210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-1211"><a href="#cb175-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1212"><a href="#cb175-1212" aria-hidden="true" tabindex="-1"></a>test_x.t <span class="ot">=</span> Procurement5[test_index.t, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1213"><a href="#cb175-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lca_contract_value)</span>
<span id="cb175-1214"><a href="#cb175-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1215"><a href="#cb175-1215" aria-hidden="true" tabindex="-1"></a>test_y.t <span class="ot">=</span> Procurement5[test_index.t, ] <span class="sc">%&gt;%</span> </span>
<span id="cb175-1216"><a href="#cb175-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lca_contract_value)</span>
<span id="cb175-1217"><a href="#cb175-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1218"><a href="#cb175-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1219"><a href="#cb175-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r first regression tree model}</span></span>
<span id="cb175-1220"><a href="#cb175-1220" aria-hidden="true" tabindex="-1"></a><span class="co">#first regression tree model</span></span>
<span id="cb175-1221"><a href="#cb175-1221" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(</span>
<span id="cb175-1222"><a href="#cb175-1222" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1223"><a href="#cb175-1223" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1224"><a href="#cb175-1224" aria-hidden="true" tabindex="-1"></a>  <span class="at">method  =</span> <span class="st">"anova"</span></span>
<span id="cb175-1225"><a href="#cb175-1225" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb175-1226"><a href="#cb175-1226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1227"><a href="#cb175-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1228"><a href="#cb175-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot for the first tree}</span></span>
<span id="cb175-1229"><a href="#cb175-1229" aria-hidden="true" tabindex="-1"></a><span class="co">#plot for the first tree</span></span>
<span id="cb175-1230"><a href="#cb175-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_model, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb175-1231"><a href="#cb175-1231" aria-hidden="true" tabindex="-1"></a><span class="co">#digits = The number of significant digits in displayed numbers</span></span>
<span id="cb175-1232"><a href="#cb175-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1233"><a href="#cb175-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1234"><a href="#cb175-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r structure of the tree}</span></span>
<span id="cb175-1235"><a href="#cb175-1235" aria-hidden="true" tabindex="-1"></a><span class="co">#structure of the tree</span></span>
<span id="cb175-1236"><a href="#cb175-1236" aria-hidden="true" tabindex="-1"></a>tree_model</span>
<span id="cb175-1237"><a href="#cb175-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1238"><a href="#cb175-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1239"><a href="#cb175-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1240"><a href="#cb175-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot size of the tree}</span></span>
<span id="cb175-1241"><a href="#cb175-1241" aria-hidden="true" tabindex="-1"></a><span class="co">#plot size of the tree</span></span>
<span id="cb175-1242"><a href="#cb175-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(tree_model)</span>
<span id="cb175-1243"><a href="#cb175-1243" aria-hidden="true" tabindex="-1"></a><span class="co">#To compare the error for each alpha value, rpart performs a 10-fold cross validation so that the error associated with a given alpa value is computed on the hold-out validation data.</span></span>
<span id="cb175-1244"><a href="#cb175-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1245"><a href="#cb175-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1246"><a href="#cb175-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cptable for the first tree}</span></span>
<span id="cb175-1247"><a href="#cb175-1247" aria-hidden="true" tabindex="-1"></a><span class="co">#cptable for the first tree</span></span>
<span id="cb175-1248"><a href="#cb175-1248" aria-hidden="true" tabindex="-1"></a>tree_model<span class="sc">$</span>cptable</span>
<span id="cb175-1249"><a href="#cb175-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1250"><a href="#cb175-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1251"><a href="#cb175-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1252"><a href="#cb175-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse of the first tree_model}</span></span>
<span id="cb175-1253"><a href="#cb175-1253" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse of the first tree_model</span></span>
<span id="cb175-1254"><a href="#cb175-1254" aria-hidden="true" tabindex="-1"></a>preds_tree <span class="ot">=</span> <span class="fu">predict</span>(tree_model, test_x.t)</span>
<span id="cb175-1255"><a href="#cb175-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1256"><a href="#cb175-1256" aria-hidden="true" tabindex="-1"></a>rmse_tree <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_tree <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1257"><a href="#cb175-1257" aria-hidden="true" tabindex="-1"></a>sse_tree <span class="ot">=</span> <span class="fu">sum</span>((preds_tree <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1258"><a href="#cb175-1258" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_tree)</span>
<span id="cb175-1259"><a href="#cb175-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_tree)</span>
<span id="cb175-1260"><a href="#cb175-1260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1261"><a href="#cb175-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1262"><a href="#cb175-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tuning Regression Tree</span></span>
<span id="cb175-1263"><a href="#cb175-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1264"><a href="#cb175-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r expand grid of the minsplit and maxdepth}</span></span>
<span id="cb175-1265"><a href="#cb175-1265" aria-hidden="true" tabindex="-1"></a><span class="co">#expand grid of the minsplit and maxdepth</span></span>
<span id="cb175-1266"><a href="#cb175-1266" aria-hidden="true" tabindex="-1"></a>hyper_grid.t <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb175-1267"><a href="#cb175-1267" aria-hidden="true" tabindex="-1"></a>  <span class="at">minsplit =</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb175-1268"><a href="#cb175-1268" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxdepth =</span> <span class="fu">seq</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">1</span>)</span>
<span id="cb175-1269"><a href="#cb175-1269" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-1270"><a href="#cb175-1270" aria-hidden="true" tabindex="-1"></a><span class="co">#create a hyper parameter grid</span></span>
<span id="cb175-1271"><a href="#cb175-1271" aria-hidden="true" tabindex="-1"></a><span class="co">#minsplit is the minimum number of data points required to attempt a split in the tree. Default=20</span></span>
<span id="cb175-1272"><a href="#cb175-1272" aria-hidden="true" tabindex="-1"></a><span class="co">#maxdepth is the maximum number of internal nodes between the root node and the terminal nodes (leafs). Default=30</span></span>
<span id="cb175-1273"><a href="#cb175-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1274"><a href="#cb175-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1275"><a href="#cb175-1275" aria-hidden="true" tabindex="-1"></a>WARNING: Takes a lot of time to run</span>
<span id="cb175-1276"><a href="#cb175-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1277"><a href="#cb175-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loop function for training trees}</span></span>
<span id="cb175-1278"><a href="#cb175-1278" aria-hidden="true" tabindex="-1"></a><span class="co">#loop function for training trees</span></span>
<span id="cb175-1279"><a href="#cb175-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1280"><a href="#cb175-1280" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb175-1281"><a href="#cb175-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1282"><a href="#cb175-1282" aria-hidden="true" tabindex="-1"></a>tree_models <span class="ot">=</span> <span class="fu">list</span>() <span class="co">#creates a list that will contain tree models</span></span>
<span id="cb175-1283"><a href="#cb175-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1284"><a href="#cb175-1284" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hyper_grid.t)) {</span>
<span id="cb175-1285"><a href="#cb175-1285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb175-1286"><a href="#cb175-1286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gets minsplit, maxdepth values at row i in hyper_grid.t</span></span>
<span id="cb175-1287"><a href="#cb175-1287" aria-hidden="true" tabindex="-1"></a>  minsplit <span class="ot">=</span> hyper_grid.t<span class="sc">$</span>minsplit[i]</span>
<span id="cb175-1288"><a href="#cb175-1288" aria-hidden="true" tabindex="-1"></a>  maxdepth <span class="ot">=</span> hyper_grid.t<span class="sc">$</span>maxdepth[i]</span>
<span id="cb175-1289"><a href="#cb175-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1290"><a href="#cb175-1290" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trains a model and stores in the tree_models list</span></span>
<span id="cb175-1291"><a href="#cb175-1291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># models[[i]] = rpart(...) assigns a trained decision tree model to i-th element.</span></span>
<span id="cb175-1292"><a href="#cb175-1292" aria-hidden="true" tabindex="-1"></a>  tree_models[[i]] <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb175-1293"><a href="#cb175-1293" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1294"><a href="#cb175-1294" aria-hidden="true" tabindex="-1"></a>    <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1295"><a href="#cb175-1295" aria-hidden="true" tabindex="-1"></a>    <span class="at">method  =</span> <span class="st">"anova"</span>,</span>
<span id="cb175-1296"><a href="#cb175-1296" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">minsplit =</span> minsplit, <span class="at">maxdepth =</span> maxdepth)</span>
<span id="cb175-1297"><a href="#cb175-1297" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb175-1298"><a href="#cb175-1298" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-1299"><a href="#cb175-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1300"><a href="#cb175-1300" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span>
<span id="cb175-1301"><a href="#cb175-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1302"><a href="#cb175-1302" aria-hidden="true" tabindex="-1"></a><span class="co">#took a lot of time to run</span></span>
<span id="cb175-1303"><a href="#cb175-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1304"><a href="#cb175-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1305"><a href="#cb175-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Functions to get the parameters with lowest error}</span></span>
<span id="cb175-1306"><a href="#cb175-1306" aria-hidden="true" tabindex="-1"></a><span class="co">#Functions to get the parameters with lowest error</span></span>
<span id="cb175-1307"><a href="#cb175-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get optimal cp</span></span>
<span id="cb175-1308"><a href="#cb175-1308" aria-hidden="true" tabindex="-1"></a>get_cp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb175-1309"><a href="#cb175-1309" aria-hidden="true" tabindex="-1"></a>  min    <span class="ot">&lt;-</span> <span class="fu">which.min</span>(x<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>])</span>
<span id="cb175-1310"><a href="#cb175-1310" aria-hidden="true" tabindex="-1"></a>  cp <span class="ot">&lt;-</span> x<span class="sc">$</span>cptable[min, <span class="st">"CP"</span>] </span>
<span id="cb175-1311"><a href="#cb175-1311" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-1312"><a href="#cb175-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1313"><a href="#cb175-1313" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get minimum error</span></span>
<span id="cb175-1314"><a href="#cb175-1314" aria-hidden="true" tabindex="-1"></a>get_min_error <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb175-1315"><a href="#cb175-1315" aria-hidden="true" tabindex="-1"></a>  min    <span class="ot">&lt;-</span> <span class="fu">which.min</span>(x<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>])</span>
<span id="cb175-1316"><a href="#cb175-1316" aria-hidden="true" tabindex="-1"></a>  xerror <span class="ot">&lt;-</span> x<span class="sc">$</span>cptable[min, <span class="st">"xerror"</span>] </span>
<span id="cb175-1317"><a href="#cb175-1317" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-1318"><a href="#cb175-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1319"><a href="#cb175-1319" aria-hidden="true" tabindex="-1"></a>hyper_grid.t <span class="sc">%&gt;%</span></span>
<span id="cb175-1320"><a href="#cb175-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb175-1321"><a href="#cb175-1321" aria-hidden="true" tabindex="-1"></a>    <span class="at">cp    =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(tree_models, get_cp),</span>
<span id="cb175-1322"><a href="#cb175-1322" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(tree_models, get_min_error)</span>
<span id="cb175-1323"><a href="#cb175-1323" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb175-1324"><a href="#cb175-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(error) <span class="sc">%&gt;%</span></span>
<span id="cb175-1325"><a href="#cb175-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="at">wt =</span> error)</span>
<span id="cb175-1326"><a href="#cb175-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1327"><a href="#cb175-1327" aria-hidden="true" tabindex="-1"></a><span class="co">#Mutates hyper_grid.t and adds columns with cp and errors and then returns top 5 rows with the lowest error value.</span></span>
<span id="cb175-1328"><a href="#cb175-1328" aria-hidden="true" tabindex="-1"></a><span class="co">#purrr::map_dbl() takes two arguments: the first argument is the vector or list that we want to apply the function to, and the second argument is the function that we want to apply. It applies the function to each element and returns a double (numeric).</span></span>
<span id="cb175-1329"><a href="#cb175-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1330"><a href="#cb175-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1331"><a href="#cb175-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tuned regression tree}</span></span>
<span id="cb175-1332"><a href="#cb175-1332" aria-hidden="true" tabindex="-1"></a><span class="co">#tuned regression tree</span></span>
<span id="cb175-1333"><a href="#cb175-1333" aria-hidden="true" tabindex="-1"></a>tuned_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(</span>
<span id="cb175-1334"><a href="#cb175-1334" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1335"><a href="#cb175-1335" aria-hidden="true" tabindex="-1"></a>    <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1336"><a href="#cb175-1336" aria-hidden="true" tabindex="-1"></a>    <span class="at">method  =</span> <span class="st">"anova"</span>,</span>
<span id="cb175-1337"><a href="#cb175-1337" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">minsplit =</span> <span class="dv">8</span>, <span class="at">maxdepth =</span> <span class="dv">13</span>, <span class="at">cp =</span> <span class="fl">0.01</span>)</span>
<span id="cb175-1338"><a href="#cb175-1338" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb175-1339"><a href="#cb175-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1340"><a href="#cb175-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1341"><a href="#cb175-1341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r RMSE and SSE for the tuned tree}</span></span>
<span id="cb175-1342"><a href="#cb175-1342" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE and SSE for the tuned tree</span></span>
<span id="cb175-1343"><a href="#cb175-1343" aria-hidden="true" tabindex="-1"></a>preds_tree2 <span class="ot">=</span> <span class="fu">predict</span>(tuned_tree, test_x.t)</span>
<span id="cb175-1344"><a href="#cb175-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1345"><a href="#cb175-1345" aria-hidden="true" tabindex="-1"></a>rmse_tunedtree <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_tree2 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1346"><a href="#cb175-1346" aria-hidden="true" tabindex="-1"></a>sse_tunedtree <span class="ot">=</span> <span class="fu">sum</span>((preds_tree2 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1347"><a href="#cb175-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_tunedtree)</span>
<span id="cb175-1348"><a href="#cb175-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_tunedtree)</span>
<span id="cb175-1349"><a href="#cb175-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1350"><a href="#cb175-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1351"><a href="#cb175-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot for the tuned tree}</span></span>
<span id="cb175-1352"><a href="#cb175-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#plot for the tuned tree</span></span>
<span id="cb175-1353"><a href="#cb175-1353" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tuned_tree, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb175-1354"><a href="#cb175-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1355"><a href="#cb175-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1356"><a href="#cb175-1356" aria-hidden="true" tabindex="-1"></a>Absolutely no difference between the automatically optimized regression tree and the tuned one.</span>
<span id="cb175-1357"><a href="#cb175-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1358"><a href="#cb175-1358" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bagging</span></span>
<span id="cb175-1359"><a href="#cb175-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1360"><a href="#cb175-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r library ipred and carte for bagging}</span></span>
<span id="cb175-1361"><a href="#cb175-1361" aria-hidden="true" tabindex="-1"></a><span class="co">#library ipred and carte for bagging</span></span>
<span id="cb175-1362"><a href="#cb175-1362" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipred)</span>
<span id="cb175-1363"><a href="#cb175-1363" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb175-1364"><a href="#cb175-1364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1365"><a href="#cb175-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1366"><a href="#cb175-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1367"><a href="#cb175-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1368"><a href="#cb175-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r training first bagged model}</span></span>
<span id="cb175-1369"><a href="#cb175-1369" aria-hidden="true" tabindex="-1"></a><span class="co">#training first bagged model</span></span>
<span id="cb175-1370"><a href="#cb175-1370" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb175-1371"><a href="#cb175-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1372"><a href="#cb175-1372" aria-hidden="true" tabindex="-1"></a><span class="co"># train bagged model</span></span>
<span id="cb175-1373"><a href="#cb175-1373" aria-hidden="true" tabindex="-1"></a>bag_tree <span class="ot">&lt;-</span> <span class="fu">bagging</span>(</span>
<span id="cb175-1374"><a href="#cb175-1374" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1375"><a href="#cb175-1375" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1376"><a href="#cb175-1376" aria-hidden="true" tabindex="-1"></a>  <span class="at">coob    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb175-1377"><a href="#cb175-1377" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb175-1378"><a href="#cb175-1378" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-1379"><a href="#cb175-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1380"><a href="#cb175-1380" aria-hidden="true" tabindex="-1"></a><span class="co">#importance=TRUE computes and stores the variables' relative importance. </span></span>
<span id="cb175-1381"><a href="#cb175-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1382"><a href="#cb175-1382" aria-hidden="true" tabindex="-1"></a>bag_tree</span>
<span id="cb175-1383"><a href="#cb175-1383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1384"><a href="#cb175-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1385"><a href="#cb175-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1386"><a href="#cb175-1386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot for var importance}</span></span>
<span id="cb175-1387"><a href="#cb175-1387" aria-hidden="true" tabindex="-1"></a><span class="co">#plot for var importance</span></span>
<span id="cb175-1388"><a href="#cb175-1388" aria-hidden="true" tabindex="-1"></a>varimp <span class="ot">=</span> <span class="fu">varImp</span>(bag_tree) <span class="co">#importance from caret package</span></span>
<span id="cb175-1389"><a href="#cb175-1389" aria-hidden="true" tabindex="-1"></a>varimp <span class="ot">=</span> <span class="fu">rownames_to_column</span>(varimp, <span class="at">var =</span> <span class="st">"variable"</span>)</span>
<span id="cb175-1390"><a href="#cb175-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1391"><a href="#cb175-1391" aria-hidden="true" tabindex="-1"></a><span class="co"># create bar plot of variable importance measures</span></span>
<span id="cb175-1392"><a href="#cb175-1392" aria-hidden="true" tabindex="-1"></a>varimp <span class="sc">%&gt;%</span> </span>
<span id="cb175-1393"><a href="#cb175-1393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Overall<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1394"><a href="#cb175-1394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Overall, </span>
<span id="cb175-1395"><a href="#cb175-1395" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">0</span>, </span>
<span id="cb175-1396"><a href="#cb175-1396" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(variable, Overall), </span>
<span id="cb175-1397"><a href="#cb175-1397" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>variable)) <span class="sc">+</span></span>
<span id="cb175-1398"><a href="#cb175-1398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb175-1399"><a href="#cb175-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-1400"><a href="#cb175-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Importance Plot for Bagging Model"</span>, <span class="at">x =</span> <span class="st">"Importance"</span>, <span class="at">y =</span> <span class="st">"Variables"</span>)</span>
<span id="cb175-1401"><a href="#cb175-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1402"><a href="#cb175-1402" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_bar(stat = "identity", fill = "steelblue") +</span></span>
<span id="cb175-1403"><a href="#cb175-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1404"><a href="#cb175-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1405"><a href="#cb175-1405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for default bagging (first bagtree)}</span></span>
<span id="cb175-1406"><a href="#cb175-1406" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for default bagging (first bagtree)</span></span>
<span id="cb175-1407"><a href="#cb175-1407" aria-hidden="true" tabindex="-1"></a>preds_tree3 <span class="ot">=</span> <span class="fu">predict</span>(bag_tree, test_x.t)</span>
<span id="cb175-1408"><a href="#cb175-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1409"><a href="#cb175-1409" aria-hidden="true" tabindex="-1"></a>rmse_bagtree <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_tree3 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1410"><a href="#cb175-1410" aria-hidden="true" tabindex="-1"></a>sse_bagtree <span class="ot">=</span> <span class="fu">sum</span>((preds_tree3 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1411"><a href="#cb175-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_bagtree)</span>
<span id="cb175-1412"><a href="#cb175-1412" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_bagtree)</span>
<span id="cb175-1413"><a href="#cb175-1413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1414"><a href="#cb175-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1415"><a href="#cb175-1415" aria-hidden="true" tabindex="-1"></a>WARNING: Takes time to run</span>
<span id="cb175-1416"><a href="#cb175-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1417"><a href="#cb175-1417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loop for plotting ntree vs rmse}</span></span>
<span id="cb175-1418"><a href="#cb175-1418" aria-hidden="true" tabindex="-1"></a><span class="co">#loop for plotting ntree vs rmse</span></span>
<span id="cb175-1419"><a href="#cb175-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1420"><a href="#cb175-1420" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb175-1421"><a href="#cb175-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1422"><a href="#cb175-1422" aria-hidden="true" tabindex="-1"></a><span class="co"># assess 10-50 bagged trees</span></span>
<span id="cb175-1423"><a href="#cb175-1423" aria-hidden="true" tabindex="-1"></a>ntree <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb175-1424"><a href="#cb175-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1425"><a href="#cb175-1425" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty vector to store OOB RMSE values</span></span>
<span id="cb175-1426"><a href="#cb175-1426" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="fu">length</span>(ntree))</span>
<span id="cb175-1427"><a href="#cb175-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1428"><a href="#cb175-1428" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(ntree)) {</span>
<span id="cb175-1429"><a href="#cb175-1429" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproducibility</span></span>
<span id="cb175-1430"><a href="#cb175-1430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb175-1431"><a href="#cb175-1431" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb175-1432"><a href="#cb175-1432" aria-hidden="true" tabindex="-1"></a>  <span class="co"># training bagged models</span></span>
<span id="cb175-1433"><a href="#cb175-1433" aria-hidden="true" tabindex="-1"></a>  bagged_models <span class="ot">&lt;-</span> <span class="fu">bagging</span>(</span>
<span id="cb175-1434"><a href="#cb175-1434" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1435"><a href="#cb175-1435" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1436"><a href="#cb175-1436" aria-hidden="true" tabindex="-1"></a>  <span class="at">coob    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb175-1437"><a href="#cb175-1437" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbagg   =</span> ntree[i]</span>
<span id="cb175-1438"><a href="#cb175-1438" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-1439"><a href="#cb175-1439" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get OOB error</span></span>
<span id="cb175-1440"><a href="#cb175-1440" aria-hidden="true" tabindex="-1"></a>  RMSE[i] <span class="ot">&lt;-</span> bagged_models<span class="sc">$</span>err</span>
<span id="cb175-1441"><a href="#cb175-1441" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-1442"><a href="#cb175-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1443"><a href="#cb175-1443" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span>
<span id="cb175-1444"><a href="#cb175-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1445"><a href="#cb175-1445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1446"><a href="#cb175-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1447"><a href="#cb175-1447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot ntree vs RMSE}</span></span>
<span id="cb175-1448"><a href="#cb175-1448" aria-hidden="true" tabindex="-1"></a><span class="co">#plot ntree vs RMSE</span></span>
<span id="cb175-1449"><a href="#cb175-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ntree, RMSE, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb175-1450"><a href="#cb175-1450" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">11</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb175-1451"><a href="#cb175-1451" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">25</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="co">#25 is default number of bootstraps</span></span>
<span id="cb175-1452"><a href="#cb175-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1453"><a href="#cb175-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1454"><a href="#cb175-1454" aria-hidden="true" tabindex="-1"></a>We can see that the error drops and suddenly rises. After that the fall is slower. Given that 11 bootstraps give the lowest error before the default of 25, we can use it to reduce computation time. </span>
<span id="cb175-1455"><a href="#cb175-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1458"><a href="#cb175-1458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1459"><a href="#cb175-1459" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(RMSE) <span class="co">#the minimum eror is not significantly lower</span></span>
<span id="cb175-1460"><a href="#cb175-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1461"><a href="#cb175-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1462"><a href="#cb175-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r training new bagged model}</span></span>
<span id="cb175-1463"><a href="#cb175-1463" aria-hidden="true" tabindex="-1"></a><span class="co">#training new bagged model</span></span>
<span id="cb175-1464"><a href="#cb175-1464" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb175-1465"><a href="#cb175-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1466"><a href="#cb175-1466" aria-hidden="true" tabindex="-1"></a><span class="co"># train bagged model with 11 trees</span></span>
<span id="cb175-1467"><a href="#cb175-1467" aria-hidden="true" tabindex="-1"></a>bag_tree2 <span class="ot">&lt;-</span> <span class="fu">bagging</span>(</span>
<span id="cb175-1468"><a href="#cb175-1468" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> train_y.t <span class="sc">~</span> .,</span>
<span id="cb175-1469"><a href="#cb175-1469" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> train_x.t,</span>
<span id="cb175-1470"><a href="#cb175-1470" aria-hidden="true" tabindex="-1"></a>  <span class="at">coob    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb175-1471"><a href="#cb175-1471" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbagg   =</span> <span class="dv">11</span></span>
<span id="cb175-1472"><a href="#cb175-1472" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-1473"><a href="#cb175-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1474"><a href="#cb175-1474" aria-hidden="true" tabindex="-1"></a>bag_tree2</span>
<span id="cb175-1475"><a href="#cb175-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1476"><a href="#cb175-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1477"><a href="#cb175-1477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rmse and sse for optimal bagging}</span></span>
<span id="cb175-1478"><a href="#cb175-1478" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse and sse for optimal bagging</span></span>
<span id="cb175-1479"><a href="#cb175-1479" aria-hidden="true" tabindex="-1"></a>preds_tree4 <span class="ot">=</span> <span class="fu">predict</span>(bag_tree2, test_x.t)</span>
<span id="cb175-1480"><a href="#cb175-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1481"><a href="#cb175-1481" aria-hidden="true" tabindex="-1"></a>rmse_bagtree2 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(preds_tree4 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1482"><a href="#cb175-1482" aria-hidden="true" tabindex="-1"></a>sse_bagtree2 <span class="ot">=</span> <span class="fu">sum</span>((preds_tree4 <span class="sc">-</span> test_y.t)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb175-1483"><a href="#cb175-1483" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_bagtree2)</span>
<span id="cb175-1484"><a href="#cb175-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sse_bagtree2)</span>
<span id="cb175-1485"><a href="#cb175-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1486"><a href="#cb175-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1487"><a href="#cb175-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1488"><a href="#cb175-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1489"><a href="#cb175-1489" aria-hidden="true" tabindex="-1"></a><span class="fu">## Support Vector Machine</span></span>
<span id="cb175-1490"><a href="#cb175-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1491"><a href="#cb175-1491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r library e1071 for SVM}</span></span>
<span id="cb175-1492"><a href="#cb175-1492" aria-hidden="true" tabindex="-1"></a><span class="co">#library e1071 for SVM</span></span>
<span id="cb175-1493"><a href="#cb175-1493" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb175-1494"><a href="#cb175-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1495"><a href="#cb175-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1496"><a href="#cb175-1496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plotting nrc vs bidders and looking at classes}</span></span>
<span id="cb175-1497"><a href="#cb175-1497" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting nrc vs bidders and looking at classes</span></span>
<span id="cb175-1498"><a href="#cb175-1498" aria-hidden="true" tabindex="-1"></a>Procurement3 <span class="sc">%&gt;%</span> </span>
<span id="cb175-1499"><a href="#cb175-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ca_bids_all <span class="sc">&gt;=</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1500"><a href="#cb175-1500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">above200k =</span> <span class="fu">recode_factor</span>(ca_contract_valuec,</span>
<span id="cb175-1501"><a href="#cb175-1501" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"200.000-"</span><span class="ot">=</span><span class="st">"Yes"</span>,</span>
<span id="cb175-1502"><a href="#cb175-1502" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> <span class="st">"No"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1503"><a href="#cb175-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_bids_all, </span>
<span id="cb175-1504"><a href="#cb175-1504" aria-hidden="true" tabindex="-1"></a>             <span class="at">y=</span>nrc,</span>
<span id="cb175-1505"><a href="#cb175-1505" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>above200k)) <span class="sc">+</span></span>
<span id="cb175-1506"><a href="#cb175-1506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb175-1507"><a href="#cb175-1507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#000000"</span>)) <span class="sc">+</span></span>
<span id="cb175-1508"><a href="#cb175-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Value"</span>, <span class="at">x =</span> <span class="st">"bidders"</span>, <span class="at">y =</span> <span class="st">"nrc"</span>) <span class="sc">+</span></span>
<span id="cb175-1509"><a href="#cb175-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb175-1510"><a href="#cb175-1510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1511"><a href="#cb175-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1514"><a href="#cb175-1514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1515"><a href="#cb175-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Procure_scaled)</span>
<span id="cb175-1516"><a href="#cb175-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1517"><a href="#cb175-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1518"><a href="#cb175-1518" aria-hidden="true" tabindex="-1"></a>We need scaled data, because the svm models take very long to run.</span>
<span id="cb175-1519"><a href="#cb175-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1520"><a href="#cb175-1520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Procurement.svm}</span></span>
<span id="cb175-1521"><a href="#cb175-1521" aria-hidden="true" tabindex="-1"></a><span class="co">#Procurement.svm</span></span>
<span id="cb175-1522"><a href="#cb175-1522" aria-hidden="true" tabindex="-1"></a>Procurement.svm <span class="ot">=</span> Procure_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb175-1523"><a href="#cb175-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">abv200k =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(ca_contract_valuec<span class="sc">==</span><span class="st">"200.000-"</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1524"><a href="#cb175-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(abv200k, </span>
<span id="cb175-1525"><a href="#cb175-1525" aria-hidden="true" tabindex="-1"></a>         nrc, </span>
<span id="cb175-1526"><a href="#cb175-1526" aria-hidden="true" tabindex="-1"></a>         ca_bids_all, </span>
<span id="cb175-1527"><a href="#cb175-1527" aria-hidden="true" tabindex="-1"></a>         P) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1528"><a href="#cb175-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(ca_bids_all, nrc), </span>
<span id="cb175-1529"><a href="#cb175-1529" aria-hidden="true" tabindex="-1"></a>            <span class="fu">funs</span>(<span class="fu">as.numeric</span>(.)))</span>
<span id="cb175-1530"><a href="#cb175-1530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1531"><a href="#cb175-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1532"><a href="#cb175-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1533"><a href="#cb175-1533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r subsetting data for svm}</span></span>
<span id="cb175-1534"><a href="#cb175-1534" aria-hidden="true" tabindex="-1"></a><span class="co">#subsetting data for svm</span></span>
<span id="cb175-1535"><a href="#cb175-1535" aria-hidden="true" tabindex="-1"></a>idx.svm <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Procurement.svm)</span>
<span id="cb175-1536"><a href="#cb175-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1537"><a href="#cb175-1537" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="co">#for random</span></span>
<span id="cb175-1538"><a href="#cb175-1538" aria-hidden="true" tabindex="-1"></a>train_idx.svm <span class="ot">=</span> <span class="fu">sample</span>(idx.svm, <span class="fu">round</span>(<span class="fl">0.50</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement.svm)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#takes sample of 50% of rows without replacement</span></span>
<span id="cb175-1539"><a href="#cb175-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1540"><a href="#cb175-1540" aria-hidden="true" tabindex="-1"></a>test_idx.svm <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">setdiff</span>(idx.svm, train_idx.svm), <span class="fu">round</span>(<span class="fl">0.10</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement.svm))) <span class="co">#takes 10% from the remaining rows for test</span></span>
<span id="cb175-1541"><a href="#cb175-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1542"><a href="#cb175-1542" aria-hidden="true" tabindex="-1"></a>tune_idx.svm <span class="ot">=</span> <span class="fu">sample</span>(idx.svm, <span class="fu">round</span>(<span class="fl">0.03</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement.svm)), <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="co">#index of the obs that we will use for tuning. Only 3%, because it is very time-consuming.</span></span>
<span id="cb175-1543"><a href="#cb175-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1544"><a href="#cb175-1544" aria-hidden="true" tabindex="-1"></a>test_idx.svm2 <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">setdiff</span>(idx.svm, tune_idx.svm), <span class="fu">round</span>(<span class="fl">0.10</span><span class="sc">*</span><span class="fu">nrow</span>(Procurement.svm)))</span>
<span id="cb175-1545"><a href="#cb175-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1546"><a href="#cb175-1546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1547"><a href="#cb175-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1550"><a href="#cb175-1550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1551"><a href="#cb175-1551" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Procurement.svm[train_idx.svm,])</span>
<span id="cb175-1552"><a href="#cb175-1552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1553"><a href="#cb175-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1554"><a href="#cb175-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1555"><a href="#cb175-1555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r training first svm model}</span></span>
<span id="cb175-1556"><a href="#cb175-1556" aria-hidden="true" tabindex="-1"></a><span class="co">#training first svm model</span></span>
<span id="cb175-1557"><a href="#cb175-1557" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb175-1558"><a href="#cb175-1558" aria-hidden="true" tabindex="-1"></a><span class="co"># sample training data and fit model</span></span>
<span id="cb175-1559"><a href="#cb175-1559" aria-hidden="true" tabindex="-1"></a>svm.m1 <span class="ot">&lt;-</span> <span class="fu">svm</span>(abv200k<span class="sc">~</span> ., <span class="at">data =</span> Procurement.svm[train_idx.svm,], <span class="at">kernel =</span> <span class="st">"radial"</span>)</span>
<span id="cb175-1560"><a href="#cb175-1560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1561"><a href="#cb175-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1564"><a href="#cb175-1564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1565"><a href="#cb175-1565" aria-hidden="true" tabindex="-1"></a>preds_svm1 <span class="ot">=</span> <span class="fu">predict</span>(svm.m1, <span class="at">newdata =</span> Procurement.svm[test_idx.svm,])</span>
<span id="cb175-1566"><a href="#cb175-1566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1567"><a href="#cb175-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1570"><a href="#cb175-1570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1571"><a href="#cb175-1571" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds_svm1)</span>
<span id="cb175-1572"><a href="#cb175-1572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1573"><a href="#cb175-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1574"><a href="#cb175-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pred.rate.svm}</span></span>
<span id="cb175-1575"><a href="#cb175-1575" aria-hidden="true" tabindex="-1"></a><span class="co">#pred.rate.svm</span></span>
<span id="cb175-1576"><a href="#cb175-1576" aria-hidden="true" tabindex="-1"></a>pred.rate.svm <span class="ot">=</span> <span class="fu">mean</span>(preds_svm1 <span class="sc">==</span> Procurement.svm[test_idx.svm,]<span class="sc">$</span>abv200k)</span>
<span id="cb175-1577"><a href="#cb175-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1578"><a href="#cb175-1578" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred.rate.svm)</span>
<span id="cb175-1579"><a href="#cb175-1579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1580"><a href="#cb175-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1581"><a href="#cb175-1581" aria-hidden="true" tabindex="-1"></a>WARNING: The next chunk is very time-consuming.</span>
<span id="cb175-1582"><a href="#cb175-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1583"><a href="#cb175-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tuning svm using tune function and ranges of pars}</span></span>
<span id="cb175-1584"><a href="#cb175-1584" aria-hidden="true" tabindex="-1"></a><span class="co">#tuning svm using tune function and ranges of pars</span></span>
<span id="cb175-1585"><a href="#cb175-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1586"><a href="#cb175-1586" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb175-1587"><a href="#cb175-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1588"><a href="#cb175-1588" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb175-1589"><a href="#cb175-1589" aria-hidden="true" tabindex="-1"></a>svm.tune <span class="ot">&lt;-</span> <span class="fu">tune</span>(svm, abv200k<span class="sc">~</span>., <span class="at">data =</span> Procurement.svm[tune_idx.svm,], <span class="at">kernel =</span> <span class="st">"radial"</span>,</span>
<span id="cb175-1590"><a href="#cb175-1590" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ranges =</span> <span class="fu">list</span>(<span class="at">cost =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>),</span>
<span id="cb175-1591"><a href="#cb175-1591" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>)))</span>
<span id="cb175-1592"><a href="#cb175-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1593"><a href="#cb175-1593" aria-hidden="true" tabindex="-1"></a>svm.tune<span class="sc">$</span>best.model</span>
<span id="cb175-1594"><a href="#cb175-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1595"><a href="#cb175-1595" aria-hidden="true" tabindex="-1"></a><span class="co">#Takes forever to run, I used a small sample to find the best model to save time.</span></span>
<span id="cb175-1596"><a href="#cb175-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1597"><a href="#cb175-1597" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start_time)</span>
<span id="cb175-1598"><a href="#cb175-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1599"><a href="#cb175-1599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1600"><a href="#cb175-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1603"><a href="#cb175-1603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1604"><a href="#cb175-1604" aria-hidden="true" tabindex="-1"></a>preds_svm2 <span class="ot">=</span> <span class="fu">predict</span>(svm.tune<span class="sc">$</span>best.model, <span class="at">newdata =</span> Procurement.svm[test_idx.svm2,])</span>
<span id="cb175-1605"><a href="#cb175-1605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1606"><a href="#cb175-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1607"><a href="#cb175-1607" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tuned pred.rate.svm2}</span></span>
<span id="cb175-1608"><a href="#cb175-1608" aria-hidden="true" tabindex="-1"></a><span class="co">#tuned pred.rate.svm2</span></span>
<span id="cb175-1609"><a href="#cb175-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1610"><a href="#cb175-1610" aria-hidden="true" tabindex="-1"></a>pred.rate.svm2 <span class="ot">=</span> <span class="fu">mean</span>(preds_svm2 <span class="sc">==</span> Procurement.svm[test_idx.svm2,]<span class="sc">$</span>abv200k)</span>
<span id="cb175-1611"><a href="#cb175-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1612"><a href="#cb175-1612" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred.rate.svm2)</span>
<span id="cb175-1613"><a href="#cb175-1613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1614"><a href="#cb175-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1615"><a href="#cb175-1615" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing RMSE, SSE, &amp; Prediction rate and Conclusion</span></span>
<span id="cb175-1616"><a href="#cb175-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1617"><a href="#cb175-1617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating Errdf}</span></span>
<span id="cb175-1618"><a href="#cb175-1618" aria-hidden="true" tabindex="-1"></a><span class="co"># creating Errdf</span></span>
<span id="cb175-1619"><a href="#cb175-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1620"><a href="#cb175-1620" aria-hidden="true" tabindex="-1"></a>rmse.var <span class="ot">=</span> <span class="fu">c</span>(rmse_r, new_rmse.r, rmse_spline.bids, rmse_sp.gam3, rmse_tunedtree, rmse_bagtree2)</span>
<span id="cb175-1621"><a href="#cb175-1621" aria-hidden="true" tabindex="-1"></a>sse.var <span class="ot">=</span> <span class="fu">c</span>(sse_r, new_sse.r, sse_spline.bids, sse_sp.gam3, sse_tunedtree, sse_bagtree2)</span>
<span id="cb175-1622"><a href="#cb175-1622" aria-hidden="true" tabindex="-1"></a>model.var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"lm_ridge.c"</span>, <span class="st">"lm_ridge.c2"</span>, <span class="st">"spline_model.bids"</span>, <span class="st">"spline_model.gam3"</span>, <span class="st">"tuned_tree"</span>, <span class="st">"bag_tree2"</span>)</span>
<span id="cb175-1623"><a href="#cb175-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1624"><a href="#cb175-1624" aria-hidden="true" tabindex="-1"></a>Errdf <span class="ot">=</span> <span class="fu">data.frame</span>(model.var, rmse.var, sse.var)</span>
<span id="cb175-1625"><a href="#cb175-1625" aria-hidden="true" tabindex="-1"></a>Errdf</span>
<span id="cb175-1626"><a href="#cb175-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1627"><a href="#cb175-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1628"><a href="#cb175-1628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot RMSE}</span></span>
<span id="cb175-1629"><a href="#cb175-1629" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot RMSE</span></span>
<span id="cb175-1630"><a href="#cb175-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1631"><a href="#cb175-1631" aria-hidden="true" tabindex="-1"></a>Errdf <span class="sc">%&gt;%</span> </span>
<span id="cb175-1632"><a href="#cb175-1632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rmse.var, sse.var) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1633"><a href="#cb175-1633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rmse.var, </span>
<span id="cb175-1634"><a href="#cb175-1634" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="fl">0.013</span>, </span>
<span id="cb175-1635"><a href="#cb175-1635" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(model.var, <span class="fu">desc</span>(rmse.var)), </span>
<span id="cb175-1636"><a href="#cb175-1636" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>model.var,</span>
<span id="cb175-1637"><a href="#cb175-1637" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(rmse.var, <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb175-1638"><a href="#cb175-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb175-1639"><a href="#cb175-1639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-1640"><a href="#cb175-1640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb175-1641"><a href="#cb175-1641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RMSE by model"</span>, <span class="at">x =</span> <span class="st">"RMSE"</span>, <span class="at">y =</span> <span class="st">"Models"</span>)</span>
<span id="cb175-1642"><a href="#cb175-1642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1643"><a href="#cb175-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1644"><a href="#cb175-1644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot SSE}</span></span>
<span id="cb175-1645"><a href="#cb175-1645" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot SSE</span></span>
<span id="cb175-1646"><a href="#cb175-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1647"><a href="#cb175-1647" aria-hidden="true" tabindex="-1"></a>Errdf <span class="sc">%&gt;%</span> </span>
<span id="cb175-1648"><a href="#cb175-1648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sse.var, </span>
<span id="cb175-1649"><a href="#cb175-1649" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> <span class="dv">50000</span>, </span>
<span id="cb175-1650"><a href="#cb175-1650" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(model.var, <span class="fu">desc</span>(sse.var)), </span>
<span id="cb175-1651"><a href="#cb175-1651" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend=</span>model.var,</span>
<span id="cb175-1652"><a href="#cb175-1652" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">round</span>(sse.var, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb175-1653"><a href="#cb175-1653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb175-1654"><a href="#cb175-1654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-1655"><a href="#cb175-1655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb175-1656"><a href="#cb175-1656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SSE by model"</span>, <span class="at">x =</span> <span class="st">"SSE"</span>, <span class="at">y =</span> <span class="st">"Models"</span>)</span>
<span id="cb175-1657"><a href="#cb175-1657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1658"><a href="#cb175-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1659"><a href="#cb175-1659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creating Errdf2}</span></span>
<span id="cb175-1660"><a href="#cb175-1660" aria-hidden="true" tabindex="-1"></a><span class="co">#creating Errdf2</span></span>
<span id="cb175-1661"><a href="#cb175-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1662"><a href="#cb175-1662" aria-hidden="true" tabindex="-1"></a>pred.rate <span class="ot">=</span> <span class="fu">c</span>(pred.rate.log, pred.rate.knn3, pred.rate.svm2)</span>
<span id="cb175-1663"><a href="#cb175-1663" aria-hidden="true" tabindex="-1"></a>pred.model <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"log_model_train.2"</span>, <span class="st">"knn3"</span>, <span class="st">"svm.tune"</span>)</span>
<span id="cb175-1664"><a href="#cb175-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1665"><a href="#cb175-1665" aria-hidden="true" tabindex="-1"></a>Errdf2 <span class="ot">=</span> <span class="fu">data.frame</span>(pred.rate, pred.model)</span>
<span id="cb175-1666"><a href="#cb175-1666" aria-hidden="true" tabindex="-1"></a>Errdf2</span>
<span id="cb175-1667"><a href="#cb175-1667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1668"><a href="#cb175-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1669"><a href="#cb175-1669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Plot for classifications correctness rates}</span></span>
<span id="cb175-1670"><a href="#cb175-1670" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot for classifications correctness rates</span></span>
<span id="cb175-1671"><a href="#cb175-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1672"><a href="#cb175-1672" aria-hidden="true" tabindex="-1"></a>Errdf2 <span class="sc">%&gt;%</span> </span>
<span id="cb175-1673"><a href="#cb175-1673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(pred.model, pred.rate, <span class="at">label =</span> <span class="fu">round</span>(pred.rate, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb175-1674"><a href="#cb175-1674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb175-1675"><a href="#cb175-1675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_x =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb175-1676"><a href="#cb175-1676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Prediction Rates"</span>, <span class="at">x =</span> <span class="st">"Methods of Classification"</span>, <span class="at">y =</span> <span class="st">"Correct Predictions"</span>) <span class="sc">+</span></span>
<span id="cb175-1677"><a href="#cb175-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb175-1678"><a href="#cb175-1678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1679"><a href="#cb175-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1680"><a href="#cb175-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1681"><a href="#cb175-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1682"><a href="#cb175-1682" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further discussion</span></span>
<span id="cb175-1683"><a href="#cb175-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1684"><a href="#cb175-1684" aria-hidden="true" tabindex="-1"></a>There is a variable for period between the time of award of the contract and the signing of the said contract. I excluded the variable for now, since there are many missing values and the effect on the value is unclear.</span>
<span id="cb175-1685"><a href="#cb175-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1688"><a href="#cb175-1688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1689"><a href="#cb175-1689" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Procurement<span class="sc">$</span>ca_signper)</span>
<span id="cb175-1690"><a href="#cb175-1690" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> Procurement</span>
<span id="cb175-1691"><a href="#cb175-1691" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>ca_signper <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Procurement<span class="sc">$</span>ca_signper)</span>
<span id="cb175-1692"><a href="#cb175-1692" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test<span class="sc">$</span>ca_signper)</span>
<span id="cb175-1693"><a href="#cb175-1693" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb175-1694"><a href="#cb175-1694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cri_wb))</span>
<span id="cb175-1695"><a href="#cb175-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1696"><a href="#cb175-1696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1697"><a href="#cb175-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1700"><a href="#cb175-1700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1701"><a href="#cb175-1701" aria-hidden="true" tabindex="-1"></a><span class="dv">4436</span><span class="sc">/</span><span class="dv">161465</span></span>
<span id="cb175-1702"><a href="#cb175-1702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1703"><a href="#cb175-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1704"><a href="#cb175-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1707"><a href="#cb175-1707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1708"><a href="#cb175-1708" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb175-1709"><a href="#cb175-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ca_signper <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">500</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-1710"><a href="#cb175-1710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_signper)) <span class="sc">+</span> </span>
<span id="cb175-1711"><a href="#cb175-1711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb175-1712"><a href="#cb175-1712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1713"><a href="#cb175-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1716"><a href="#cb175-1716" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1717"><a href="#cb175-1717" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb175-1718"><a href="#cb175-1718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ca_signper)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1719"><a href="#cb175-1719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ca_signper <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">900</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1720"><a href="#cb175-1720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb175-1721"><a href="#cb175-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb175-1722"><a href="#cb175-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-1725"><a href="#cb175-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb175-1726"><a href="#cb175-1726" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb175-1727"><a href="#cb175-1727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ca_signper)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-1728"><a href="#cb175-1728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ca_signper <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">900</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-1729"><a href="#cb175-1729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ca_signper, <span class="at">y=</span>lca_contract_value)) <span class="sc">+</span></span>
<span id="cb175-1730"><a href="#cb175-1730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb175-1731"><a href="#cb175-1731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb175-1732"><a href="#cb175-1732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>